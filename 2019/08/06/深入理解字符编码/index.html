<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>æ·±å…¥ç†è§£å­—ç¬¦ç¼–ç  - rmb122's notebook</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ä»¥å‰å¯¹ UTF-8, UTF-16, unicode, GBK, ASCII ä¹‹ç±»çš„éƒ½æ˜¯ä¸€çŸ¥åŠè§£, å…¶å®æ·±å…¥ä¹‹åäº†è§£è¿™äº›å¹¶ä¸å›°éš¾."><meta property="og:image" content><meta property="og:title" content="æ·±å…¥ç†è§£å­—ç¬¦ç¼–ç "><meta property="og:description" content="ä»¥å‰å¯¹ UTF-8, UTF-16, unicode, GBK, ASCII ä¹‹ç±»çš„éƒ½æ˜¯ä¸€çŸ¥åŠè§£, å…¶å®æ·±å…¥ä¹‹åäº†è§£è¿™äº›å¹¶ä¸å›°éš¾."><meta property="og:type" content="article"><meta property="og:url" content="https://rmb122.com/2019/08/06/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-06T16:13:47+00:00"><meta property="article:modified_time" content="2019-08-06T16:13:47+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="æ·±å…¥ç†è§£å­—ç¬¦ç¼–ç "><meta name=twitter:description content="ä»¥å‰å¯¹ UTF-8, UTF-16, unicode, GBK, ASCII ä¹‹ç±»çš„éƒ½æ˜¯ä¸€çŸ¥åŠè§£, å…¶å®æ·±å…¥ä¹‹åäº†è§£è¿™äº›å¹¶ä¸å›°éš¾."><script src=https://rmb122.com/js/feather.min.js></script>
<link rel=stylesheet type=text/css media=screen href=https://rmb122.com/css/main.21410c161c7e5bcadc5a4eccf49ce5a024e0e8fc19babbd534cfe87972f5ee51.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://rmb122.com/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css disabled></head><body><div class=content><header><div class=main><a href=https://rmb122.com/>rmb122's notebook</a></div><nav><a href=/>é¦–é¡µ</a>&nbsp;
<a href=/tags>æ ‡ç­¾</a>&nbsp;
<a href=/posts>å½’æ¡£</a>&nbsp;
<a href=/about>å…³äº</a>&nbsp;
<a href=/links>å‹é“¾</a>
| <a id=dark-mode-toggle onclick=toggleTheme() href></a>
<script src=https://rmb122.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>æ·±å…¥ç†è§£å­—ç¬¦ç¼–ç </h1><div class=meta>å‘è¡¨äº 2019 å¹´ 8 æœˆ 6 æ—¥</div></div><section class=body><p>ä»¥å‰å¯¹ UTF-8, UTF-16, unicode, GBK, ASCII ä¹‹ç±»çš„éƒ½æ˜¯ä¸€çŸ¥åŠè§£, å…¶å®æ·±å…¥ä¹‹åäº†è§£è¿™äº›å¹¶ä¸å›°éš¾.</p><h2 id=unicode>unicode</h2><p>å…¶å®è¿™æ˜¯æœ€ç®€å•çš„, unicode å°±æ˜¯ä¸€å¥—æ ‡å‡†, æŠŠä¸–ç•Œä¸Šæ¯ä¸ªå­˜åœ¨çš„å­—ç¬¦ (ç”šè‡³åŒ…æ‹¬ emoji) éƒ½ç¼–ä¸€ä¸ªå·, å¯ä»¥åœ¨ <a href=https://unicode-table.com/cn/>https://unicode-table.com/cn/</a> çœ‹åˆ°å…¨éƒ¨çš„ç¼–ç ,<br>æŠŠè¿™ä¸ªç¼–çš„å·, ä¸€èˆ¬å«åš code point, ä¹Ÿå°±æ˜¯ç ç‚¹. åŒæ—¶ä¹Ÿè®¾å®šäº†å‡ ä¸ªç¼–ç çš„æ ‡å‡†, ä¹Ÿå°±æ˜¯ UTF-8, UTF-16 ç­‰ç­‰, æ¯•ç«Ÿç›´æ¥æŠŠç ç‚¹è½¬äºŒè¿›åˆ¶å¤ªæµªè´¹ç©ºé—´äº†.</p><p>è€Œè¿™äº›ç¼–ç , å°±æ˜¯æŠŠè¿™äº›ç ç‚¹ä¿å­˜ä¸ºè®¡ç®—æœºå¯ä»¥è¯†åˆ«çš„äºŒè¿›åˆ¶å½¢å¼.</p><h2 id=utf-8>UTF-8</h2><p>UTF-8 å°±æ˜¯è¿™äº›ç¼–ç çš„ä¸€ç§, è¯¦ç»†å¯ä»¥å‚è€ƒ<a href=https://zh.wikipedia.org/wiki/UTF-8>ç»´åŸºç™¾ç§‘</a>, ç®€å•æ¥è¯´, å°±æ˜¯æŠŠç ç‚¹è½¬ä¸ºäºŒè¿›åˆ¶å,<br>ç„¶åä¸ºäº†èŠ‚çœç©ºé—´, æŠŠä¸åŒå¤§å°çš„ç ç‚¹è½¬ä¸ºä¸åŒé•¿åº¦çš„å­—èŠ‚åºåˆ—, è¿™å°±æ˜¯ä»–å¤©æ‰çš„åœ°æ–¹, ç”¨å˜é•¿ç¼–ç æ¥èŠ‚çœé•¿åº¦.</p><p>è¿™é‡Œä»¥ <code>å•Š</code> ä¸ºä¾‹, å®ƒçš„ç ç‚¹æ˜¯ <code>0x554a</code>, åœ¨ <code>U+0800~U+FFFF</code> çš„èŒƒå›´å†…, äºŒè¿›åˆ¶æ˜¯ <code>0b101010101001010</code>,<br>é‚£ä¹ˆæ ¹æ®å®šä¹‰, ä»–çš„ä¿å­˜æ–¹å¼æ˜¯ <code>1110xxxx 10xxxxxx 10xxxxxx</code>, æˆ‘ä»¬å°†è¿™ä¸ªç ç‚¹çš„äºŒè¿›åˆ¶ä»¥å¤§ç«¯çš„æ–¹å¼å¡«å…¥å…¶ä¸­,<br>å¾—åˆ° <code>1110|0101 10|010101 10|001010</code>, ä¹Ÿå°±æ˜¯ <code>b'\xe5\x95\x8a'</code>, å¯ä»¥å°è¯•åœ¨ python è§£ç , å¾—åˆ°çš„å°±æ˜¯ <code>å•Š</code>.</p><p>è€Œåœ¨ <code>0x00 ~ 0xFF</code> èŒƒå›´å†…, UTF-8 å…¶å®å°±è¢«é€€åŒ–ä¸º ASCII äº†, ä¸€æ˜¯ä¸ºäº†å…¼å®¹æ€§, äºŒæ˜¯ç¡®å® ASCII æ‰€æ¶µç›–çš„ç¬¦å·, ç¡®å®ç”¨çš„éå¸¸å¤š.<br>è¿™é‡Œå¯ä»¥æ‰‹åŠ¨å†™ä¸€äº› UTF-8 çš„å‡½æ•°æ¥åŠ æ·±å­¦ä¹ , å› ä¸ºæ˜¯å˜é•¿çš„, æ‰€ä»¥æ¥ç®—é•¿åº¦, ä»¥åŠæˆªå–ç›¸å¯¹æ¯”è¾ƒéº»çƒ¦.<br>è¿™é‡Œç”¨æˆ‘ç”¨ c å†™, æ„Ÿè§‰éå¸¸çš„çˆ½, å°±åƒåœ¨é«˜é€Ÿå…¬è·¯ä¸Šé£™è½¦, æ§åˆ¶ä¸å¥½å°±ä¼šç¿»è½¦ (Segment fault) 233, ä½†æ˜¯ç¡®å®æ˜¯æœ€æ¥è¿‘è¿™äº›å­—ç¬¦ç¼–ç æœ¬æ¥çš„æ ·å­.<br>æ²¡æœ‰äº† python ä¸Šå„ç§çš„åŒ…è£….</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdio.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdlib.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;memory.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span> <span style=color:#50fa7b>read_file</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>filename) {
</span></span><span style=display:flex><span>    FILE <span style=color:#ff79c6>*</span>fd <span style=color:#ff79c6>=</span> fopen(filename, <span style=color:#f1fa8c>&#34;r&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fseek(fd, <span style=color:#bd93f9>0</span>, SEEK_END);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>long</span> sz <span style=color:#ff79c6>=</span> ftell(fd);
</span></span><span style=display:flex><span>    fseek(fd, <span style=color:#bd93f9>0</span>, SEEK_SET);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>content <span style=color:#ff79c6>=</span> malloc(<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>char</span>) <span style=color:#ff79c6>*</span> sz);
</span></span><span style=display:flex><span>    fread(content, <span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>char</span>), sz, fd);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fclose(fd);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> content;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>utf8_strlen</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>s) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>while</span> (<span style=color:#ff79c6>*</span>s) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> ((<span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b11000000) <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span>b10000000) {
</span></span><span style=display:flex><span>            length <span style=color:#ff79c6>+=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        s<span style=color:#ff79c6>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> length;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span> <span style=color:#50fa7b>codepoint_to_utf8</span>(<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>int</span> codepoint, <span style=color:#8be9fd>int</span> <span style=color:#ff79c6>*</span>sz) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>s;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (codepoint <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0x80</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>sz <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>        s <span style=color:#ff79c6>=</span> malloc(<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>char</span>));
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>=</span> codepoint;
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>if</span> (codepoint <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0x800</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>sz <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>2</span>;
</span></span><span style=display:flex><span>        s <span style=color:#ff79c6>=</span> malloc(<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>char</span>) <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>2</span>);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>(s <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>b10000000 <span style=color:#ff79c6>|</span> (codepoint <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b00111111);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>b11000000 <span style=color:#ff79c6>|</span> ((codepoint <span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#bd93f9>6</span>) <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b00011111);
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>if</span> (codepoint <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0x10000</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>sz <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>3</span>;
</span></span><span style=display:flex><span>        s <span style=color:#ff79c6>=</span> malloc(<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>char</span>) <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>3</span>);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>(s <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>2</span>) <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>b10000000 <span style=color:#ff79c6>|</span> (codepoint <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b00111111);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>(s <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>b10000000 <span style=color:#ff79c6>|</span> ((codepoint <span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#bd93f9>6</span>) <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b00111111);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>b11100000 <span style=color:#ff79c6>|</span> ((codepoint <span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#bd93f9>12</span>) <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b00001111);
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>sz <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>4</span>;
</span></span><span style=display:flex><span>        s <span style=color:#ff79c6>=</span> malloc(<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>char</span>) <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>4</span>);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>(s <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>3</span>) <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>b10000000 <span style=color:#ff79c6>|</span> (codepoint <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b00111111);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>(s <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>2</span>) <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>b10000000 <span style=color:#ff79c6>|</span> ((codepoint <span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#bd93f9>6</span>) <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b00111111);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>(s <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>b10000000 <span style=color:#ff79c6>|</span> ((codepoint <span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#bd93f9>12</span>) <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b00111111);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>b11110000 <span style=color:#ff79c6>|</span> ((codepoint <span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#bd93f9>18</span>) <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b00000111);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> s;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>get_tail_length</span>(<span style=color:#8be9fd>char</span> c) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> ((c <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b11111000) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>b11110000) {
</span></span><span style=display:flex><span>        length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>3</span>;
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>if</span> ((c <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b11110000) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>b11100000) {
</span></span><span style=display:flex><span>        length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>2</span>;
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>if</span> ((c <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b11100000) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>b11000000) {
</span></span><span style=display:flex><span>        length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> length;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span> <span style=color:#50fa7b>utf8_substr</span>(<span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span> s, <span style=color:#8be9fd>int</span> start, <span style=color:#8be9fd>int</span> length) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> curr_pos <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> byte_count <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> offset <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>new_s;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>while</span> (curr_pos <span style=color:#ff79c6>&lt;</span> start <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#ff79c6>*</span>s) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> ((<span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b11000000) <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span>b10000000) {
</span></span><span style=display:flex><span>            curr_pos <span style=color:#ff79c6>+=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        s <span style=color:#ff79c6>+=</span> (get_tail_length(<span style=color:#ff79c6>*</span>s) <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    curr_pos <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>while</span> (curr_pos <span style=color:#ff79c6>&lt;</span> length <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#ff79c6>*</span>s) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> ((<span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b11000000) <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span>b10000000) {
</span></span><span style=display:flex><span>            curr_pos <span style=color:#ff79c6>+=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        s<span style=color:#ff79c6>++</span>;
</span></span><span style=display:flex><span>        byte_count<span style=color:#ff79c6>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (curr_pos <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>        offset <span style=color:#ff79c6>=</span> get_tail_length(<span style=color:#ff79c6>*</span>(s <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        new_s <span style=color:#ff79c6>=</span> malloc(<span style=color:#ff79c6>sizeof</span>(<span style=color:#8be9fd>char</span>) <span style=color:#ff79c6>*</span> (byte_count <span style=color:#ff79c6>+</span> offset <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>));
</span></span><span style=display:flex><span>        memcpy(new_s, s <span style=color:#ff79c6>-</span> byte_count, byte_count <span style=color:#ff79c6>+</span> offset);
</span></span><span style=display:flex><span>        new_s[byte_count <span style=color:#ff79c6>+</span> offset] <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;\0&#39;</span>;
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>        new_s <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>NULL</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> new_s;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>utf8_to_codepoint</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>s) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> codepoint <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> ((<span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b11111000) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>b11110000) {
</span></span><span style=display:flex><span>        length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>4</span>;
</span></span><span style=display:flex><span>        codepoint <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b111;
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>if</span> ((<span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b11110000) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>b11100000) {
</span></span><span style=display:flex><span>        length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>3</span>;
</span></span><span style=display:flex><span>        codepoint <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b1111;
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>if</span> ((<span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b11100000) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>b11000000) {
</span></span><span style=display:flex><span>        length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>2</span>;
</span></span><span style=display:flex><span>        codepoint <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b11111;
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>        length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>        codepoint <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>*</span>s;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>; i <span style=color:#ff79c6>&lt;</span> length; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span>        s<span style=color:#ff79c6>++</span>;
</span></span><span style=display:flex><span>        codepoint <span style=color:#ff79c6>&lt;&lt;=</span> <span style=color:#bd93f9>6</span>;
</span></span><span style=display:flex><span>        codepoint <span style=color:#ff79c6>=</span> codepoint <span style=color:#ff79c6>|</span> (<span style=color:#ff79c6>*</span>s <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0</span>b00111111);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> codepoint;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span><span style=color:#6272a4>    char *content = read_file(&#34;/home/rmb122/temp/example.txt&#34;);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>    printf(&#34;%d&#34;, utf8_strlen(content));
</span></span></span><span style=display:flex><span><span style=color:#6272a4>
</span></span></span><span style=display:flex><span><span style=color:#6272a4>    free(content);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;%d</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, utf8_strlen(<span style=color:#f1fa8c>&#34;ä¸€äºŒä¸‰å››äº”å…­ä¸€äºŒä¸‰å››äº”å…­1234&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>s;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> sz;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    s <span style=color:#ff79c6>=</span> codepoint_to_utf8(<span style=color:#bd93f9>21834</span>, <span style=color:#ff79c6>&amp;</span>sz);
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;%.*s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, sz, s);
</span></span><span style=display:flex><span>    free(s);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    s <span style=color:#ff79c6>=</span> utf8_substr(<span style=color:#f1fa8c>&#34;ä¸€2ä¸‰å››5å…­7å…«9&#34;</span>, <span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (s) {
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;%s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, s);
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;%s&#34;</span>, <span style=color:#f1fa8c>&#34;null&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    free(s);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;%d</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, utf8_to_codepoint(<span style=color:#f1fa8c>&#34;äº”&#34;</span>));
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=utf-16>UTF-16</h2><p>è¯´å®è¯, æˆ‘è§‰å¾— UTF-16 å·²ç»å¯ä»¥è¢«æ‰”è¿›å†å²çš„åƒåœ¾æ¡¶, ç„¶è€Œ <code>Windows</code> è¿˜ä¾ç„¶ä½¿ç”¨ 233.<br>ä»–æœ¬èº«æ˜¯ä¸ºäº†ä¿è¯å›ºå®šé•¿åº¦è€Œè®¾è®¡çš„, å› ä¸ºä¸¤ä¸ªå­—èŠ‚ 256*256, å¯ä»¥è¡¨ç¤º 65536 ç§å­—ç¬¦,<br>åœ¨ä»¥å‰ unicode æ”¶å½•å­—ç¬¦æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹æ˜¯å®Œå…¨å¤Ÿçš„, è¿™æ ·æ¯ä¸ªå­—ç¬¦éƒ½ä¿å­˜ä¸ºä¸¤ä¸ªå­—èŠ‚é•¿,<br>å¯ä»¥èŠ‚çœè¿ç®—, è™½ç„¶æµªè´¹äº†æŒºå¤šçš„ç©ºé—´, ä½†æ˜¯ç¡®å®å¾ˆæ–¹ä¾¿.</p><p>ç„¶è€Œç°åœ¨ä¸Šé¢çš„ç½‘ç«™ä¸Šçœ‹åˆ°, unicode æ”¶å½•çš„å­—ç¬¦æ—©å·²è¶…è¿‡äº† 65536 ä¸ª, ä¹Ÿå°±æ„å‘³ç€ç ç‚¹è¶…è¿‡äº† <code>0xFFFF</code>.<br>è¿™é‡Œä»¥ <code>ğ </code> è¿™ä¸ªå­—ç¬¦ä¸ºä¾‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#f1fa8c>&#34;å•Š&#34;</span><span style=color:#ff79c6>.</span>encode(<span style=color:#f1fa8c>&#39;utf-16be&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;UJ&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#f1fa8c>&#34;ğ &#34;</span><span style=color:#ff79c6>.</span>encode(<span style=color:#f1fa8c>&#39;utf-16be&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\xd8\x00\xdf\xa0</span><span style=color:#f1fa8c>&#39;</span>
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°, å®é™…ä¸Šä¿å­˜è¿™ä¸ªå­—ç¬¦ç”¨äº† 4 ä¸ªå­—èŠ‚. å†å²çš„å‘å±•ä½¿å¾— UTF-16 å”¯ä¸€çš„å¥½å¤„å·²ç»è¡ç„¶æ— å­˜.<br>è€Œä¸”ä¸ºäº†ä¿å­˜å¤§ç«¯å°ç«¯çš„é¢å¤–ä¿¡æ¯, è¿˜ç”¨äº† <code>BOM</code> è¿™ç§ä¸‘é™‹çš„è®¾è®¡, å¸Œæœ› <code>Windows</code> ä¹Ÿèƒ½æ—©ç‚¹æ·˜æ±°æ‰ UTF-16 æŠŠ 233</p><h2 id=gbk>GBK</h2><p>è¿™ä¸ªæ˜¯æˆ‘å›½è‡ªåˆ›çš„ç¼–ç æ ‡å‡†, ä¼˜ç‚¹éå¸¸æ˜æ˜¾, èŠ‚çœç©ºé—´, ç›¸å½“äºç¼©å°ç‰ˆçš„ UTF-8 (å½“ç„¶ç”¨çš„ç ç‚¹è¡¨å’Œå…·ä½“å®ç°è·Ÿ unicode ä¸åŒ),<br>å› ä¸ºå®ƒåªéœ€è¦è¡¨è¾¾ ASCII + æ±‰å­—çš„å­—ç¬¦ç©ºé—´å°±å¤Ÿäº†. å½“ç„¶ç¼ºç‚¹ä¹Ÿéå¸¸æ˜æ˜¾, ä¸èƒ½è¡¨è¾¾ ASCII + æ±‰å­—ä¹‹å¤–çš„å­—ç¬¦, ä¹Ÿå°±æ³¨å®šåªèƒ½åœ¨ä¸­å›½ä½¿ç”¨,<br>æ— æ³•å›½é™…åŒ–, è€Œä¸”å®é™…ä¸Šå¾ˆå¤šå›½å®¶éƒ½æœ‰ä¸€å¥—è‡ªåˆ›å­—ç¬¦é›†, è¿™æ›´ä¿ƒè¿›äº† unicode çš„è¯ç”Ÿ.</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/misc>misc</a></li></ul></nav></div></article></main><footer><div class=footer-info>2022 @rmb122</div><div style=display:flex><a class=border></a><a class=soc href=https://github.com/rmb122 title=GitHub><i data-feather=github></i></a></div></footer><script>feather.replace()</script></div></body></html>