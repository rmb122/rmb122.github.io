<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Padding Oracle + CBC 字节翻转学习 - rmb122's notebook</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="之前一直就很想了解的技术, 这次同样是在 hgame 上碰到, 刚好从师傅那里学习一下, 更详细的可以去看 wiki.
简单来讲就是通过服务器对 Padding 正确和错误返回的不同状态, 来猜解所谓的中间值, 从而达成解密数据, 伪造数据."><meta property="og:image" content><meta property="og:title" content="Padding Oracle + CBC 字节翻转学习"><meta property="og:description" content="之前一直就很想了解的技术, 这次同样是在 hgame 上碰到, 刚好从师傅那里学习一下, 更详细的可以去看 wiki.
简单来讲就是通过服务器对 Padding 正确和错误返回的不同状态, 来猜解所谓的中间值, 从而达成解密数据, 伪造数据."><meta property="og:type" content="article"><meta property="og:url" content="https://rmb122.com/2019/02/21/Padding-Oracle--CBC-%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E5%AD%A6%E4%B9%A0/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-02-21T17:04:38+00:00"><meta property="article:modified_time" content="2019-02-21T17:04:38+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Padding Oracle + CBC 字节翻转学习"><meta name=twitter:description content="之前一直就很想了解的技术, 这次同样是在 hgame 上碰到, 刚好从师傅那里学习一下, 更详细的可以去看 wiki.
简单来讲就是通过服务器对 Padding 正确和错误返回的不同状态, 来猜解所谓的中间值, 从而达成解密数据, 伪造数据."><script src=https://rmb122.com/js/feather.min.js></script>
<link rel=stylesheet type=text/css media=screen href=https://rmb122.com/css/main.156ea4f9c8c3d7072fb0ea9460063a78eceb89a501e4444cfab3783b79985a3a.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://rmb122.com/css/dark.4d342f24ad49bb75f14c3b92c9454fe693d293fb7474ecc40a101a8ad6af9d71.css disabled></head><body><div class=content><header><div class=main><a href=https://rmb122.com/>rmb122's notebook</a></div><nav><a href=/>首页</a>&nbsp;
<a href=/posts>归档</a>&nbsp;
<a href=/tags>标签</a>&nbsp;
<a href=/links>友链</a>&nbsp;
<a href=/about>关于</a>
| <a id=dark-mode-toggle onclick=toggleTheme() href></a>
<script src=https://rmb122.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>Padding Oracle + CBC 字节翻转学习</h1><div class=meta>发表于 2019 年 2 月 21 日</div></div><section class=body><p>之前一直就很想了解的技术, 这次同样是在 <a href=https://hgame.vidar.club/ title rel="noopener nofollow noreferrer" target=_blank>hgame</a> 上碰到, 刚好从<a href=http://xnianq.cn/2017/07/26/padding-oracle title rel="noopener nofollow noreferrer" target=_blank>师傅</a>那里学习一下, 更详细的可以去看 <a href=https://en.wikipedia.org/wiki/Padding_oracle_attack title rel="noopener nofollow noreferrer" target=_blank>wiki</a>.</p><p>简单来讲就是通过服务器对 Padding 正确和错误返回的不同状态, 来猜解所谓的<code>中间值</code>, 从而达成解密数据, 伪造数据.</p><p>以这张图为例子</p><p><img src=https://i.loli.net/2019/03/08/5c8279f81fce7.png#center alt referrerpolicy=no-referrer></p><p>我们可以暴力枚举倒数第二块密文的最后一个字节 (如果只有一块密文的话就修改 IV), 直到最后一块的最后一个字节刚好为 \x01, 这样服务器将会返回<code>权限验证失败</code>而不是<code>解密失败</code>. 这样将 \x01 与此时爆破出来的倒数第二块密文的字节 xor 一下, 得到的就是<code>中间值</code>, 再将中间值与原来的倒数第二块密文的最后一个字节 xor, 就可以得到明文. 此时再将 \x02 与中间值 xor, 作为密文的最后一个字节, 继续爆破倒数第二个字节, 使得最后两个字节都为 \x02, 就跟上面一样, 可以得到倒数第二位的中间值.</p><p>以此类推, 可以解出全部的明文, 同时, 有了中间值, 我们也可以通过修改前一块的数据来伪造数据, 比如要伪造 &lsquo;a&rsquo;, 只要将 <code>中间值 ^ ord('a')</code> 的结果作为前一块对应位置的数据即可. 然后将前一块作为最后一块, 再去爆破中间值. 最后可以伪造任意数据.</p><p>最后再来说说 CBC 字节翻转, 其实原理也是一样的, 通过修改前一块的数据, 不过这次是取 <code>前一块对应的密文 ^ 后一块对应的明文 ^ 你想要伪造的数据</code> 的结果. 不过需要注意的是这样将会使得<code>前一块密文</code>的解密结果异常, 具体解密出来是啥得看运气 233, 不过大概率是乱码. 当然, 如果只有一块密文或者我们修改的是第一块密文, 我们修改的将会是 IV, 这样可以使结果完全可控.</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/crypto>crypto</a></li></ul></nav></div></article></main><footer><div class=footer-info>© 2017 - 2022, rmb122</div><div style=display:flex><span class=border></span><a class=soc href=https://github.com/rmb122 title=GitHub><i data-feather=github></i></a><a class=soc href=https://rmb122.com/index.xml title=RSS><i data-feather=rss></i></a></div></footer><script>feather.replace()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MH3QGWHV5"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1MH3QGWHV5",{anonymize_ip:!1})}</script><script src=https://rmb122.com/js/medium-zoom.min.js></script>
<script>for(let e of document.getElementsByTagName("img"))mediumZoom(e,{margin:0,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.8)"})</script></div></body></html>