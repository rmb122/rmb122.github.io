<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>开发一个简单的 Chrome 拓展 - rmb122's notebook</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="每次复制域名时都会被 Chrome 复制地址时的 https:// 烦到, 所以干脆自己写个拓展来解决这个问题. Chrome 拓展其实就是一个小网页, 也就是 HTML, 所以我们可以用 JavaScript 来实现获取域名和复制的操作. 具体实现如下."><meta property="og:image" content><meta property="og:title" content="开发一个简单的 Chrome 拓展"><meta property="og:description" content="每次复制域名时都会被 Chrome 复制地址时的 https:// 烦到, 所以干脆自己写个拓展来解决这个问题. Chrome 拓展其实就是一个小网页, 也就是 HTML, 所以我们可以用 JavaScript 来实现获取域名和复制的操作. 具体实现如下."><meta property="og:type" content="article"><meta property="og:url" content="https://rmb122.com/2018/06/14/%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84-Chrome-%E6%8B%93%E5%B1%95/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-06-14T00:42:47+00:00"><meta property="article:modified_time" content="2018-06-14T00:42:47+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="开发一个简单的 Chrome 拓展"><meta name=twitter:description content="每次复制域名时都会被 Chrome 复制地址时的 https:// 烦到, 所以干脆自己写个拓展来解决这个问题. Chrome 拓展其实就是一个小网页, 也就是 HTML, 所以我们可以用 JavaScript 来实现获取域名和复制的操作. 具体实现如下."><script src=https://rmb122.com/js/feather.min.js></script>
<link rel=stylesheet type=text/css media=screen href=https://rmb122.com/css/main.21410c161c7e5bcadc5a4eccf49ce5a024e0e8fc19babbd534cfe87972f5ee51.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://rmb122.com/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css disabled></head><body><div class=content><header><div class=main><a href=https://rmb122.com/>rmb122's notebook</a></div><nav><a href=/>首页</a>&nbsp;
<a href=/posts>归档</a>&nbsp;
<a href=/tags>标签</a>&nbsp;
<a href=/links>友链</a>&nbsp;
<a href=/about>关于</a>
| <a id=dark-mode-toggle onclick=toggleTheme() href></a>
<script src=https://rmb122.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>开发一个简单的 Chrome 拓展</h1><div class=meta>发表于 2018 年 6 月 14 日</div></div><section class=body><p>每次复制域名时都会被 Chrome 复制地址时的 <code>https://</code> 烦到, 所以干脆自己写个拓展来解决这个问题. Chrome 拓展其实就是一个小网页, 也就是 HTML, 所以我们可以用 JavaScript 来实现获取域名和复制的操作. 具体实现如下.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> callback(tab) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>let</span> url <span style=color:#ff79c6>=</span> tab.url;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>let</span> parser <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;parser&#34;</span>);
</span></span><span style=display:flex><span>    parser.href <span style=color:#ff79c6>=</span> url;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>let</span> hostname <span style=color:#ff79c6>=</span> parser.hostname;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>let</span> text <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;text&#34;</span>);
</span></span><span style=display:flex><span>    text.setAttribute(<span style=color:#f1fa8c>&#34;value&#34;</span>, hostname);
</span></span><span style=display:flex><span>    text.select();
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>document</span>.execCommand(<span style=color:#f1fa8c>&#34;copy&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> getHostName(url) {
</span></span><span style=display:flex><span>    chrome.tabs.query({
</span></span><span style=display:flex><span>        active<span style=color:#ff79c6>:</span> <span style=color:#ff79c6>true</span>,
</span></span><span style=display:flex><span>        windowId<span style=color:#ff79c6>:</span> chrome.windows.WINDOW_ID_CURRENT
</span></span><span style=display:flex><span>    }, <span style=color:#8be9fd;font-style:italic>function</span> (tabs) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (tabs <span style=color:#ff79c6>&amp;&amp;</span> tabs[<span style=color:#bd93f9>0</span>]) {
</span></span><span style=display:flex><span>            callback(tabs[<span style=color:#bd93f9>0</span>]);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>window</span>.onload <span style=color:#ff79c6>=</span> getHostName
</span></span></code></pre></div><p>通过 <code>window.onload</code> 加载函数, 在 popup (地址栏右边的小图标点击后的页面) 弹出时自动将域名复制到粘贴版上. 关于获得当前页面 <code>url</code>, 因为 popup 自己就是个单独的页面, 与使用者当前浏览的隔离, 所以不能通过 <code>chrome.tabs.getCurrent</code> 来获得, 最后在 <a href=https://segmentfault.com/q/1010000005570850/a-1020000005590533>segmentfault</a> 上找到了大神的答案, 通过 <code>query</code> 函数来得到当前页面的 url, 然后调用 callback 函数. 接下来就是从 url 中解析得到 hostname 也就是域名, 不过 JavaScript 并没有现成的函数, 我们也没必要因为此就直接加载个第三方库, 所以我们可以设置 DOM 的 href 属性后通过 hostname 属性间接得到域名 (不知道为什么 JavaScript 不直接搞个函数算了233), 然后通过 <code>document.execCommand</code> 来复制 select 中的域名即可. 接下来就是 <code>manifest.json</code>, 不过有完整的文档, 弄起来比较容易</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;Get-hostname&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;version&#34;</span>: <span style=color:#f1fa8c>&#34;1.0&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;manifest_version&#34;</span>: <span style=color:#bd93f9>2</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;description&#34;</span>: <span style=color:#f1fa8c>&#34;Get hostname of current website.&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;icons&#34;</span>: {
</span></span><span style=display:flex><span>           <span style=color:#ff79c6>&#34;16&#34;</span>: <span style=color:#f1fa8c>&#34;icon16.png&#34;</span>,
</span></span><span style=display:flex><span>           <span style=color:#ff79c6>&#34;48&#34;</span>: <span style=color:#f1fa8c>&#34;icon48.png&#34;</span>,
</span></span><span style=display:flex><span>           <span style=color:#ff79c6>&#34;128&#34;</span>: <span style=color:#f1fa8c>&#34;icon128.png&#34;</span> 
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;browser_action&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>&#34;default_icon&#34;</span>: <span style=color:#f1fa8c>&#34;icon48.png&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>&#34;default_popup&#34;</span>: <span style=color:#f1fa8c>&#34;main.html&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;content_security_policy&#34;</span>: <span style=color:#f1fa8c>&#34;policyString&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;incognito&#34;</span>: <span style=color:#f1fa8c>&#34;spanning&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;key&#34;</span>: <span style=color:#f1fa8c>&#34;publicKey&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;offline_enabled&#34;</span>: <span style=color:#ff79c6>true</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&#34;permissions&#34;</span>: [<span style=color:#f1fa8c>&#34;tabs&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>最后加上 <code>main.html</code> 和 <code>CSS</code> 来装饰下就完美了.<br>PS: CSS 来自 <a href=http://www.bootcss.com/p/buttons/>button</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#ff79c6>input</span> <span style=color:#50fa7b>id</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;text&#34;</span> <span style=color:#50fa7b>class</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;text&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#ff79c6>a</span> <span style=color:#50fa7b>id</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;parser&#34;</span> <span style=color:#50fa7b>type</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;hidden&#34;</span>&gt;&lt;/<span style=color:#ff79c6>a</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#ff79c6>script</span> <span style=color:#50fa7b>src</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;main.js&#34;</span>&gt;&lt;/<span style=color:#ff79c6>script</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#ff79c6>link</span> <span style=color:#50fa7b>rel</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;stylesheet&#34;</span> <span style=color:#50fa7b>href</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;main.css&#34;</span>&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span>.<span style=color:#50fa7b>text</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>color</span>: <span style=color:#bd93f9>#666</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>background-color</span>: <span style=color:#bd93f9>#EEE</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>border-color</span>: <span style=color:#bd93f9>#EEE</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>font-weight</span>: <span style=color:#bd93f9>300</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>font-size</span>: <span style=color:#bd93f9>16</span><span style=color:#8be9fd>px</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>font-family</span>: <span style=color:#f1fa8c>&#34;Helvetica Neue Light&#34;</span>, <span style=color:#f1fa8c>&#34;Helvetica Neue&#34;</span>, Helvetica, Arial, <span style=color:#f1fa8c>&#34;Lucida Grande&#34;</span>, <span style=color:#ff79c6>sans-serif</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>text-decoration</span>: <span style=color:#ff79c6>none</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>text-align</span>: <span style=color:#ff79c6>center</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>line-height</span>: <span style=color:#bd93f9>40</span><span style=color:#8be9fd>px</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>height</span>: <span style=color:#bd93f9>40</span><span style=color:#8be9fd>px</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>width</span>: <span style=color:#bd93f9>240</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>margin</span>: <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>display</span>: <span style=color:#ff79c6>inline-block</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>appearance</span>: <span style=color:#ff79c6>none</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>cursor</span>: <span style=color:#ff79c6>pointer</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>border</span>: <span style=color:#ff79c6>none</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>margin-left</span>: <span style=color:#ff79c6>auto</span>; 
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>margin-right</span>: <span style=color:#ff79c6>auto</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>-webkit-</span><span style=color:#ff79c6>box-sizing</span>: <span style=color:#ff79c6>border-box</span>;
</span></span><span style=display:flex><span>       <span style=color:#ff79c6>-moz-</span><span style=color:#ff79c6>box-sizing</span>: <span style=color:#ff79c6>border-box</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>box-sizing</span>: <span style=color:#ff79c6>border-box</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>-webkit-</span><span style=color:#ff79c6>transition-property</span>: <span style=color:#ff79c6>all</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>transition-property</span>: <span style=color:#ff79c6>all</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>-webkit-</span><span style=color:#ff79c6>transition-duration</span>: <span style=color:#bd93f9>.3</span><span style=color:#8be9fd>s</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>transition-duration</span>: <span style=color:#bd93f9>.3</span><span style=color:#8be9fd>s</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>最后效果如下<br><img src=https://i.loli.net/2019/03/08/5c82677b223c6.jpg alt><br>点开那个图标后当前域名就直接复制到剪贴板了, 终于可以摆脱该死的 <code>https://</code> 了.</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/misc>misc</a></li></ul></nav></div></article></main><footer><div class=footer-info>2022 @rmb122</div><div style=display:flex><a class=border></a><a class=soc href=https://github.com/rmb122 title=GitHub><i data-feather=github></i></a></div></footer><script>feather.replace()</script></div></body></html>