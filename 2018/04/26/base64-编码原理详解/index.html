<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>base64 编码原理详解 - rmb122's notebook</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="之前一直都是直接无脑
1from base64 import b64encode as b64e
只知道大概 base64 是啥东西, 今天突然心血来潮花了几分钟了解了下 base64, 其实原理并不复杂."><meta property="og:image" content><meta property="og:title" content="base64 编码原理详解"><meta property="og:description" content="之前一直都是直接无脑
1from base64 import b64encode as b64e
只知道大概 base64 是啥东西, 今天突然心血来潮花了几分钟了解了下 base64, 其实原理并不复杂."><meta property="og:type" content="article"><meta property="og:url" content="https://rmb122.com/2018/04/26/base64-%E7%BC%96%E7%A0%81%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-04-26T08:22:44+00:00"><meta property="article:modified_time" content="2018-04-26T08:22:44+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="base64 编码原理详解"><meta name=twitter:description content="之前一直都是直接无脑
1from base64 import b64encode as b64e
只知道大概 base64 是啥东西, 今天突然心血来潮花了几分钟了解了下 base64, 其实原理并不复杂."><script src=https://rmb122.com/js/feather.min.js></script>
<link rel=stylesheet type=text/css media=screen href=https://rmb122.com/css/main.663e493f1b86b15e1a34e0d009c73ba2a1b18b35c8ddaa1bca5cd40659294be1.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://rmb122.com/css/dark.cefce3efc3d1673a12499d1730c46db6951ef16bde19558cdb583fa050acc62e.css disabled></head><body><div class=content><header><div class=main><a href=https://rmb122.com/>rmb122's notebook</a></div><nav><a href=/>首页</a>&nbsp;
<a href=/posts>归档</a>&nbsp;
<a href=/tags>标签</a>&nbsp;
<a href=/links>友链</a>&nbsp;
<a href=/about>关于</a>
| <a id=dark-mode-toggle onclick=toggleTheme() href></a>
<script src=https://rmb122.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>base64 编码原理详解</h1><div class=meta>发表于 2018 年 4 月 26 日</div></div><section class=body><p>之前一直都是直接无脑</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>from</span> base64 <span style=color:#ff79c6>import</span> b64encode <span style=color:#ff79c6>as</span> b64e
</span></span></code></pre></div><p>只知道大概 base64 是啥东西, 今天突然心血来潮花了几分钟了解了下 base64, 其实原理并不复杂.</p><p>所以今天不做个 api caller, 自己实现一下 base64 编码玩玩. 首先先了解一下 base64 的实际用途, 主要是将一个字节 (1 byte、8 bit) 转换为可以直接显示的字符, 比如一个文件内容是 <code>\x66\x12\x13\x14</code> 就可以将其转化为 <code>ZhITFA==</code>. 这样就可以通过一些只能输入可见字符的设备、协议或者格式来传递二进制文件, 比如在 json 中就可以将文件 base64 编码后传递. 在 acsii 中除去空格和两个换行符号, 一共有 93 个可显示字符, 而一个字节一共有 2^8=256 种可能, 无法全部一一与 93 个字符对应, 所以我们可以通过另一种取巧的办法, 将 3 个字节拼在一起, 用 4 个 6 bits 来代替.</p><p>这样就可以直接用 2^6=64 个可显示字符一一对应 6 个 bits 的所有可能性. 这也是 base64 里面 64 的来历, 其他 16、32 也是同理, 只是用了更少的字符对应更少的 bits, 但同时对应的存储损耗更大. 比如: base64 转化后每个可见字符保存时占用大小是一个字节, 但却需要 4 个可见字符来表示转化前的 3 个字节, 使得大小是原来的 4/3, 所以一般都使用 base64. 接下来了解了原理后就可以直接实现了, 像图中所示一样, 需要取高低六位、高低四位、高低二位. 我们可以用 python 中的位运算实现.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>getHighSix</span>(num):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#ff79c6>return</span> (<span style=color:#bd93f9>252</span> <span style=color:#ff79c6>&amp;</span> num) <span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>getLowSix</span>(num):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#ff79c6>return</span> (<span style=color:#bd93f9>63</span> <span style=color:#ff79c6>&amp;</span> num)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>getLowTwo</span>(num):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#ff79c6>return</span> (<span style=color:#bd93f9>3</span> <span style=color:#ff79c6>&amp;</span> num) <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>4</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>getHighTwo</span>(num):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#ff79c6>return</span> (<span style=color:#bd93f9>192</span> <span style=color:#ff79c6>&amp;</span> num) <span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#bd93f9>6</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>getHighFour</span>(num):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#ff79c6>return</span> (<span style=color:#bd93f9>240</span> <span style=color:#ff79c6>&amp;</span> num) <span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#bd93f9>4</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>getLowFour</span>(num):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#ff79c6>return</span> (<span style=color:#bd93f9>15</span> <span style=color:#ff79c6>&amp;</span> num) <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>接下来我们需要一个字符表来一一对应字符与各个 <span style=color:#bd93f9>6</span> bits 的关系,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>codeTable <span style=color:#ff79c6>=</span> [
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#f1fa8c>&#39;A&#39;</span>, <span style=color:#f1fa8c>&#39;B&#39;</span>, <span style=color:#f1fa8c>&#39;C&#39;</span>, <span style=color:#f1fa8c>&#39;D&#39;</span>, <span style=color:#f1fa8c>&#39;E&#39;</span>, <span style=color:#f1fa8c>&#39;F&#39;</span>, <span style=color:#f1fa8c>&#39;G&#39;</span>, <span style=color:#f1fa8c>&#39;H&#39;</span>, <span style=color:#f1fa8c>&#39;I&#39;</span>, <span style=color:#f1fa8c>&#39;J&#39;</span>, <span style=color:#f1fa8c>&#39;K&#39;</span>, <span style=color:#f1fa8c>&#39;L&#39;</span>, <span style=color:#f1fa8c>&#39;M&#39;</span>, <span style=color:#f1fa8c>&#39;N&#39;</span>, <span style=color:#f1fa8c>&#39;O&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>    <span style=color:#f1fa8c>&#39;P&#39;</span>, <span style=color:#f1fa8c>&#39;Q&#39;</span>, <span style=color:#f1fa8c>&#39;R&#39;</span>, <span style=color:#f1fa8c>&#39;S&#39;</span>, <span style=color:#f1fa8c>&#39;T&#39;</span>, <span style=color:#f1fa8c>&#39;U&#39;</span>, <span style=color:#f1fa8c>&#39;V&#39;</span>, <span style=color:#f1fa8c>&#39;W&#39;</span>, <span style=color:#f1fa8c>&#39;X&#39;</span>, <span style=color:#f1fa8c>&#39;Y&#39;</span>, <span style=color:#f1fa8c>&#39;Z&#39;</span>, <span style=color:#f1fa8c>&#39;a&#39;</span>, <span style=color:#f1fa8c>&#39;b&#39;</span>, <span style=color:#f1fa8c>&#39;c&#39;</span>, <span style=color:#f1fa8c>&#39;d&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    <span style=color:#f1fa8c>&#39;e&#39;</span>, <span style=color:#f1fa8c>&#39;f&#39;</span>, <span style=color:#f1fa8c>&#39;g&#39;</span>, <span style=color:#f1fa8c>&#39;h&#39;</span>, <span style=color:#f1fa8c>&#39;i&#39;</span>, <span style=color:#f1fa8c>&#39;j&#39;</span>, <span style=color:#f1fa8c>&#39;k&#39;</span>, <span style=color:#f1fa8c>&#39;l&#39;</span>, <span style=color:#f1fa8c>&#39;m&#39;</span>, <span style=color:#f1fa8c>&#39;n&#39;</span>, <span style=color:#f1fa8c>&#39;o&#39;</span>, <span style=color:#f1fa8c>&#39;p&#39;</span>, <span style=color:#f1fa8c>&#39;q&#39;</span>, <span style=color:#f1fa8c>&#39;r&#39;</span>, <span style=color:#f1fa8c>&#39;s&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    <span style=color:#f1fa8c>&#39;t&#39;</span>, <span style=color:#f1fa8c>&#39;u&#39;</span>, <span style=color:#f1fa8c>&#39;v&#39;</span>, <span style=color:#f1fa8c>&#39;w&#39;</span>, <span style=color:#f1fa8c>&#39;x&#39;</span>, <span style=color:#f1fa8c>&#39;y&#39;</span>, <span style=color:#f1fa8c>&#39;z&#39;</span>, <span style=color:#f1fa8c>&#39;0&#39;</span>, <span style=color:#f1fa8c>&#39;1&#39;</span>, <span style=color:#f1fa8c>&#39;2&#39;</span>, <span style=color:#f1fa8c>&#39;3&#39;</span>, <span style=color:#f1fa8c>&#39;4&#39;</span>, <span style=color:#f1fa8c>&#39;5&#39;</span>, <span style=color:#f1fa8c>&#39;6&#39;</span>, <span style=color:#f1fa8c>&#39;7&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>    <span style=color:#f1fa8c>&#39;8&#39;</span>, <span style=color:#f1fa8c>&#39;9&#39;</span>, <span style=color:#f1fa8c>&#39;+&#39;</span>, <span style=color:#f1fa8c>&#39;/&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>然后我们就可以写一个简单的函数将 <span style=color:#bd93f9>3</span> 个字节转换为 <span style=color:#bd93f9>4</span> 个字符,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>encodeThreeBytes</span>(bytecodes):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>    <span style=color:#ff79c6>if</span> <span style=color:#8be9fd;font-style:italic>len</span>(bytecodes) <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>3</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>        <span style=color:#ff79c6>raise</span> Exception(<span style=color:#f1fa8c>&#34;The bytecode&#39;s length should be three.&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>    fisrt <span style=color:#ff79c6>=</span> getHighSix(bytecodes[<span style=color:#bd93f9>0</span>])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    second <span style=color:#ff79c6>=</span> getLowTwo(bytecodes[<span style=color:#bd93f9>0</span>]) <span style=color:#ff79c6>+</span> getHighFour(bytecodes[<span style=color:#bd93f9>1</span>])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>    third <span style=color:#ff79c6>=</span> getLowFour(bytecodes[<span style=color:#bd93f9>1</span>]) <span style=color:#ff79c6>+</span> getHighTwo(bytecodes[<span style=color:#bd93f9>2</span>])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>    fourth <span style=color:#ff79c6>=</span> getLowSix(bytecodes[<span style=color:#bd93f9>2</span>])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>    <span style=color:#ff79c6>return</span> codeTable[fisrt] <span style=color:#ff79c6>+</span> codeTable[second]  <span style=color:#ff79c6>+</span> codeTable[third]  <span style=color:#ff79c6>+</span> codeTable[fourth] 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>    <span style=color:#f1fa8c>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span><span style=color:#f1fa8c>    等价于:
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span><span style=color:#f1fa8c>    return codeTable[getHighSix(bytecodes[0])] + codeTable[getLowTwo(
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span><span style=color:#f1fa8c>        bytecodes[0]) + getHighFour(bytecodes[1])] + codeTable[getLowFour(
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span><span style=color:#f1fa8c>            bytecodes[1]) + getHighTwo(bytecodes[2])] + codeTable[getLowSix(
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span><span style=color:#f1fa8c>                bytecodes[2])]
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span><span style=color:#f1fa8c>    &#39;&#39;&#39;</span>
</span></span></code></pre></div><p>最后需要注意的是当输入的 bytes 长度不是 3 的倍数时, 需要对其补一个或者两个纯零即 <code>\x00</code> 字节后再进行编码,<br>完成后将结果的倒数一、二个字符替换成 = 号表示这是补零而来即可.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>b64encode</span>(bytecodes):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#ff79c6>if</span> <span style=color:#8be9fd;font-style:italic>len</span>(bytecodes) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    status <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    result <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#ff79c6>try</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        bytecodes <span style=color:#ff79c6>=</span> bytecodes<span style=color:#ff79c6>.</span>encode()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#ff79c6>except</span> Exception:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        <span style=color:#ff79c6>pass</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#ff79c6>if</span> <span style=color:#8be9fd;font-style:italic>len</span>(bytecodes)<span style=color:#ff79c6>%</span> <span style=color:#bd93f9>3</span> <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>2</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        status <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        bytecodes <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x00</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#ff79c6>if</span> <span style=color:#8be9fd;font-style:italic>len</span>(bytecodes)<span style=color:#ff79c6>%</span> <span style=color:#bd93f9>3</span> <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>1</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>        status <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>        bytecodes <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x00\x00</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#8be9fd;font-style:italic>int</span>(<span style=color:#8be9fd;font-style:italic>len</span>(bytecodes) <span style=color:#ff79c6>/</span> <span style=color:#bd93f9>3</span>)):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>        result <span style=color:#ff79c6>+=</span> encodeThreeBytes(bytecodes[i <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>3</span>:i <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>3</span> <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>3</span>])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#ff79c6>if</span> status <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>1</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>        <span style=color:#ff79c6>return</span> result[<span style=color:#bd93f9>0</span>:<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>] <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;=&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    <span style=color:#ff79c6>if</span> status <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>2</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>        <span style=color:#ff79c6>return</span> result[<span style=color:#bd93f9>0</span>:<span style=color:#ff79c6>-</span><span style=color:#bd93f9>2</span>] <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;==&#34;</span>   
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>    <span style=color:#ff79c6>return</span> result
</span></span></code></pre></div><p>这样我们就完成了一个简单的 base64 编码, 最后可以写个 tests 来验证.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>import</span> base64
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>import</span> myBase64
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>bytecodes <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x12\x66\x23\xff</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>org <span style=color:#ff79c6>=</span> myBase64<span style=color:#ff79c6>.</span>b64encode(bytecodes)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>std <span style=color:#ff79c6>=</span> base64<span style=color:#ff79c6>.</span>b64encode(bytecodes)<span style=color:#ff79c6>.</span>decode()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#8be9fd;font-style:italic>print</span>(org)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#8be9fd;font-style:italic>print</span>(std)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#8be9fd;font-style:italic>print</span>(org <span style=color:#ff79c6>==</span> std)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#f1fa8c>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#f1fa8c>输出:
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#f1fa8c>EmYj/w==
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#f1fa8c>EmYj/w==
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#f1fa8c>True
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#f1fa8c>&#39;&#39;&#39;</span>
</span></span></code></pre></div></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/python>python</a></li><li><a href=/tags/misc>misc</a></li></ul></nav></div></article></main><footer><div class=footer-info>© 2017 - 2022, rmb122</div><div style=display:flex><span class=border></span><a class=soc href=https://github.com/rmb122 title=GitHub><i data-feather=github></i></a><a class=soc href=https://rmb122.com/index.xml title=RSS><i data-feather=rss></i></a></div></footer><script>feather.replace()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MH3QGWHV5"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1MH3QGWHV5",{anonymize_ip:!1})}</script><script src=https://rmb122.com/js/medium-zoom.min.js></script>
<script>for(let e of document.getElementsByTagName("img"))mediumZoom(e,{margin:0,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.8)"})</script></div></body></html>